"use strict";

var _excluded = ["width", "height", "context", "render", "update", "children", "anchor", "opacity", "rotation", "drotation", "ddrotation", "scaleX", "scaleY"],
  _excluded2 = ["image", "width", "height"],
  _excluded3 = ["text", "textAlign", "lineHeight", "font"],
  _excluded4 = ["padX", "padY", "text", "disabled", "container", "onDown", "onUp"],
  _excluded5 = ["flow", "align", "justify", "colGap", "rowGap", "numCols", "dir", "breakpoints"],
  _excluded6 = ["id", "name", "objects", "context", "cullObjects", "cullFunction", "sortFunction"];
function _slicedToArray(r, e) { return _arrayWithHoles(r) || _iterableToArrayLimit(r, e) || _unsupportedIterableToArray(r, e) || _nonIterableRest(); }
function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _iterableToArrayLimit(r, l) { var t = null == r ? null : "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t["return"] && (u = t["return"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }
function _arrayWithHoles(r) { if (Array.isArray(r)) return r; }
function _superPropSet(t, e, o, r, p, f) { return _set(_getPrototypeOf(f ? t.prototype : t), e, o, r, p); }
function set(e, r, t, o) { return set = "undefined" != typeof Reflect && Reflect.set ? Reflect.set : function (e, r, t, o) { var f, i = _superPropBase(e, r); if (i) { if ((f = Object.getOwnPropertyDescriptor(i, r)).set) return f.set.call(o, t), !0; if (!f.writable) return !1; } if (f = Object.getOwnPropertyDescriptor(o, r)) { if (!f.writable) return !1; f.value = t, Object.defineProperty(o, r, f); } else _defineProperty(o, r, t); return !0; }, set(e, r, t, o); }
function _set(e, r, t, o, f) { if (!set(e, r, t, o || e) && f) throw new TypeError("failed to set property"); return t; }
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
function _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }
function _objectWithoutProperties(e, t) { if (null == e) return {}; var o, r, i = _objectWithoutPropertiesLoose(e, t); if (Object.getOwnPropertySymbols) { var s = Object.getOwnPropertySymbols(e); for (r = 0; r < s.length; r++) o = s[r], t.includes(o) || {}.propertyIsEnumerable.call(e, o) && (i[o] = e[o]); } return i; }
function _objectWithoutPropertiesLoose(r, e) { if (null == r) return {}; var t = {}; for (var n in r) if ({}.hasOwnProperty.call(r, n)) { if (e.includes(n)) continue; t[n] = r[n]; } return t; }
function _callSuper(t, o, e) { return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e)); }
function _possibleConstructorReturn(t, e) { if (e && ("object" == _typeof(e) || "function" == typeof e)) return e; if (void 0 !== e) throw new TypeError("Derived constructors may only return object or undefined"); return _assertThisInitialized(t); }
function _assertThisInitialized(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e; }
function _superPropGet(t, o, e, r) { var p = _get(_getPrototypeOf(1 & r ? t.prototype : t), o, e); return 2 & r && "function" == typeof p ? function (t) { return p.apply(e, t); } : p; }
function _get() { return _get = "undefined" != typeof Reflect && Reflect.get ? Reflect.get.bind() : function (e, t, r) { var p = _superPropBase(e, t); if (p) { var n = Object.getOwnPropertyDescriptor(p, t); return n.get ? n.get.call(arguments.length < 3 ? e : r) : n.value; } }, _get.apply(null, arguments); }
function _superPropBase(t, o) { for (; !{}.hasOwnProperty.call(t, o) && null !== (t = _getPrototypeOf(t));); return t; }
function _getPrototypeOf(t) { return _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) { return t.__proto__ || Object.getPrototypeOf(t); }, _getPrototypeOf(t); }
function _inherits(t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function"); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), Object.defineProperty(t, "prototype", { writable: !1 }), e && _setPrototypeOf(t, e); }
function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function _construct(t, e, r) { if (_isNativeReflectConstruct()) return Reflect.construct.apply(null, arguments); var o = [null]; o.push.apply(o, e); var p = new (t.bind.apply(t, o))(); return r && _setPrototypeOf(p, r.prototype), p; }
function _setPrototypeOf(t, e) { return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) { return t.__proto__ = e, t; }, _setPrototypeOf(t, e); }
function _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }
function _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }
function _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
function _toConsumableArray(r) { return _arrayWithoutHoles(r) || _iterableToArray(r) || _unsupportedIterableToArray(r) || _nonIterableSpread(); }
function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _unsupportedIterableToArray(r, a) { if (r) { if ("string" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }
function _iterableToArray(r) { if ("undefined" != typeof Symbol && null != r[Symbol.iterator] || null != r["@@iterator"]) return Array.from(r); }
function _arrayWithoutHoles(r) { if (Array.isArray(r)) return _arrayLikeToArray(r); }
function _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }
/**
 * @preserve
 * Kontra.js v10.0.2
 */
var kontra = function () {
  function t(t, e) {
    var i = Math.sin(e),
      s = Math.cos(e);
    return {
      x: t.x * s - t.y * i,
      y: t.x * i + t.y * s
    };
  }
  function e(t, e, i) {
    return Math.min(Math.max(t, i), e);
  }
  function i(t, e) {
    var i = s(t),
      n = s(e);
    return i.x < n.x + n.width && i.x + i.width > n.x && i.y < n.y + n.height && i.y + i.height > n.y;
  }
  function s(t) {
    var _ref = t.world || t,
      _ref$x = _ref.x,
      e = _ref$x === void 0 ? 0 : _ref$x,
      _ref$y = _ref.y,
      i = _ref$y === void 0 ? 0 : _ref$y,
      s = _ref.width,
      n = _ref.height,
      h = _ref.radius;
    return t.mapwidth && (s = t.mapwidth, n = t.mapheight), t.anchor && (e -= s * t.anchor.x, i -= n * t.anchor.y), s < 0 && (e += s, s *= -1), n < 0 && (i += n, n *= -1), {
      x: e,
      y: i,
      width: s,
      height: n
    };
  }
  var n = function n() {},
    h = "position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);",
    r = {
      preventScroll: !0
    };
  function a(t, e) {
    var i = e.parentNode;
    if (t.setAttribute("data-kontra", ""), i) {
      (_toConsumableArray(i.querySelectorAll(":scope > [data-kontra]")).pop() || e).after(t);
    } else "CANVAS" == e.nodeName ? document.body.append(t) : e.append(t);
  }
  function o(t, e) {
    var i = t.indexOf(e);
    if (-1 != i) return t.splice(i, 1), !0;
  }
  function d(t, e) {
    var _s = s(e),
      i = _s.x,
      n = _s.y,
      h = _s.width,
      r = _s.height;
    do {
      i -= e.sx || 0, n -= e.sy || 0;
    } while (e = e.parent);
    var a = t.x - Math.max(i, Math.min(t.x, i + h)),
      o = t.y - Math.max(n, Math.min(t.y, n + r));
    return a * a + o * o < t.radius * t.radius;
  }
  var c,
    l,
    u = {};
  function p(t, e) {
    u[t] = u[t] || [], u[t].push(e);
  }
  function _(t, e) {
    u[t] = (u[t] || []).filter(function (t) {
      return t != e;
    });
  }
  function f(t) {
    for (var _len = arguments.length, e = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
      e[_key - 1] = arguments[_key];
    }
    (u[t] || []).map(function (t) {
      return t.apply(void 0, e);
    });
  }
  var g = {
    get: function get(t, e) {
      return "_proxy" == e || n;
    }
  };
  function m() {
    return c;
  }
  function w() {
    return l;
  }
  var x = /*#__PURE__*/function () {
    function x(_ref2) {
      var t = _ref2.spriteSheet,
        e = _ref2.frames,
        i = _ref2.frameRate,
        _ref2$loop = _ref2.loop,
        s = _ref2$loop === void 0 ? !0 : _ref2$loop,
        n = _ref2.name;
      _classCallCheck(this, x);
      var _t$frame = t.frame,
        h = _t$frame.width,
        r = _t$frame.height,
        _t$frame$spacing = _t$frame.spacing,
        a = _t$frame$spacing === void 0 ? 0 : _t$frame$spacing,
        _t$frame$margin = _t$frame.margin,
        o = _t$frame$margin === void 0 ? 0 : _t$frame$margin;
      Object.assign(this, {
        spriteSheet: t,
        frames: e,
        frameRate: i,
        loop: s,
        name: n,
        width: h,
        height: r,
        spacing: a,
        margin: o,
        isStopped: !1,
        _f: 0,
        _a: 0
      });
    }
    return _createClass(x, [{
      key: "clone",
      value: function clone() {
        return new x(this);
      }
    }, {
      key: "start",
      value: function start() {
        this.isStopped = !1, this.loop || this.reset();
      }
    }, {
      key: "stop",
      value: function stop() {
        this.isStopped = !0;
      }
    }, {
      key: "reset",
      value: function reset() {
        this._f = 0, this._a = 0;
      }
    }, {
      key: "update",
      value: function update() {
        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1 / 60;
        if (!this.isStopped) if (this.loop || this._f != this.frames.length - 1) for (this._a += t; this._a * this.frameRate >= 1;) this._f = ++this._f % this.frames.length, this._a -= 1 / this.frameRate;else this.stop();
      }
    }, {
      key: "render",
      value: function render(_ref3) {
        var t = _ref3.x,
          e = _ref3.y,
          _ref3$width = _ref3.width,
          i = _ref3$width === void 0 ? this.width : _ref3$width,
          _ref3$height = _ref3.height,
          s = _ref3$height === void 0 ? this.height : _ref3$height,
          _ref3$context = _ref3.context,
          n = _ref3$context === void 0 ? w() : _ref3$context;
        var h = this.frames[this._f] / this.spriteSheet._f | 0,
          r = this.frames[this._f] % this.spriteSheet._f | 0;
        n.drawImage(this.spriteSheet.image, this.margin + r * this.width + (2 * r + 1) * this.spacing, this.margin + h * this.height + (2 * h + 1) * this.spacing, this.width, this.height, t, e, i, s);
      }
    }]);
  }();
  function y() {
    return _construct(x, Array.prototype.slice.call(arguments));
  }
  var b = /(jpeg|jpg|gif|png|webp)$/,
    v = /(wav|mp3|ogg|aac)$/,
    S = /^\//,
    C = /\/$/,
    A = new WeakMap(),
    k = "",
    j = "",
    M = "";
  function E(t, e) {
    return new URL(t, e).href;
  }
  function P(t, e) {
    return [t.replace(C, ""), t ? e.replace(S, "") : e].filter(function (t) {
      return t;
    }).join("/");
  }
  function O(t) {
    return t.split(".").pop();
  }
  function L(t) {
    var e = t.replace("." + O(t), "");
    return 2 == e.split("/").length ? e.replace(S, "") : e;
  }
  var I = {},
    D = {},
    G = {};
  function N() {
    window.__k || (window.__k = {
      dm: A,
      u: E,
      d: G,
      i: I
    });
  }
  function X(t) {
    return N(), new Promise(function (e, i) {
      var s, n, h;
      if (s = P(k, t), I[s]) return e(I[s]);
      n = new Image(), n.onload = function () {
        h = E(s, window.location.href), I[L(t)] = I[s] = I[h] = this, f("assetLoaded", this, t), e(this);
      }, n.onerror = function () {
        i(s);
      }, n.src = s;
    });
  }
  function Y(t) {
    return new Promise(function (e, i) {
      var s,
        n,
        h,
        r,
        a = t;
      var o;
      return s = new Audio(), n = {
        wav: (o = s).canPlayType('audio/wav; codecs="1"'),
        mp3: o.canPlayType("audio/mpeg;"),
        ogg: o.canPlayType('audio/ogg; codecs="vorbis"'),
        aac: o.canPlayType("audio/aac;")
      }, (t = [].concat(t).reduce(function (t, e) {
        return t || (n[O(e)] ? e : null);
      }, 0)) ? (h = P(j, t), D[h] ? e(D[h]) : (s.addEventListener("canplay", function () {
        r = E(h, window.location.href), D[L(t)] = D[h] = D[r] = this, f("assetLoaded", this, t), e(this);
      }), s.onerror = function () {
        i(h);
      }, s.src = h, void s.load())) : i(a);
    });
  }
  function T(t) {
    var e, i;
    return N(), e = P(M, t), G[e] ? Promise.resolve(G[e]) : fetch(e).then(function (t) {
      if (!t.ok) throw t;
      return t.clone().json()["catch"](function () {
        return t.text();
      });
    }).then(function (s) {
      return i = E(e, window.location.href), "object" == _typeof(s) && A.set(s, i), G[L(t)] = G[e] = G[i] = s, f("assetLoaded", s, t), s;
    });
  }
  var z = /*#__PURE__*/function () {
    function z() {
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
      var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
      _classCallCheck(this, z);
      null != t.x ? (this.x = t.x, this.y = t.y) : (this.x = t, this.y = e), i._c && (this.clamp(i._a, i._b, i._d, i._e), this.x = t, this.y = e);
    }
    return _createClass(z, [{
      key: "set",
      value: function set(t) {
        this.x = t.x, this.y = t.y;
      }
    }, {
      key: "add",
      value: function add(t) {
        return new z(this.x + t.x, this.y + t.y, this);
      }
    }, {
      key: "subtract",
      value: function subtract(t) {
        return new z(this.x - t.x, this.y - t.y, this);
      }
    }, {
      key: "scale",
      value: function scale(t) {
        return new z(this.x * t, this.y * t);
      }
    }, {
      key: "normalize",
      value: function normalize() {
        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.length() || 1;
        return new z(this.x / t, this.y / t);
      }
    }, {
      key: "dot",
      value: function dot(t) {
        return this.x * t.x + this.y * t.y;
      }
    }, {
      key: "length",
      value: function length() {
        return Math.hypot(this.x, this.y);
      }
    }, {
      key: "distance",
      value: function distance(t) {
        return Math.hypot(this.x - t.x, this.y - t.y);
      }
    }, {
      key: "angle",
      value: function angle(t) {
        return Math.acos(this.dot(t) / (this.length() * t.length()));
      }
    }, {
      key: "direction",
      value: function direction() {
        return Math.atan2(this.y, this.x);
      }
    }, {
      key: "clamp",
      value: function clamp(t, e, i, s) {
        this._c = !0, this._a = t, this._b = e, this._d = i, this._e = s;
      }
    }, {
      key: "x",
      get: function get() {
        return this._x;
      },
      set: function set(t) {
        this._x = this._c ? e(this._a, this._d, t) : t;
      }
    }, {
      key: "y",
      get: function get() {
        return this._y;
      },
      set: function set(t) {
        this._y = this._c ? e(this._b, this._e, t) : t;
      }
    }]);
  }();
  function R() {
    return _construct(z, Array.prototype.slice.call(arguments));
  }
  var W = /*#__PURE__*/function (_ref4) {
    function W() {
      _classCallCheck(this, W);
      return _callSuper(this, W, arguments);
    }
    _inherits(W, _ref4);
    return _createClass(W, [{
      key: "init",
      value: function init() {
        var _this = this;
        var _ref5 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
          _ref5$width = _ref5.width,
          t = _ref5$width === void 0 ? 0 : _ref5$width,
          _ref5$height = _ref5.height,
          e = _ref5$height === void 0 ? 0 : _ref5$height,
          _ref5$context = _ref5.context,
          i = _ref5$context === void 0 ? w() : _ref5$context,
          _ref5$render = _ref5.render,
          s = _ref5$render === void 0 ? this.draw : _ref5$render,
          _ref5$update = _ref5.update,
          n = _ref5$update === void 0 ? this.advance : _ref5$update,
          _ref5$children = _ref5.children,
          h = _ref5$children === void 0 ? [] : _ref5$children,
          _ref5$anchor = _ref5.anchor,
          r = _ref5$anchor === void 0 ? {
            x: 0,
            y: 0
          } : _ref5$anchor,
          _ref5$opacity = _ref5.opacity,
          a = _ref5$opacity === void 0 ? 1 : _ref5$opacity,
          _ref5$rotation = _ref5.rotation,
          o = _ref5$rotation === void 0 ? 0 : _ref5$rotation,
          _ref5$drotation = _ref5.drotation,
          d = _ref5$drotation === void 0 ? 0 : _ref5$drotation,
          _ref5$ddrotation = _ref5.ddrotation,
          c = _ref5$ddrotation === void 0 ? 0 : _ref5$ddrotation,
          _ref5$scaleX = _ref5.scaleX,
          l = _ref5$scaleX === void 0 ? 1 : _ref5$scaleX,
          _ref5$scaleY = _ref5.scaleY,
          u = _ref5$scaleY === void 0 ? 1 : _ref5$scaleY,
          _ = _objectWithoutProperties(_ref5, _excluded);
        this._c = [], _superPropGet(W, "init", this, 3)([_objectSpread({
          width: t,
          height: e,
          context: i,
          anchor: r,
          opacity: a,
          rotation: o,
          drotation: d,
          ddrotation: c,
          scaleX: l,
          scaleY: u
        }, _)]), this._di = !0, this._uw(), this.addChild(h), this._rf = s, this._uf = n, p("init", function () {
          var _this$context;
          (_this$context = _this.context) !== null && _this$context !== void 0 ? _this$context : _this.context = w();
        });
      }
    }, {
      key: "update",
      value: function update(t) {
        this._uf(t), this.children.map(function (e) {
          return e.update && e.update(t);
        });
      }
    }, {
      key: "render",
      value: function render() {
        var t = this.context;
        t.save(), (this.x || this.y) && t.translate(this.x, this.y), this.rotation && t.rotate(this.rotation), 1 == this.scaleX && 1 == this.scaleY || t.scale(this.scaleX, this.scaleY);
        var e = this.width,
          i = this.height,
          s = -e * this.anchor.x,
          n = -i * this.anchor.y;
        (s || n) && t.translate(s, n), this.context.globalAlpha = this.opacity, this._rf(), (s || n) && t.translate(-s, -n), this.children.map(function (t) {
          return t.render && t.render();
        }), t.restore();
      }
    }, {
      key: "draw",
      value: function draw() {}
    }, {
      key: "_pc",
      value: function _pc() {
        this._uw(), this.children.map(function (t) {
          return t._pc();
        });
      }
    }, {
      key: "x",
      get: function get() {
        return this.position.x;
      },
      set: function set(t) {
        this.position.x = t, this._pc();
      }
    }, {
      key: "y",
      get: function get() {
        return this.position.y;
      },
      set: function set(t) {
        this.position.y = t, this._pc();
      }
    }, {
      key: "width",
      get: function get() {
        return this._w;
      },
      set: function set(t) {
        this._w = t, this._pc();
      }
    }, {
      key: "height",
      get: function get() {
        return this._h;
      },
      set: function set(t) {
        this._h = t, this._pc();
      }
    }, {
      key: "_uw",
      value: function _uw() {
        if (!this._di) return;
        var _ref6 = this.parent || {},
          _ref6$_wx = _ref6._wx,
          e = _ref6$_wx === void 0 ? 0 : _ref6$_wx,
          _ref6$_wy = _ref6._wy,
          i = _ref6$_wy === void 0 ? 0 : _ref6$_wy,
          _ref6$_wo = _ref6._wo,
          s = _ref6$_wo === void 0 ? 1 : _ref6$_wo,
          _ref6$_wrot = _ref6._wrot,
          n = _ref6$_wrot === void 0 ? 0 : _ref6$_wrot,
          _ref6$_wsx = _ref6._wsx,
          h = _ref6$_wsx === void 0 ? 1 : _ref6$_wsx,
          _ref6$_wsy = _ref6._wsy,
          r = _ref6$_wsy === void 0 ? 1 : _ref6$_wsy;
        this._wx = this.x, this._wy = this.y, this._ww = this.width, this._wh = this.height, this._wo = s * this.opacity, this._wsx = h * this.scaleX, this._wsy = r * this.scaleY, this._wx = this._wx * h, this._wy = this._wy * r, this._ww = this.width * this._wsx, this._wh = this.height * this._wsy, this._wrot = n + this.rotation;
        var _t2 = t({
            x: this._wx,
            y: this._wy
          }, n),
          a = _t2.x,
          o = _t2.y;
        this._wx = a, this._wy = o, this._wx += e, this._wy += i;
      }
    }, {
      key: "world",
      get: function get() {
        return {
          x: this._wx,
          y: this._wy,
          width: this._ww,
          height: this._wh,
          opacity: this._wo,
          rotation: this._wrot,
          scaleX: this._wsx,
          scaleY: this._wsy
        };
      }
    }, {
      key: "children",
      get: function get() {
        return this._c;
      },
      set: function set(t) {
        this.removeChild(this._c), this.addChild(t);
      }
    }, {
      key: "addChild",
      value: function addChild() {
        var _this2 = this;
        for (var _len2 = arguments.length, t = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
          t[_key2] = arguments[_key2];
        }
        t.flat().map(function (t) {
          _this2.children.push(t), t.parent = _this2, t._pc = t._pc || n, t._pc();
        });
      }
    }, {
      key: "removeChild",
      value: function removeChild() {
        var _this3 = this;
        for (var _len3 = arguments.length, t = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {
          t[_key3] = arguments[_key3];
        }
        t.flat().map(function (t) {
          o(_this3.children, t) && (t.parent = null, t._pc());
        });
      }
    }, {
      key: "opacity",
      get: function get() {
        return this._opa;
      },
      set: function set(t) {
        this._opa = e(0, 1, t), this._pc();
      }
    }, {
      key: "rotation",
      get: function get() {
        return this._rot;
      },
      set: function set(t) {
        this._rot = t, this._pc();
      }
    }, {
      key: "advance",
      value: function advance(t) {
        _superPropGet(W, "advance", this, 3)([t]), this.drotation += this.ddrotation, this.rotation += this.drotation;
      }
    }, {
      key: "setScale",
      value: function setScale(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : t;
        this.scaleX = t, this.scaleY = e;
      }
    }, {
      key: "scaleX",
      get: function get() {
        return this._scx;
      },
      set: function set(t) {
        this._scx = t, this._pc();
      }
    }, {
      key: "scaleY",
      get: function get() {
        return this._scy;
      },
      set: function set(t) {
        this._scy = t, this._pc();
      }
    }]);
  }(/*#__PURE__*/function () {
    function _class(t) {
      _classCallCheck(this, _class);
      return this.init(t);
    }
    return _createClass(_class, [{
      key: "init",
      value: function init() {
        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
        this.position = R(), this.velocity = R(), this.acceleration = R(), this.ttl = 1 / 0, Object.assign(this, t);
      }
    }, {
      key: "update",
      value: function update(t) {
        this.advance(t);
      }
    }, {
      key: "advance",
      value: function advance(t) {
        var e = this.acceleration;
        t && (e = e.scale(t)), this.velocity = this.velocity.add(e);
        var i = this.velocity;
        t && (i = i.scale(t)), this.position = this.position.add(i), this._pc(), this.ttl--;
      }
    }, {
      key: "dx",
      get: function get() {
        return this.velocity.x;
      },
      set: function set(t) {
        this.velocity.x = t;
      }
    }, {
      key: "dy",
      get: function get() {
        return this.velocity.y;
      },
      set: function set(t) {
        this.velocity.y = t;
      }
    }, {
      key: "ddx",
      get: function get() {
        return this.acceleration.x;
      },
      set: function set(t) {
        this.acceleration.x = t;
      }
    }, {
      key: "ddy",
      get: function get() {
        return this.acceleration.y;
      },
      set: function set(t) {
        this.acceleration.y = t;
      }
    }, {
      key: "isAlive",
      value: function isAlive() {
        return this.ttl > 0;
      }
    }, {
      key: "_pc",
      value: function _pc() {}
    }]);
  }());
  var F = /*#__PURE__*/function (_W) {
    function F() {
      _classCallCheck(this, F);
      return _callSuper(this, F, arguments);
    }
    _inherits(F, _W);
    return _createClass(F, [{
      key: "init",
      value: function init() {
        var _ref7 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
          t = _ref7.image,
          _ref7$width = _ref7.width,
          e = _ref7$width === void 0 ? t ? t.width : void 0 : _ref7$width,
          _ref7$height = _ref7.height,
          i = _ref7$height === void 0 ? t ? t.height : void 0 : _ref7$height,
          s = _objectWithoutProperties(_ref7, _excluded2);
        _superPropGet(F, "init", this, 3)([_objectSpread({
          image: t,
          width: e,
          height: i
        }, s)]);
      }
    }, {
      key: "animations",
      get: function get() {
        return this._a;
      },
      set: function set(t) {
        var e, i;
        for (e in this._a = {}, t) this._a[e] = t[e].clone(), i = i || this._a[e];
        this.currentAnimation = i, this.width = this.width || i.width, this.height = this.height || i.height;
      }
    }, {
      key: "playAnimation",
      value: function playAnimation(t) {
        var _this$currentAnimatio;
        (_this$currentAnimatio = this.currentAnimation) !== null && _this$currentAnimatio !== void 0 && _this$currentAnimatio.stop(), this.currentAnimation = this.animations[t], this.currentAnimation.start();
      }
    }, {
      key: "advance",
      value: function advance(t) {
        var _this$currentAnimatio2;
        _superPropGet(F, "advance", this, 3)([t]), (_this$currentAnimatio2 = this.currentAnimation) === null || _this$currentAnimatio2 === void 0 ? void 0 : _this$currentAnimatio2.update(t);
      }
    }, {
      key: "draw",
      value: function draw() {
        this.image && this.context.drawImage(this.image, 0, 0, this.image.width, this.image.height), this.currentAnimation && this.currentAnimation.render({
          x: 0,
          y: 0,
          width: this.width,
          height: this.height,
          context: this.context
        }), this.color && (this.context.fillStyle = this.color, this.context.fillRect(0, 0, this.width, this.height));
      }
    }]);
  }(W);
  var B = /(\d+)(\w+)/;
  var H = /*#__PURE__*/function (_W2) {
    function H() {
      _classCallCheck(this, H);
      return _callSuper(this, H, arguments);
    }
    _inherits(H, _W2);
    return _createClass(H, [{
      key: "init",
      value: function init() {
        var _w,
          _this4 = this;
        var _ref8 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
          _ref8$text = _ref8.text,
          t = _ref8$text === void 0 ? "" : _ref8$text,
          _ref8$textAlign = _ref8.textAlign,
          e = _ref8$textAlign === void 0 ? "" : _ref8$textAlign,
          _ref8$lineHeight = _ref8.lineHeight,
          i = _ref8$lineHeight === void 0 ? 1 : _ref8$lineHeight,
          _ref8$font = _ref8.font,
          s = _ref8$font === void 0 ? (_w = w()) === null || _w === void 0 ? void 0 : _w.font : _ref8$font,
          n = _objectWithoutProperties(_ref8, _excluded3);
        t = "" + t, _superPropGet(H, "init", this, 3)([_objectSpread({
          text: t,
          textAlign: e,
          lineHeight: i,
          font: s
        }, n)]), this.context && this._p(), p("init", function () {
          var _this4$font;
          (_this4$font = _this4.font) !== null && _this4$font !== void 0 ? _this4$font : _this4.font = w().font, _this4._p();
        });
      }
    }, {
      key: "width",
      get: function get() {
        return this._w;
      },
      set: function set(t) {
        this._d = !0, this._w = t, this._fw = t;
      }
    }, {
      key: "text",
      get: function get() {
        return this._t;
      },
      set: function set(t) {
        this._d = !0, this._t = "" + t;
      }
    }, {
      key: "font",
      get: function get() {
        return this._f;
      },
      set: function set(t) {
        this._d = !0, this._f = t, this._fs = function (t) {
          if (!t) return {
            computed: 0
          };
          var e = t.match(B),
            i = +e[1];
          return {
            size: i,
            unit: e[2],
            computed: i
          };
        }(t).computed;
      }
    }, {
      key: "lineHeight",
      get: function get() {
        return this._lh;
      },
      set: function set(t) {
        this._d = !0, this._lh = t;
      }
    }, {
      key: "render",
      value: function render() {
        this._d && this._p(), _superPropGet(H, "render", this, 3)([]);
      }
    }, {
      key: "_p",
      value: function _p() {
        var _this5 = this;
        this._s = [], this._d = !1;
        var t = this.context,
          e = [this.text];
        if (t.font = this.font, e = this.text.split("\n"), this._fw && e.map(function (e) {
          var i = e.split(" "),
            s = i.shift(),
            n = s;
          i.map(function (e) {
            n += " " + e, t.measureText(n).width > _this5._fw && (_this5._s.push(s), n = e), s = n;
          }), _this5._s.push(n);
        }), !this._s.length && this.text.includes("\n")) {
          var _i = 0;
          e.map(function (e) {
            _this5._s.push(e), _i = Math.max(_i, t.measureText(e).width);
          }), this._w = this._fw || _i;
        }
        this._s.length || (this._s.push(this.text), this._w = this._fw || t.measureText(this.text).width), this.height = this._fs + (this._s.length - 1) * this._fs * this.lineHeight, this._uw();
      }
    }, {
      key: "draw",
      value: function draw() {
        var _this6 = this;
        var t = 0,
          e = this.textAlign,
          i = this.context;
        e = this.textAlign || ("rtl" == i.canvas.dir ? "right" : "left"), t = "right" == e ? this.width : "center" == e ? this.width / 2 | 0 : 0, this._s.map(function (s, n) {
          var _this6$lineWidth;
          i.textBaseline = "top", i.textAlign = e, i.fillStyle = _this6.color, i.font = _this6.font, _this6.strokeColor && (i.strokeStyle = _this6.strokeColor, i.lineWidth = (_this6$lineWidth = _this6.lineWidth) !== null && _this6$lineWidth !== void 0 ? _this6$lineWidth : 1, i.strokeText(s, t, _this6._fs * _this6.lineHeight * n)), i.fillText(s, t, _this6._fs * _this6.lineHeight * n);
        });
      }
    }]);
  }(W);
  function U() {
    return _construct(H, Array.prototype.slice.call(arguments));
  }
  var q = new WeakMap(),
    K = {},
    V = {},
    $ = {
      0: "left",
      1: "middle",
      2: "right"
    };
  function J(t) {
    var e = t._lf.length ? t._lf : t._cf;
    for (var _i2 = e.length - 1; _i2 >= 0; _i2--) {
      var _s2 = e[_i2];
      if (_s2.collidesWithPointer ? _s2.collidesWithPointer(t) : d(t, _s2)) return _s2;
    }
  }
  function Q(t, e) {
    return parseFloat(t.getPropertyValue(e)) || 0;
  }
  function Z(t) {
    var e = null != t.button ? $[t.button] : "left";
    V[e] = !0, nt(t, "onDown");
  }
  function tt(t) {
    var e = null != t.button ? $[t.button] : "left";
    V[e] = !1, nt(t, "onUp");
  }
  function et(t) {
    nt(t, "onOver");
  }
  function it(t) {
    q.get(t.target)._oo = null, V = {};
  }
  function st(t, e, i) {
    var s = J(t);
    s && s[e] && s[e](i), K[e] && K[e](i, s), "onOver" == e && (s != t._oo && t._oo && t._oo.onOut && t._oo.onOut(i), t._oo = s);
  }
  function nt(t, e) {
    t.preventDefault();
    var i = t.target,
      s = q.get(i),
      _ref9 = function (t) {
        var e = t.canvas,
          i = t._s,
          s = e.getBoundingClientRect(),
          n = "none" != i.transform ? i.transform.replace("matrix(", "").split(",") : [1, 1, 1, 1],
          h = parseFloat(n[0]),
          r = parseFloat(n[3]),
          a = (Q(i, "border-left-width") + Q(i, "border-right-width")) * h,
          o = (Q(i, "border-top-width") + Q(i, "border-bottom-width")) * r,
          d = (Q(i, "padding-left") + Q(i, "padding-right")) * h,
          c = (Q(i, "padding-top") + Q(i, "padding-bottom")) * r;
        return {
          scaleX: (s.width - a - d) / e.width,
          scaleY: (s.height - o - c) / e.height,
          offsetX: s.left + (Q(i, "border-left-width") + Q(i, "padding-left")) * h,
          offsetY: s.top + (Q(i, "border-top-width") + Q(i, "padding-top")) * r
        };
      }(s),
      n = _ref9.scaleX,
      h = _ref9.scaleY,
      r = _ref9.offsetX,
      a = _ref9.offsetY;
    t.type.includes("touch") ? (Array.from(t.touches).map(function (_ref10) {
      var t = _ref10.clientX,
        e = _ref10.clientY,
        i = _ref10.identifier;
      var o = s.touches[i];
      o || (o = s.touches[i] = {
        start: {
          x: (t - r) / n,
          y: (e - a) / h
        }
      }, s.touches.length++), o.changed = !1;
    }), Array.from(t.changedTouches).map(function (_ref11) {
      var i = _ref11.clientX,
        o = _ref11.clientY,
        d = _ref11.identifier;
      var c = s.touches[d];
      c.changed = !0, c.x = s.x = (i - r) / n, c.y = s.y = (o - a) / h, st(s, e, t), f("touchChanged", t, s.touches), "onUp" == e && (delete s.touches[d], s.touches.length--, s.touches.length || f("touchEnd"));
    })) : (s.x = (t.clientX - r) / n, s.y = (t.clientY - a) / h, st(s, e, t));
  }
  function ht() {
    var _ref12 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
      _ref12$radius = _ref12.radius,
      t = _ref12$radius === void 0 ? 5 : _ref12$radius,
      _ref12$canvas = _ref12.canvas,
      e = _ref12$canvas === void 0 ? m() : _ref12$canvas;
    var i = q.get(e);
    if (!i) {
      var _s3 = window.getComputedStyle(e);
      i = {
        x: 0,
        y: 0,
        radius: t,
        touches: {
          length: 0
        },
        canvas: e,
        _cf: [],
        _lf: [],
        _o: [],
        _oo: null,
        _s: _s3
      }, q.set(e, i);
    }
    return e.addEventListener("mousedown", Z), e.addEventListener("touchstart", Z), e.addEventListener("mouseup", tt), e.addEventListener("touchend", tt), e.addEventListener("touchcancel", tt), e.addEventListener("blur", it), e.addEventListener("mousemove", et), e.addEventListener("touchmove", et), i._t || (i._t = !0, p("tick", function () {
      i._lf.length = 0, i._cf.map(function (t) {
        i._lf.push(t);
      }), i._cf.length = 0;
    })), i;
  }
  function rt() {
    for (var _len4 = arguments.length, t = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {
      t[_key4] = arguments[_key4];
    }
    t.flat().map(function (t) {
      var e = t.context ? t.context.canvas : m(),
        i = q.get(e);
      t.__r || (t.__r = t.render, t.render = function () {
        i._cf.push(this), this.__r();
      }, i._o.push(t));
    });
  }
  function at(t, e) {
    var i = t[0].toUpperCase() + t.substr(1);
    K["on" + i] = e;
  }
  function ot(t) {
    var e = t[0].toUpperCase() + t.substr(1);
    K["on" + e] = 0;
  }
  var dt = /*#__PURE__*/function (_F) {
    function dt() {
      _classCallCheck(this, dt);
      return _callSuper(this, dt, arguments);
    }
    _inherits(dt, _F);
    return _createClass(dt, [{
      key: "init",
      value: function init() {
        var _this7 = this;
        var _ref13 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
          _ref13$padX = _ref13.padX,
          t = _ref13$padX === void 0 ? 0 : _ref13$padX,
          _ref13$padY = _ref13.padY,
          e = _ref13$padY === void 0 ? 0 : _ref13$padY,
          i = _ref13.text,
          _ref13$disabled = _ref13.disabled,
          s = _ref13$disabled === void 0 ? !1 : _ref13$disabled,
          r = _ref13.container,
          o = _ref13.onDown,
          d = _ref13.onUp,
          c = _objectWithoutProperties(_ref13, _excluded4);
        _superPropGet(dt, "init", this, 3)([_objectSpread({
          padX: t,
          padY: e
        }, c)]), this.textNode = U(_objectSpread(_objectSpread({}, i), {}, {
          context: this.context
        })), this.width || (this.width = this.textNode.width, this.height = this.textNode.height), rt(this), this.addChild(this.textNode), this._od = o || n, this._ou = d || n;
        var l = this._dn = document.createElement("button");
        l.style = h, l.textContent = this.text, s && this.disable(), l.addEventListener("focus", function () {
          return _this7.focus();
        }), l.addEventListener("blur", function () {
          return _this7.blur();
        }), l.addEventListener("keydown", function (t) {
          return _this7._kd(t);
        }), l.addEventListener("keyup", function (t) {
          return _this7._ku(t);
        }), a(l, r !== null && r !== void 0 ? r : this.context.canvas), this._uw(), this._p();
      }
    }, {
      key: "text",
      get: function get() {
        return this.textNode.text;
      },
      set: function set(t) {
        this._d = !0, this.textNode.text = t;
      }
    }, {
      key: "node",
      get: function get() {
        return this._dn;
      }
    }, {
      key: "destroy",
      value: function destroy() {
        this._dn.remove();
      }
    }, {
      key: "_p",
      value: function _p() {
        this.text != this._dn.textContent && (this._dn.textContent = this.text), this.textNode._p();
        var t = this.textNode.width + 2 * this.padX,
          e = this.textNode.height + 2 * this.padY;
        this.width = Math.max(t, this.width), this.height = Math.max(e, this.height), this._uw();
      }
    }, {
      key: "render",
      value: function render() {
        this._d && this._p(), _superPropGet(dt, "render", this, 3)([]);
      }
    }, {
      key: "enable",
      value: function enable() {
        this.disabled = this._dn.disabled = !1, this.onEnable();
      }
    }, {
      key: "disable",
      value: function disable() {
        this.disabled = this._dn.disabled = !0, this.onDisable();
      }
    }, {
      key: "focus",
      value: function focus() {
        this.disabled || (this.focused = !0, document.activeElement != this._dn && this._dn.focus(r), this.onFocus());
      }
    }, {
      key: "blur",
      value: function blur() {
        this.focused = !1, document.activeElement == this._dn && this._dn.blur(), this.onBlur();
      }
    }, {
      key: "onOver",
      value: function onOver() {
        this.disabled || (this.hovered = !0);
      }
    }, {
      key: "onOut",
      value: function onOut() {
        this.hovered = !1;
      }
    }, {
      key: "onEnable",
      value: function onEnable() {}
    }, {
      key: "onDisable",
      value: function onDisable() {}
    }, {
      key: "onFocus",
      value: function onFocus() {}
    }, {
      key: "onBlur",
      value: function onBlur() {}
    }, {
      key: "onDown",
      value: function onDown() {
        this.disabled || (this.pressed = !0, this._od());
      }
    }, {
      key: "onUp",
      value: function onUp() {
        this.disabled || (this.pressed = !1, this._ou());
      }
    }, {
      key: "_kd",
      value: function _kd(t) {
        "Enter" != t.code && "Space" != t.code || this.onDown();
      }
    }, {
      key: "_ku",
      value: function _ku(t) {
        "Enter" != t.code && "Space" != t.code || this.onUp();
      }
    }]);
  }(F);
  function ct(t) {
    var e = t.canvas;
    t.clearRect(0, 0, e.width, e.height);
  }
  var lt = [],
    ut = {},
    pt = {},
    _t = {
      0: "south",
      1: "east",
      2: "west",
      3: "north",
      4: "leftshoulder",
      5: "rightshoulder",
      6: "lefttrigger",
      7: "righttrigger",
      8: "select",
      9: "start",
      10: "leftstick",
      11: "rightstick",
      12: "dpadup",
      13: "dpaddown",
      14: "dpadleft",
      15: "dpadright"
    };
  function ft(t) {
    lt[t.gamepad.index] = {
      pressedButtons: {},
      axes: {}
    };
  }
  function gt(t) {
    delete lt[t.gamepad.index];
  }
  function mt() {
    lt.map(function (t) {
      t.pressedButtons = {}, t.axes = {};
    });
  }
  function wt() {
    var t = navigator.getGamepads ? navigator.getGamepads() : navigator.webkitGetGamepads ? navigator.webkitGetGamepads : [];
    var _loop = function _loop() {
      var i = t[_e];
      if (!i) return 1; // continue
      i.buttons.map(function (t, e) {
        var s = _t[e],
          n = t.pressed,
          h = lt[i.index].pressedButtons,
          r = h[s];
        !r && n ? [ut[i.index], ut].map(function (e) {
          var _e$s;
          e === null || e === void 0 || (_e$s = e[s]) === null || _e$s === void 0 || _e$s.call(e, i, t, s);
        }) : r && !n && [pt[i.index], pt].map(function (e) {
          var _e$s2;
          e === null || e === void 0 || (_e$s2 = e[s]) === null || _e$s2 === void 0 || _e$s2.call(e, i, t, s);
        }), h[s] = n;
      });
      var s = lt[i.index].axes;
      s.leftstickx = i.axes[0], s.leftsticky = i.axes[1], s.rightstickx = i.axes[2], s.rightsticky = i.axes[3];
    };
    for (var _e = 0; _e < t.length; _e++) {
      if (_loop()) continue;
    }
  }
  function xt() {
    window.addEventListener("gamepadconnected", ft), window.addEventListener("gamepaddisconnected", gt), window.addEventListener("blur", mt), p("tick", wt);
  }
  function yt(t, e) {
    var _ref14 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
      i = _ref14.gamepad,
      _ref14$handler = _ref14.handler,
      s = _ref14$handler === void 0 ? "gamepaddown" : _ref14$handler;
    var n = "gamepaddown" == s ? ut : pt;
    [].concat(t).map(function (t) {
      isNaN(i) ? n[t] = e : (n[i] = n[i] || {}, n[i][t] = e);
    });
  }
  function bt(t) {
    var _ref15 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
      e = _ref15.gamepad,
      _ref15$handler = _ref15.handler,
      i = _ref15$handler === void 0 ? "gamepaddown" : _ref15$handler;
    var s = "gamepaddown" == i ? ut : pt;
    [].concat(t).map(function (t) {
      isNaN(e) ? delete s[t] : (s[e] = s[e] || {}, delete s[e][t]);
    });
  }
  var vt,
    St = {},
    Ct = !1,
    At = {
      swipe: {
        touches: 1,
        threshold: 10,
        touchend: function touchend(_ref16) {
          var t = _ref16[0];
          var e = t.x - t.start.x,
            i = t.y - t.start.y,
            s = Math.abs(e),
            n = Math.abs(i);
          if (!(s < this.threshold && n < this.threshold)) return s > n ? e < 0 ? "left" : "right" : i < 0 ? "up" : "down";
        }
      },
      pinch: {
        touches: 2,
        threshold: 2,
        touchstart: function touchstart(_ref17) {
          var t = _ref17[0],
            e = _ref17[1];
          this.prevDist = Math.hypot(t.x - e.x, t.y - e.y);
        },
        touchmove: function touchmove(_ref18) {
          var t = _ref18[0],
            e = _ref18[1];
          var i = Math.hypot(t.x - e.x, t.y - e.y);
          if (Math.abs(i - this.prevDist) < this.threshold) return;
          var s = i > this.prevDist ? "out" : "in";
          return this.prevDist = i, s;
        }
      }
    };
  function kt() {
    Ct || (Ct = !0, p("touchChanged", function (t, e) {
      Object.keys(At).map(function (i) {
        var _n$t$type, _n$t$type2;
        var s,
          n = At[i];
        (!vt || vt == i) && e.length == n.touches && _toConsumableArray(Array(e.length).keys()).every(function (t) {
          return e[t];
        }) && (s = (_n$t$type = (_n$t$type2 = n[t.type]) === null || _n$t$type2 === void 0 ? void 0 : _n$t$type2.call(n, e)) !== null && _n$t$type !== void 0 ? _n$t$type : "") && St[i + s] && (vt = i, St[i + s](t, e));
      });
    }), p("touchEnd", function () {
      vt = 0;
    }));
  }
  function jt(t, e) {
    [].concat(t).map(function (t) {
      St[t] = e;
    });
  }
  function Mt(t) {
    [].concat(t).map(function (t) {
      St[t] = 0;
    });
  }
  var Et = {
      set: function set(t, e, i) {
        return e.startsWith("_") || (t._d = !0), Reflect.set(t, e, i);
      }
    },
    Pt = {
      start: function start(t) {
        return t ? 1 : 0;
      },
      center: function center() {
        return .5;
      },
      end: function end(t) {
        return t ? 0 : 1;
      }
    };
  var Ot = /*#__PURE__*/function (_W3) {
    function Ot() {
      _classCallCheck(this, Ot);
      return _callSuper(this, Ot, arguments);
    }
    _inherits(Ot, _W3);
    return _createClass(Ot, [{
      key: "init",
      value: function init() {
        var _ref19 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
          _ref19$flow = _ref19.flow,
          t = _ref19$flow === void 0 ? "column" : _ref19$flow,
          _ref19$align = _ref19.align,
          e = _ref19$align === void 0 ? "start" : _ref19$align,
          _ref19$justify = _ref19.justify,
          i = _ref19$justify === void 0 ? "start" : _ref19$justify,
          _ref19$colGap = _ref19.colGap,
          s = _ref19$colGap === void 0 ? 0 : _ref19$colGap,
          _ref19$rowGap = _ref19.rowGap,
          n = _ref19$rowGap === void 0 ? 0 : _ref19$rowGap,
          _ref19$numCols = _ref19.numCols,
          h = _ref19$numCols === void 0 ? 1 : _ref19$numCols,
          _ref19$dir = _ref19.dir,
          r = _ref19$dir === void 0 ? "" : _ref19$dir,
          _ref19$breakpoints = _ref19.breakpoints,
          a = _ref19$breakpoints === void 0 ? [] : _ref19$breakpoints,
          o = _objectWithoutProperties(_ref19, _excluded5);
        return _superPropGet(Ot, "init", this, 3)([_objectSpread({
          flow: t,
          align: e,
          justify: i,
          colGap: s,
          rowGap: n,
          numCols: h,
          dir: r,
          breakpoints: a
        }, o)]), this._p(), new Proxy(this, Et);
      }
    }, {
      key: "addChild",
      value: function addChild(t) {
        this._d = !0, _superPropGet(Ot, "addChild", this, 3)([t]);
      }
    }, {
      key: "removeChild",
      value: function removeChild(t) {
        this._d = !0, _superPropGet(Ot, "removeChild", this, 3)([t]);
      }
    }, {
      key: "render",
      value: function render() {
        this._d && this._p(), _superPropGet(Ot, "render", this, 3)([]);
      }
    }, {
      key: "destroy",
      value: function destroy() {
        this.children.map(function (t) {
          return t.destroy && t.destroy();
        });
      }
    }, {
      key: "_p",
      value: function _p() {
        var _this8 = this;
        this._d = !1, this.breakpoints.map(function (t) {
          t.metric.call(_this8) && _this8._b !== t && (_this8._b = t, t.callback.call(_this8));
        });
        var t = this._g = [],
          e = this._cw = [],
          i = this._rh = [],
          s = this.children,
          n = this._nc = "column" == this.flow ? 1 : "row" == this.flow ? s.length : this.numCols,
          h = 0,
          r = 0;
        for (var _a, _o = 0; _a = s[_o]; _o++) {
          t[h] = t[h] || [], _a._p && _a._p();
          var _ref20 = _a.world || _a,
            _s4 = _ref20.width,
            _o2 = _ref20.height;
          i[h] = Math.max(i[h] || 0, _o2);
          var _d = _a.colSpan || 1,
            _c = _d;
          do {
            e[r] = Math.max(e[r] || 0, _s4 / _c), t[h][r] = _a;
          } while (r++ <= n && --_d);
          r >= n && (r = 0, h++);
        }
        for (; r > 0 && r < n;) t[h][r++] = !1;
        var a = t.length,
          o = [].concat(this.colGap),
          d = [].concat(this.rowGap);
        this._w = e.reduce(function (t, e) {
          return t + e;
        }, 0);
        for (var _t3 = 0; _t3 < n - 1; _t3++) this._w += o[_t3 % o.length];
        this._h = i.reduce(function (t, e) {
          return t + e;
        }, 0);
        for (var _t4 = 0; _t4 < a - 1; _t4++) this._h += d[_t4 % d.length];
        this._uw();
        var c = "rtl" == this.context.canvas.dir && !this.dir || "rtl" == this.dir;
        this._rtl = c, c && (this._g = t.map(function (t) {
          return t.reverse();
        }), this._cw = e.reverse(), o = o.reverse());
        var l = -this.anchor.y * this.height,
          u = [],
          p = [].concat(this.justify),
          _ = [].concat(this.align);
        this._g.map(function (t, s) {
          var n = -_this8.anchor.x * _this8.width;
          t.map(function (t, h) {
            if (t && !u.includes(t)) {
              u.push(t);
              var _r = Pt[t.justifySelf || p[h % p.length]](_this8._rtl),
                _a2 = Pt[t.alignSelf || _[s % _.length]](),
                _d2 = t.colSpan || 1,
                _c2 = e[h];
              if (_d2 > 1 && h + _d2 <= _this8._nc) for (var _t5 = 1; _t5 < _d2; _t5++) _c2 += e[h + _t5] + o[(h + _t5) % o.length];
              var _f = _c2 * _r,
                _g = i[s] * _a2,
                _m = 0,
                _w2 = 0,
                _ref21 = t.world || t,
                _x = _ref21.width,
                _y = _ref21.height;
              if (t.anchor && (_m = t.anchor.x, _w2 = t.anchor.y), 0 == _r) _f += _x * _m;else if (.5 == _r) {
                _f += (_m < .5 ? -1 : .5 == _m ? 0 : 1) * _x * _r;
              } else _f -= _x * (1 - _m);
              if (0 == _a2) _g += _y * _w2;else if (.5 == _a2) {
                _g += (_w2 < .5 ? -1 : .5 == _w2 ? 0 : 1) * _y * _a2;
              } else _g -= _y * (1 - _w2);
              t.x = n + _f, t.y = l + _g;
            }
            n += e[h] + o[h % o.length];
          }), l += i[s] + d[s % d.length];
        });
      }
    }]);
  }(W);
  var Lt,
    It = {},
    Dt = {},
    Gt = {},
    Nt = {
      Enter: "enter",
      Escape: "esc",
      Space: "space",
      ArrowLeft: "arrowleft",
      ArrowUp: "arrowup",
      ArrowRight: "arrowright",
      ArrowDown: "arrowdown"
    };
  function Xt() {
    var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : n;
    var e = arguments.length > 1 ? arguments[1] : undefined;
    t._pd && e.preventDefault(), t(e);
  }
  function Yt(t) {
    var e = Nt[t.code],
      i = It[e];
    Gt[e] = !0, Xt(i, t);
  }
  function Tt(t) {
    var e = Nt[t.code],
      i = Dt[e];
    Gt[e] = !1, Xt(i, t);
  }
  function zt() {
    Gt = {};
  }
  function Rt() {
    var t;
    for (t = 0; t < 26; t++) Nt["Key" + String.fromCharCode(t + 65)] = String.fromCharCode(t + 97);
    for (t = 0; t < 10; t++) Nt["Digit" + t] = Nt["Numpad" + t] = "" + t;
    window.addEventListener("keydown", Yt), window.addEventListener("keyup", Tt), window.addEventListener("blur", zt);
  }
  function Wt(t, e) {
    var _ref22 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
      _ref22$handler = _ref22.handler,
      i = _ref22$handler === void 0 ? "keydown" : _ref22$handler,
      _ref22$preventDefault = _ref22.preventDefault,
      s = _ref22$preventDefault === void 0 ? !0 : _ref22$preventDefault;
    var n = "keydown" == i ? It : Dt;
    e._pd = s, [].concat(t).map(function (t) {
      return n[t] = e;
    });
  }
  function Ft(t) {
    var _ref23 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
      _ref23$handler = _ref23.handler,
      e = _ref23$handler === void 0 ? "keydown" : _ref23$handler;
    var i = "keydown" == e ? It : Dt;
    [].concat(t).map(function (t) {
      return delete i[t];
    });
  }
  function Bt(t, e) {
    return Object.values(e).includes(t);
  }
  function Ht(t) {
    return Object.keys(At).some(function (e) {
      return t.startsWith(e);
    });
  }
  function Ut(t) {
    var e = t.substr(t.search(/[A-Z]/));
    return e[0].toLowerCase() + e.substr(1);
  }
  var qt = /*#__PURE__*/function () {
    function qt() {
      var _ref24 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
        t = _ref24.create,
        _ref24$maxSize = _ref24.maxSize,
        e = _ref24$maxSize === void 0 ? 1024 : _ref24$maxSize;
      _classCallCheck(this, qt);
      this._c = t, this.objects = [t()], this.size = 0, this.maxSize = e;
    }
    return _createClass(qt, [{
      key: "get",
      value: function get() {
        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
        if (this.size == this.objects.length) {
          if (this.size == this.maxSize) return;
          for (var _t6 = 0; _t6 < this.size && this.objects.length < this.maxSize; _t6++) this.objects.push(this._c());
        }
        var e = this.objects[this.size];
        return this.size++, e.init(t), e;
      }
    }, {
      key: "getAliveObjects",
      value: function getAliveObjects() {
        return this.objects.slice(0, this.size);
      }
    }, {
      key: "clear",
      value: function clear() {
        this.size = this.objects.length = 0, this.objects.push(this._c());
      }
    }, {
      key: "update",
      value: function update(t) {
        var e,
          i = !1;
        for (var _s5 = this.size; _s5--;) e = this.objects[_s5], e.update(t), e.isAlive() || (i = !0, this.size--);
        i && this.objects.sort(function (t, e) {
          return e.isAlive() - t.isAlive();
        });
      }
    }, {
      key: "render",
      value: function render() {
        for (var _t7 = this.size; _t7--;) this.objects[_t7].render();
      }
    }]);
  }();
  function Kt(t, e) {
    var i = [],
      s = e.x + e.width / 2,
      n = e.y + e.height / 2,
      h = t.y < n,
      r = t.y + t.height >= n;
    return t.x < s && (h && i.push(0), r && i.push(2)), t.x + t.width >= s && (h && i.push(1), r && i.push(3)), i;
  }
  var Vt = /*#__PURE__*/function () {
    function Vt() {
      var _ref25 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
        _ref25$maxDepth = _ref25.maxDepth,
        t = _ref25$maxDepth === void 0 ? 3 : _ref25$maxDepth,
        _ref25$maxObjects = _ref25.maxObjects,
        e = _ref25$maxObjects === void 0 ? 25 : _ref25$maxObjects,
        i = _ref25.bounds;
      _classCallCheck(this, Vt);
      this.maxDepth = t, this.maxObjects = e;
      var s = m();
      this.bounds = i || {
        x: 0,
        y: 0,
        width: s.width,
        height: s.height
      }, this._b = !1, this._d = 0, this._o = [], this._s = [], this._p = null;
    }
    return _createClass(Vt, [{
      key: "clear",
      value: function clear() {
        this._s.map(function (t) {
          t.clear();
        }), this._b = !1, this._o.length = 0;
      }
    }, {
      key: "get",
      value: function get(t) {
        var _this9 = this;
        var e = new Set();
        for (; this._s.length && this._b;) return Kt(t, this.bounds).map(function (i) {
          _this9._s[i].get(t).map(function (t) {
            return e.add(t);
          });
        }), Array.from(e);
        return this._o.filter(function (e) {
          return e !== t;
        });
      }
    }, {
      key: "add",
      value: function add() {
        var _this10 = this;
        for (var _len5 = arguments.length, t = new Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {
          t[_key5] = arguments[_key5];
        }
        t.flat().map(function (t) {
          _this10._b ? _this10._a(t) : (_this10._o.push(t), _this10._o.length > _this10.maxObjects && _this10._d < _this10.maxDepth && (_this10._sp(), _this10._o.map(function (t) {
            return _this10._a(t);
          }), _this10._o.length = 0));
        });
      }
    }, {
      key: "_a",
      value: function _a(t) {
        var _this11 = this;
        Kt(t, this.bounds).map(function (e) {
          _this11._s[e].add(t);
        });
      }
    }, {
      key: "_sp",
      value: function _sp(t, e, i) {
        if (this._b = !0, !this._s.length) for (t = this.bounds.width / 2 | 0, e = this.bounds.height / 2 | 0, i = 0; i < 4; i++) this._s[i] = new Vt({
          bounds: {
            x: this.bounds.x + (i % 2 == 1 ? t : 0),
            y: this.bounds.y + (i >= 2 ? e : 0),
            width: t,
            height: e
          },
          maxDepth: this.maxDepth,
          maxObjects: this.maxObjects
        }), this._s[i]._d = this._d + 1;
      }
    }]);
  }();
  function $t() {
    var _Lt;
    (_Lt = Lt) !== null && _Lt !== void 0 ? _Lt : Lt = Date.now(), Lt |= 0, Lt = Lt + 2654435769 | 0;
    var t = Lt ^ Lt >>> 16;
    return t = Math.imul(t, 569420461), t ^= t >>> 15, t = Math.imul(t, 1935289751), ((t ^= t >>> 15) >>> 0) / 4294967296;
  }
  function Jt(t) {
    var e = [];
    return t._dn ? e.push(t._dn) : t.children && t.children.map(function (t) {
      e = e.concat(Jt(t));
    }), e;
  }
  var Qt = /*#__PURE__*/function () {
    function Qt(_ref26) {
      var _this12 = this;
      var t = _ref26.id,
        _ref26$name = _ref26.name,
        e = _ref26$name === void 0 ? t : _ref26$name,
        _ref26$objects = _ref26.objects,
        s = _ref26$objects === void 0 ? [] : _ref26$objects,
        _ref26$context = _ref26.context,
        n = _ref26$context === void 0 ? w() : _ref26$context,
        _ref26$cullObjects = _ref26.cullObjects,
        r = _ref26$cullObjects === void 0 ? !0 : _ref26$cullObjects,
        _ref26$cullFunction = _ref26.cullFunction,
        o = _ref26$cullFunction === void 0 ? i : _ref26$cullFunction,
        d = _ref26.sortFunction,
        c = _objectWithoutProperties(_ref26, _excluded6);
      _classCallCheck(this, Qt);
      this._o = [], Object.assign(this, _objectSpread({
        id: t,
        name: e,
        context: n,
        cullObjects: r,
        cullFunction: o,
        sortFunction: d
      }, c));
      var l = this._dn = document.createElement("section");
      l.tabIndex = -1, l.style = h, l.id = t, l.setAttribute("aria-label", e);
      var u = this;
      this.camera = new (/*#__PURE__*/function (_W4) {
        function _class2() {
          _classCallCheck(this, _class2);
          return _callSuper(this, _class2, arguments);
        }
        _inherits(_class2, _W4);
        return _createClass(_class2, [{
          key: "x",
          get: function get() {
            return _superPropGet(_class2, "x", this, 1);
          },
          set: function set(t) {
            u.sx = t - this.centerX, _superPropSet(_class2, "x", t, this, 1, 1);
          }
        }, {
          key: "y",
          get: function get() {
            return _superPropGet(_class2, "y", this, 1);
          },
          set: function set(t) {
            u.sy = t - this.centerY, _superPropSet(_class2, "y", t, this, 1, 1);
          }
        }]);
      }(W))({
        context: n,
        anchor: {
          x: .5,
          y: .5
        },
        render: this._rf.bind(this)
      }), this.add(s), this._i = function () {
        var _this12$context;
        (_this12$context = _this12.context) !== null && _this12$context !== void 0 ? _this12$context : _this12.context = w();
        var t = _this12.context.canvas,
          e = t.width,
          i = t.height,
          s = e / 2,
          n = i / 2;
        Object.assign(_this12.camera, {
          centerX: s,
          centerY: n,
          x: s,
          y: n,
          width: e,
          height: i
        }), l.isConnected || a(l, t);
      }, this.context && this._i(), p("init", this._i);
    }
    return _createClass(Qt, [{
      key: "objects",
      get: function get() {
        return this._o;
      },
      set: function set(t) {
        this.remove(this._o), this.add(t);
      }
    }, {
      key: "node",
      get: function get() {
        return this._dn;
      }
    }, {
      key: "add",
      value: function add() {
        var _this13 = this;
        for (var _len6 = arguments.length, t = new Array(_len6), _key6 = 0; _key6 < _len6; _key6++) {
          t[_key6] = arguments[_key6];
        }
        t.flat().map(function (t) {
          var _this13$_dn;
          _this13._o.push(t), t.parent = _this13, (_this13$_dn = _this13._dn).append.apply(_this13$_dn, _toConsumableArray(Jt(t)));
        });
      }
    }, {
      key: "remove",
      value: function remove() {
        var _this14 = this;
        for (var _len7 = arguments.length, t = new Array(_len7), _key7 = 0; _key7 < _len7; _key7++) {
          t[_key7] = arguments[_key7];
        }
        t.flat().map(function (t) {
          o(_this14._o, t), t.parent = null, Jt(t).map(function (t) {
            a(t, _this14.context.canvas);
          });
        });
      }
    }, {
      key: "show",
      value: function show() {
        this.hidden = this._dn.hidden = !1;
        var t = this._o.find(function (t) {
          return t.focus;
        });
        t ? t.focus(r) : this._dn.focus(r), this.onShow();
      }
    }, {
      key: "hide",
      value: function hide() {
        this.hidden = this._dn.hidden = !0, this.onHide();
      }
    }, {
      key: "destroy",
      value: function destroy() {
        _("init", this._i), this._dn.remove(), this._o.map(function (t) {
          return t.destroy && t.destroy();
        });
      }
    }, {
      key: "lookAt",
      value: function lookAt(t) {
        var _ref27 = t.world || t,
          e = _ref27.x,
          i = _ref27.y;
        this.camera.x = e, this.camera.y = i;
      }
    }, {
      key: "update",
      value: function update(t) {
        this.hidden || this._o.map(function (e) {
          return e.update && e.update(t);
        });
      }
    }, {
      key: "_rf",
      value: function _rf() {
        var t = this._o,
          e = this.context,
          i = this._sx,
          s = this._sy,
          n = this.camera,
          h = this.sortFunction,
          r = this.cullObjects,
          a = this.cullFunction;
        e.translate(i, s);
        var o = t;
        r && (o = o.filter(function (t) {
          return a(n, t);
        })), h && o.sort(h), o.map(function (t) {
          return t.render && t.render();
        });
      }
    }, {
      key: "render",
      value: function render() {
        if (!this.hidden) {
          var _t8 = this.context,
            _e2 = this.camera,
            _i3 = _e2.x,
            _s6 = _e2.y,
            _n = _e2.centerX,
            _h = _e2.centerY;
          _t8.save(), this._sx = _n - _i3, this._sy = _h - _s6, _t8.translate(this._sx, this._sy), _e2.render(), _t8.restore();
        }
      }
    }, {
      key: "onShow",
      value: function onShow() {}
    }, {
      key: "onHide",
      value: function onHide() {}
    }]);
  }();
  function Zt(t) {
    if (+t == t) return t;
    var e = [],
      i = t.split(".."),
      s = +i[0],
      n = +i[1],
      h = s;
    if (s < n) for (; h <= n; h++) e.push(h);else for (; h >= n; h--) e.push(h);
    return e;
  }
  var te = /*#__PURE__*/function () {
    function te() {
      var _ref28 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
        t = _ref28.image,
        e = _ref28.frameWidth,
        i = _ref28.frameHeight,
        _ref28$spacing = _ref28.spacing,
        s = _ref28$spacing === void 0 ? 0 : _ref28$spacing,
        _ref28$margin = _ref28.margin,
        n = _ref28$margin === void 0 ? 0 : _ref28$margin,
        h = _ref28.animations;
      _classCallCheck(this, te);
      this.animations = {}, this.image = t, this.frame = {
        width: e,
        height: i,
        spacing: s,
        margin: n
      }, this._f = (t.width - n) / e | 0, this.createAnimations(h);
    }
    return _createClass(te, [{
      key: "createAnimations",
      value: function createAnimations(t) {
        var e, i;
        for (i in t) {
          var _t$i = t[i],
            _s7 = _t$i.frames,
            _n2 = _t$i.frameRate,
            _h2 = _t$i.loop;
          e = [], [].concat(_s7).map(function (t) {
            e = e.concat(Zt(t));
          }), this.animations[i] = y({
            spriteSheet: this,
            frames: e,
            frameRate: _n2,
            loop: _h2,
            name: i
          });
        }
      }
    }]);
  }();
  var ee = 2147483648,
    ie = 1073741824,
    se = 536870912;
  function ne(t, e) {
    return t / e | 0;
  }
  function he(t, e) {
    return t / e | 0;
  }
  var re = /*#__PURE__*/function () {
    function re() {
      var _this15 = this;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
      _classCallCheck(this, re);
      var e = t.width,
        i = t.height,
        s = t.tilewidth,
        n = t.tileheight,
        h = t.tilesets,
        r = e * s,
        a = i * n,
        o = document.createElement("canvas");
      o.width = r, o.height = a, this._c = o, this._ctx = o.getContext("2d"), h.map(function (e) {
        var _window = window,
          i = _window.__k,
          s = _window.location,
          n = (i ? i.dm.get(t) : "") || s.href,
          h = e.source;
        if (h) {
          var _t9 = i.d[i.u(h, n)];
          Object.keys(_t9).map(function (i) {
            e[i] = _t9[i];
          });
        }
        var r = e.image;
        if ("" + r === r) {
          var _t10 = i.i[i.u(r, n)];
          e.image = _t10;
        }
      }), Object.assign(this, _objectSpread({
        context: w(),
        layerMap: {},
        layerCanvases: {},
        mapwidth: r,
        mapheight: a,
        _sx: 0,
        _sy: 0,
        _o: []
      }, t)), this.context && this._p(), p("init", function () {
        var _this15$context;
        (_this15$context = _this15.context) !== null && _this15$context !== void 0 ? _this15$context : _this15.context = w(), _this15._p();
      });
    }
    return _createClass(re, [{
      key: "sx",
      get: function get() {
        return this._sx;
      },
      set: function set(t) {
        var i = Math.max(0, this.mapwidth - m().width);
        this._sx = e(0, i, t);
      }
    }, {
      key: "sy",
      get: function get() {
        return this._sy;
      },
      set: function set(t) {
        var i = Math.max(0, this.mapheight - m().height);
        this._sy = e(0, i, t);
      }
    }, {
      key: "objects",
      get: function get() {
        return this._o;
      },
      set: function set(t) {
        this.remove(this._o), this.add(t);
      }
    }, {
      key: "add",
      value: function add() {
        var _this16 = this;
        for (var _len8 = arguments.length, t = new Array(_len8), _key8 = 0; _key8 < _len8; _key8++) {
          t[_key8] = arguments[_key8];
        }
        t.flat().map(function (t) {
          _this16._o.push(t), t.parent = _this16;
        });
      }
    }, {
      key: "remove",
      value: function remove() {
        var _this17 = this;
        for (var _len9 = arguments.length, t = new Array(_len9), _key9 = 0; _key9 < _len9; _key9++) {
          t[_key9] = arguments[_key9];
        }
        t.flat().map(function (t) {
          o(_this17._o, t), t.parent = null;
        });
      }
    }, {
      key: "getPosition",
      value: function getPosition(t) {
        var e = m().getBoundingClientRect(),
          i = t.x - e.x,
          s = t.y - e.y;
        return i += this.sx, s += this.sy, {
          x: i,
          y: s,
          row: ne(s, this.tileheight),
          col: he(i, this.tilewidth)
        };
      }
    }, {
      key: "setTileAtLayer",
      value: function setTileAtLayer(t, e, i) {
        var s = this.layerMap,
          n = this.tileheight,
          h = this.tilewidth,
          r = this.width,
          a = e.row,
          o = e.col,
          d = e.x,
          c = e.y,
          l = a !== null && a !== void 0 ? a : ne(c, n),
          u = o !== null && o !== void 0 ? o : he(d, h);
        s[t] && (this._d = !0, s[t]._d = !0, s[t].data[l * r + u] = i);
      }
    }, {
      key: "setLayer",
      value: function setLayer(t, e) {
        var i = this.layerMap;
        i[t] && (this._d = !0, i[t]._d = !0, i[t].data = e);
      }
    }, {
      key: "layerCollidesWith",
      value: function layerCollidesWith(t, e) {
        var i = this.tilewidth,
          n = this.tileheight,
          h = this.layerMap,
          _s8 = s(e),
          r = _s8.x,
          a = _s8.y,
          o = _s8.width,
          d = _s8.height,
          c = ne(a, n),
          l = he(r, i),
          u = ne(a + d, n),
          p = he(r + o, i),
          _ = h[t];
        for (var _t11 = c; _t11 <= u; _t11++) for (var _e3 = l; _e3 <= p; _e3++) if (_.data[_e3 + _t11 * this.width]) return !0;
        return !1;
      }
    }, {
      key: "tileAtLayer",
      value: function tileAtLayer(t, e) {
        var i = this.layerMap,
          s = this.tileheight,
          n = this.tilewidth,
          h = this.width,
          r = e.row,
          a = e.col,
          o = e.x,
          d = e.y,
          c = r !== null && r !== void 0 ? r : ne(d, s),
          l = a !== null && a !== void 0 ? a : he(o, n);
        return i[t] ? i[t].data[c * h + l] : -1;
      }
    }, {
      key: "render",
      value: function render() {
        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this._c;
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !0;
        var i = this._d,
          s = this.context,
          _this$sx = this.sx,
          n = _this$sx === void 0 ? 0 : _this$sx,
          _this$sy = this.sy,
          h = _this$sy === void 0 ? 0 : _this$sy;
        i && this._p();
        var _m2 = m(),
          r = _m2.width,
          a = _m2.height,
          o = Math.min(t.width, r),
          d = Math.min(t.height, a);
        s.drawImage(t, n, h, o, d, 0, 0, o, d), e && (s.save(), (n || h) && s.translate(-n, -h), this.objects.map(function (t) {
          return t.render && t.render();
        }), s.restore());
      }
    }, {
      key: "renderLayer",
      value: function renderLayer(t) {
        var _n3;
        var e = this.layerCanvases,
          i = this.layerMap,
          s = i[t],
          n = e[t],
          h = (_n3 = n) === null || _n3 === void 0 ? void 0 : _n3.getContext("2d");
        if (!n) {
          var _i4 = this.mapwidth,
            _r2 = this.mapheight;
          n = document.createElement("canvas"), h = n.getContext("2d"), n.width = _i4, n.height = _r2, e[t] = n, this._rl(s, h);
        }
        s._d && (s._d = !1, h.clearRect(0, 0, n.width, n.height), this._rl(s, h)), this.render(n, !1);
      }
    }, {
      key: "_p",
      value: function _p() {
        var _this18 = this;
        var t = this._ctx,
          _this$layers = this.layers,
          e = _this$layers === void 0 ? [] : _this$layers,
          i = this.layerMap;
        this._d = !1, e.map(function (e) {
          var s = e.name,
            n = e.data,
            h = e.visible;
          e._d = !1, i[s] = e, n && 0 != h && _this18._rl(e, t);
        });
      }
    }, {
      key: "_rl",
      value: function _rl(t, e) {
        var i = t.opacity,
          _t$data = t.data,
          s = _t$data === void 0 ? [] : _t$data,
          n = this.tilesets,
          h = this.width,
          r = this.tilewidth,
          a = this.tileheight;
        e.save(), e.globalAlpha = i, s.map(function (t, i) {
          if (!t) return;
          var s,
            o = 0,
            d = 0,
            c = t & ee,
            l = t & ie,
            u = 0,
            p = 0,
            _ = 0,
            f = 0,
            g = 0;
          o = c || l, g = (t &= 1073741823) & se, g && (c && l ? _ = 1 : c ? u = 1 : l ? p = 1 : f = 1, d = u || p || _ || f, t &= -536870913);
          for (var _e4 = n.length - 1; _e4 >= 0 && (s = n[_e4], !(t / s.firstgid >= 1)); _e4--);
          var _s9 = s,
            m = _s9.image,
            _s9$spacing = _s9.spacing,
            w = _s9$spacing === void 0 ? 0 : _s9$spacing,
            _s9$margin = _s9.margin,
            x = _s9$margin === void 0 ? 0 : _s9$margin,
            y = _s9.firstgid,
            b = _s9.columns,
            v = t - y,
            S = b !== null && b !== void 0 ? b : m.width / (r + w) | 0,
            C = i % h * r,
            A = (i / h | 0) * a,
            k = x + v % S * (r + w),
            j = x + (v / S | 0) * (a + w);
          d ? (e.save(), e.translate(C + r / 2, A + a / 2), p || f ? e.rotate(-Math.PI / 2) : (u || _) && e.rotate(Math.PI / 2), (_ || f) && e.scale(-1, 1), C = -r / 2, A = -a / 2) : o && (e.save(), e.translate(C + (c ? r : 0), A + (l ? a : 0)), e.scale(c ? -1 : 1, l ? -1 : 1), C = o ? 0 : C, A = o ? 0 : A), e.drawImage(m, k, j, r, a, C, A, r, a), (o || d) && e.restore();
        }), e.restore();
      }
    }]);
  }();
  var ae = {
    Animation: y,
    AnimationClass: x,
    imageAssets: I,
    audioAssets: D,
    dataAssets: G,
    setImagePath: function setImagePath(t) {
      k = t;
    },
    setAudioPath: function setAudioPath(t) {
      j = t;
    },
    setDataPath: function setDataPath(t) {
      M = t;
    },
    loadImage: X,
    loadAudio: Y,
    loadData: T,
    load: function load() {
      for (var _len10 = arguments.length, t = new Array(_len10), _key10 = 0; _key10 < _len10; _key10++) {
        t[_key10] = arguments[_key10];
      }
      return N(), Promise.all(t.map(function (t) {
        var e = O([].concat(t)[0]);
        return e.match(b) ? X(t) : e.match(v) ? Y(t) : T(t);
      }));
    },
    Button: function Button() {
      return _construct(dt, Array.prototype.slice.call(arguments));
    },
    ButtonClass: dt,
    init: function init(t) {
      var _ref29 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
        _ref29$contextless = _ref29.contextless,
        e = _ref29$contextless === void 0 ? !1 : _ref29$contextless;
      return c = document.getElementById(t) || t || document.querySelector("canvas"), e && (c = c || new Proxy({}, g)), l = c.getContext("2d") || new Proxy({}, g), l.imageSmoothingEnabled = !1, f("init"), {
        canvas: c,
        context: l
      };
    },
    getCanvas: m,
    getContext: w,
    on: p,
    off: _,
    emit: f,
    GameLoop: function GameLoop() {
      var _ref30 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
        _ref30$fps = _ref30.fps,
        t = _ref30$fps === void 0 ? 60 : _ref30$fps,
        _ref30$clearCanvas = _ref30.clearCanvas,
        e = _ref30$clearCanvas === void 0 ? !0 : _ref30$clearCanvas,
        _ref30$update = _ref30.update,
        i = _ref30$update === void 0 ? n : _ref30$update,
        s = _ref30.render,
        _ref30$context = _ref30.context,
        h = _ref30$context === void 0 ? w() : _ref30$context,
        _ref30$blur = _ref30.blur,
        r = _ref30$blur === void 0 ? !1 : _ref30$blur;
      var a,
        o,
        d,
        c,
        l,
        u = 0,
        _ = 1e3 / t,
        g = 1 / t,
        m = e ? ct : n,
        x = !0;
      function y() {
        if (o = requestAnimationFrame(y), x && (d = performance.now(), c = d - a, a = d, !(c > 1e3))) {
          for (u += c; u >= _;) f("tick"), l.update(g), u -= _;
          m(l.context), l.render();
        }
      }
      return r || (window.addEventListener("focus", function () {
        x = !0;
      }), window.addEventListener("blur", function () {
        x = !1;
      })), p("init", function () {
        var _l, _l$context;
        (_l$context = (_l = l).context) !== null && _l$context !== void 0 ? _l$context : _l.context = w();
      }), l = {
        update: i,
        render: s,
        isStopped: !0,
        context: h,
        start: function start() {
          this.isStopped && (a = performance.now(), this.isStopped = !1, requestAnimationFrame(y));
        },
        stop: function stop() {
          this.isStopped = !0, cancelAnimationFrame(o);
        }
      }, l;
    },
    GameObject: function GameObject() {
      return _construct(W, Array.prototype.slice.call(arguments));
    },
    GameObjectClass: W,
    gamepadMap: _t,
    updateGamepad: wt,
    initGamepad: xt,
    onGamepad: yt,
    offGamepad: bt,
    gamepadPressed: function gamepadPressed(t) {
      var _ref31 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
        e = _ref31.gamepad;
      return isNaN(e) ? lt.some(function (e) {
        return e.pressedButtons[t];
      }) : !!lt[e] && !!lt[e].pressedButtons[t];
    },
    gamepadAxis: function gamepadAxis(t, e) {
      var _lt$e;
      return ((_lt$e = lt[e]) === null || _lt$e === void 0 ? void 0 : _lt$e.axes[t]) || 0;
    },
    gestureMap: At,
    initGesture: kt,
    onGesture: jt,
    offGesture: Mt,
    Grid: function Grid() {
      return _construct(Ot, Array.prototype.slice.call(arguments));
    },
    GridClass: Ot,
    degToRad: function degToRad(t) {
      return t * Math.PI / 180;
    },
    radToDeg: function radToDeg(t) {
      return 180 * t / Math.PI;
    },
    angleToTarget: function angleToTarget(t, e) {
      return Math.atan2(e.y - t.y, e.x - t.x);
    },
    rotatePoint: t,
    movePoint: function movePoint(t, e, i) {
      return {
        x: t.x + Math.cos(e) * i,
        y: t.y + Math.sin(e) * i
      };
    },
    lerp: function lerp(t, e, i) {
      return t * (1 - i) + e * i;
    },
    inverseLerp: function inverseLerp(t, e, i) {
      return (i - t) / (e - t);
    },
    clamp: e,
    setStoreItem: function setStoreItem(t, e) {
      null == e ? localStorage.removeItem(t) : localStorage.setItem(t, JSON.stringify(e));
    },
    getStoreItem: function getStoreItem(t) {
      var e = localStorage.getItem(t);
      try {
        e = JSON.parse(e);
      } catch (t) {}
      return e;
    },
    collides: i,
    getWorldRect: s,
    depthSort: function depthSort(t, e) {
      var _map, _map2;
      var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : "y";
      return _map = [t, e].map(s), _map2 = _slicedToArray(_map, 2), t = _map2[0], e = _map2[1], t[i] - e[i];
    },
    initInput: function initInput() {
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
      Rt();
      var e = ht(t.pointer);
      return kt(), xt(), {
        pointer: e
      };
    },
    onInput: function onInput(t, e) {
      var _ref32 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
        i = _ref32.gamepad,
        s = _ref32.key;
      [].concat(t).map(function (t) {
        Bt(t, _t) ? yt(t, e, i) : Ht(t) ? jt(t, e) : Bt(t, Nt) ? Wt(t, e, s) : ["down", "up"].includes(t) && at(t, e);
      });
    },
    offInput: function offInput(t) {
      var _ref33 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
        e = _ref33.gamepad,
        i = _ref33.key;
      [].concat(t).map(function (t) {
        Bt(t, _t) ? bt(t, e) : Ht(t) ? Mt(t) : Bt(t, Nt) ? Ft(t, i) : ["down", "up"].includes(t) && ot(t);
      });
    },
    keyMap: Nt,
    initKeys: Rt,
    onKey: Wt,
    offKey: Ft,
    keyPressed: function keyPressed(t) {
      return !![].concat(t).some(function (t) {
        return Gt[t];
      });
    },
    registerPlugin: function registerPlugin(t, e) {
      var i = t.prototype;
      i && (i._inc || (i._inc = {}, i._bInc = function (t, e) {
        for (var _len11 = arguments.length, i = new Array(_len11 > 2 ? _len11 - 2 : 0), _key11 = 2; _key11 < _len11; _key11++) {
          i[_key11 - 2] = arguments[_key11];
        }
        return this._inc[e].before.reduce(function (e, i) {
          var s = i.apply(void 0, [t].concat(_toConsumableArray(e)));
          return s || e;
        }, i);
      }, i._aInc = function (t, e, i) {
        for (var _len12 = arguments.length, s = new Array(_len12 > 3 ? _len12 - 3 : 0), _key12 = 3; _key12 < _len12; _key12++) {
          s[_key12 - 3] = arguments[_key12];
        }
        return this._inc[e].after.reduce(function (e, i) {
          var n = i.apply(void 0, [t, e].concat(s));
          return n || e;
        }, i);
      }), Object.getOwnPropertyNames(e).map(function (t) {
        var s = Ut(t);
        i[s] && (i["_o" + s] || (i["_o" + s] = i[s], i[s] = function () {
          var _i5;
          for (var _len13 = arguments.length, t = new Array(_len13), _key13 = 0; _key13 < _len13; _key13++) {
            t[_key13] = arguments[_key13];
          }
          var e = this._bInc.apply(this, [this, s].concat(t)),
            n = (_i5 = i["_o" + s]).call.apply(_i5, [this].concat(_toConsumableArray(e)));
          return this._aInc.apply(this, [this, s, n].concat(t));
        }), i._inc[s] || (i._inc[s] = {
          before: [],
          after: []
        }), t.startsWith("before") ? i._inc[s].before.push(e[t]) : t.startsWith("after") && i._inc[s].after.push(e[t]));
      }));
    },
    unregisterPlugin: function unregisterPlugin(t, e) {
      var i = t.prototype;
      i && i._inc && Object.getOwnPropertyNames(e).map(function (t) {
        var s = Ut(t);
        t.startsWith("before") ? o(i._inc[s].before, e[t]) : t.startsWith("after") && o(i._inc[s].after, e[t]);
      });
    },
    extendObject: function extendObject(t, e) {
      var i = t.prototype;
      i && Object.getOwnPropertyNames(e).map(function (t) {
        i[t] || (i[t] = e[t]);
      });
    },
    initPointer: ht,
    getPointer: function getPointer() {
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : m();
      return q.get(t);
    },
    track: rt,
    untrack: function untrack() {
      for (var _len14 = arguments.length, t = new Array(_len14), _key14 = 0; _key14 < _len14; _key14++) {
        t[_key14] = arguments[_key14];
      }
      t.flat().map(function (t) {
        var e = t.context ? t.context.canvas : m(),
          i = q.get(e);
        t.render = t.__r, t.__r = 0, o(i._o, t);
      });
    },
    pointerOver: function pointerOver(t) {
      var e = t.context ? t.context.canvas : m(),
        i = q.get(e);
      return i._o.includes(t) && J(i) === t;
    },
    onPointer: at,
    offPointer: ot,
    pointerPressed: function pointerPressed(t) {
      return !!V[t];
    },
    Pool: function Pool() {
      return _construct(qt, Array.prototype.slice.call(arguments));
    },
    PoolClass: qt,
    Quadtree: function Quadtree() {
      return _construct(Vt, Array.prototype.slice.call(arguments));
    },
    QuadtreeClass: Vt,
    rand: $t,
    randInt: function randInt(t, e) {
      var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : $t;
      return (i() * (e - t + 1) | 0) + t;
    },
    getSeed: function getSeed() {
      return Lt;
    },
    seedRand: function seedRand() {
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : Date.now();
      if (Lt = t, "string" == typeof t) {
        for (var e = 0, i = 1779033703 ^ t.length; e < t.length; e++) i = (i = Math.imul(i ^ t.charCodeAt(e), 3432918353)) << 13 | i >>> 19;
        i = Math.imul(i ^ i >>> 16, 2246822507), i = Math.imul(i ^ i >>> 13, 3266489909), Lt = (i ^= i >>> 16) >>> 0;
      }
    },
    Scene: function Scene() {
      return _construct(Qt, Array.prototype.slice.call(arguments));
    },
    SceneClass: Qt,
    Sprite: function Sprite() {
      return _construct(F, Array.prototype.slice.call(arguments));
    },
    SpriteClass: F,
    SpriteSheet: function SpriteSheet() {
      return _construct(te, Array.prototype.slice.call(arguments));
    },
    SpriteSheetClass: te,
    Text: U,
    TextClass: H,
    TileEngine: function TileEngine() {
      return _construct(re, Array.prototype.slice.call(arguments));
    },
    TileEngineClass: re,
    Vector: R,
    VectorClass: z
  };
  return ae;
}();