"use strict";var _excluded=["width","height","context","render","update","children","anchor","opacity","rotation","drotation","ddrotation","scaleX","scaleY"],_excluded2=["image","width","height"],_excluded3=["text","textAlign","lineHeight","font"],_excluded4=["padX","padY","text","disabled","container","onDown","onUp"],_excluded5=["flow","align","justify","colGap","rowGap","numCols","dir","breakpoints"],_excluded6=["id","name","objects","context","cullObjects","cullFunction","sortFunction"];function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var r,n,a,o,s=[],h=!0,c=!1;try{if(a=(i=i.call(t)).next,0===e){if(Object(i)!==i)return;h=!1}else for(;!(h=(r=a.call(i)).done)&&(s.push(r.value),s.length!==e);h=!0);}catch(t){c=!0,n=t}finally{try{if(!h&&null!=i.return&&(o=i.return(),Object(o)!==o))return}finally{if(c)throw n}}return s}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _superPropSet(t,e,i,r,n,a){return _set(_getPrototypeOf(a?t.prototype:t),e,i,r,n)}function set(t,e,i,r){return set="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(t,e,i,r){var n,a=_superPropBase(t,e);if(a){if((n=Object.getOwnPropertyDescriptor(a,e)).set)return n.set.call(r,i),!0;if(!n.writable)return!1}if(n=Object.getOwnPropertyDescriptor(r,e)){if(!n.writable)return!1;n.value=i,Object.defineProperty(r,e,n)}else _defineProperty(r,e,i);return!0},set(t,e,i,r)}function _set(t,e,i,r,n){if(!set(t,e,i,r||t)&&n)throw new TypeError("failed to set property");return i}function ownKeys(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(i),!0).forEach((function(e){_defineProperty(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function _defineProperty(t,e,i){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _objectWithoutProperties(t,e){if(null==t)return{};var i,r,n=_objectWithoutPropertiesLoose(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(r=0;r<a.length;r++)i=a[r],e.includes(i)||{}.propertyIsEnumerable.call(t,i)&&(n[i]=t[i])}return n}function _objectWithoutPropertiesLoose(t,e){if(null==t)return{};var i={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.includes(r))continue;i[r]=t[r]}return i}function _callSuper(t,e,i){return e=_getPrototypeOf(e),_possibleConstructorReturn(t,_isNativeReflectConstruct()?Reflect.construct(e,i||[],_getPrototypeOf(t).constructor):e.apply(t,i))}function _possibleConstructorReturn(t,e){if(e&&("object"==_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _superPropGet(t,e,i,r){var n=_get(_getPrototypeOf(1&r?t.prototype:t),e,i);return 2&r&&"function"==typeof n?function(t){return n.apply(i,t)}:n}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var r=_superPropBase(t,e);if(r){var n=Object.getOwnPropertyDescriptor(r,e);return n.get?n.get.call(arguments.length<3?t:i):n.value}},_get.apply(null,arguments)}function _superPropBase(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _construct(t,e,i){if(_isNativeReflectConstruct())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var n=new(t.bind.apply(t,r));return i&&_setPrototypeOf(n,i.prototype),n}function _setPrototypeOf(t,e){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_setPrototypeOf(t,e)}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(_isNativeReflectConstruct=function(){return!!t})()}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_toPropertyKey(r.key),r)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(t,e):void 0}}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=Array(e);i<e;i++)r[i]=t[i];return r}var kontra=function(){function t(t,e){var i=Math.sin(e),r=Math.cos(e);return{x:t.x*r-t.y*i,y:t.x*i+t.y*r}}function e(t,e,i){return Math.min(Math.max(t,i),e)}function i(t,e){var i=r(t),n=r(e);return i.x<n.x+n.width&&i.x+i.width>n.x&&i.y<n.y+n.height&&i.y+i.height>n.y}function r(t){var e=t.world||t,i=e.x,r=void 0===i?0:i,n=e.y,a=void 0===n?0:n,o=e.width,s=e.height;e.radius;return t.mapwidth&&(o=t.mapwidth,s=t.mapheight),t.anchor&&(r-=o*t.anchor.x,a-=s*t.anchor.y),o<0&&(r+=o,o*=-1),s<0&&(a+=s,s*=-1),{x:r,y:a,width:o,height:s}}var n=function(){},a="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);",o={preventScroll:!0};function s(t,e){var i=e.parentNode;t.setAttribute("data-kontra",""),i?(_toConsumableArray(i.querySelectorAll(":scope > [data-kontra]")).pop()||e).after(t):"CANVAS"==e.nodeName?document.body.append(t):e.append(t)}function h(t,e){var i=t.indexOf(e);if(-1!=i)return t.splice(i,1),!0}function c(t,e){var i=r(e),n=i.x,a=i.y,o=i.width,s=i.height;do{n-=e.sx||0,a-=e.sy||0}while(e=e.parent);var h=t.x-Math.max(n,Math.min(t.x,n+o)),c=t.y-Math.max(a,Math.min(t.y,a+s));return h*h+c*c<t.radius*t.radius}var l,u,d={};function f(t,e){d[t]=d[t]||[],d[t].push(e)}function p(t,e){d[t]=(d[t]||[]).filter((function(t){return t!=e}))}function y(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];(d[t]||[]).map((function(t){return t.apply(void 0,i)}))}var v={get:function(t,e){return"_proxy"==e||n}};function g(){return l}function x(){return u}var m=function(){function t(e){var i=e.spriteSheet,r=e.frames,n=e.frameRate,a=e.loop,o=void 0===a||a,s=e.name;_classCallCheck(this,t);var h=i.frame,c=h.width,l=h.height,u=h.spacing,d=void 0===u?0:u,f=h.margin,p=void 0===f?0:f;Object.assign(this,{spriteSheet:i,frames:r,frameRate:n,loop:o,name:s,width:c,height:l,spacing:d,margin:p,isStopped:!1,_f:0,_a:0})}return _createClass(t,[{key:"clone",value:function(){return new t(this)}},{key:"start",value:function(){this.isStopped=!1,this.loop||this.reset()}},{key:"stop",value:function(){this.isStopped=!0}},{key:"reset",value:function(){this._f=0,this._a=0}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/60;if(!this.isStopped)if(this.loop||this._f!=this.frames.length-1)for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate;else this.stop()}},{key:"render",value:function(t){var e=t.x,i=t.y,r=t.width,n=void 0===r?this.width:r,a=t.height,o=void 0===a?this.height:a,s=t.context,h=void 0===s?x():s,c=this.frames[this._f]/this.spriteSheet._f|0,l=this.frames[this._f]%this.spriteSheet._f|0;h.drawImage(this.spriteSheet.image,this.margin+l*this.width+(2*l+1)*this.spacing,this.margin+c*this.height+(2*c+1)*this.spacing,this.width,this.height,e,i,n,o)}}])}();function _(){return _construct(m,Array.prototype.slice.call(arguments))}var w=/(jpeg|jpg|gif|png|webp)$/,b=/(wav|mp3|ogg|aac)$/,k=/^\//,A=/\/$/,S=new WeakMap,j="",C="",P="";function M(t,e){return new URL(t,e).href}function z(t,e){return[t.replace(A,""),t?e.replace(k,""):e].filter((function(t){return t})).join("/")}function D(t){return t.split(".").pop()}function T(t){var e=t.replace("."+D(t),"");return 2==e.split("/").length?e.replace(k,""):e}var I={},O={},L={};function E(){window.__k||(window.__k={dm:S,u:M,d:L,i:I})}function H(t){return E(),new Promise((function(e,i){var r,n,a;if(r=z(j,t),I[r])return e(I[r]);(n=new Image).onload=function(){a=M(r,window.location.href),I[T(t)]=I[r]=I[a]=this,y("assetLoaded",this,t),e(this)},n.onerror=function(){i(r)},n.src=r}))}function W(t){return new Promise((function(e,i){var r,n,a,o,s,h=t;return r=new Audio,n={wav:(s=r).canPlayType('audio/wav; codecs="1"'),mp3:s.canPlayType("audio/mpeg;"),ogg:s.canPlayType('audio/ogg; codecs="vorbis"'),aac:s.canPlayType("audio/aac;")},(t=[].concat(t).reduce((function(t,e){return t||(n[D(e)]?e:null)}),0))?(a=z(C,t),O[a]?e(O[a]):(r.addEventListener("canplay",(function(){o=M(a,window.location.href),O[T(t)]=O[a]=O[o]=this,y("assetLoaded",this,t),e(this)})),r.onerror=function(){i(a)},r.src=a,void r.load())):i(h)}))}function R(t){var e,i;return E(),e=z(P,t),L[e]?Promise.resolve(L[e]):fetch(e).then((function(t){if(!t.ok)throw t;return t.clone().json().catch((function(){return t.text()}))})).then((function(r){return i=M(e,window.location.href),"object"==_typeof(r)&&S.set(r,i),L[T(t)]=L[e]=L[i]=r,y("assetLoaded",r,t),r}))}var B=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};_classCallCheck(this,t),null!=e.x?(this.x=e.x,this.y=e.y):(this.x=e,this.y=i),r._c&&(this.clamp(r._a,r._b,r._d,r._e),this.x=e,this.y=i)}return _createClass(t,[{key:"set",value:function(t){this.x=t.x,this.y=t.y}},{key:"add",value:function(e){return new t(this.x+e.x,this.y+e.y,this)}},{key:"subtract",value:function(e){return new t(this.x-e.x,this.y-e.y,this)}},{key:"scale",value:function(e){return new t(this.x*e,this.y*e)}},{key:"normalize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.length()||1;return new t(this.x/e,this.y/e)}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"length",value:function(){return Math.hypot(this.x,this.y)}},{key:"distance",value:function(t){return Math.hypot(this.x-t.x,this.y-t.y)}},{key:"angle",value:function(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}},{key:"direction",value:function(){return Math.atan2(this.y,this.x)}},{key:"clamp",value:function(t,e,i,r){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=r}},{key:"x",get:function(){return this._x},set:function(t){this._x=this._c?e(this._a,this._d,t):t}},{key:"y",get:function(){return this._y},set:function(t){this._y=this._c?e(this._b,this._e,t):t}}])}();function F(){return _construct(B,Array.prototype.slice.call(arguments))}var Y=function(i){function r(){return _classCallCheck(this,r),_callSuper(this,r,arguments)}return _inherits(r,i),_createClass(r,[{key:"init",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.width,n=void 0===i?0:i,a=e.height,o=void 0===a?0:a,s=e.context,h=void 0===s?x():s,c=e.render,l=void 0===c?this.draw:c,u=e.update,d=void 0===u?this.advance:u,p=e.children,y=void 0===p?[]:p,v=e.anchor,g=void 0===v?{x:0,y:0}:v,m=e.opacity,_=void 0===m?1:m,w=e.rotation,b=void 0===w?0:w,k=e.drotation,A=void 0===k?0:k,S=e.ddrotation,j=void 0===S?0:S,C=e.scaleX,P=void 0===C?1:C,M=e.scaleY,z=void 0===M?1:M,D=_objectWithoutProperties(e,_excluded);this._c=[],_superPropGet(r,"init",this,3)([_objectSpread({width:n,height:o,context:h,anchor:g,opacity:_,rotation:b,drotation:A,ddrotation:j,scaleX:P,scaleY:z},D)]),this._di=!0,this._uw(),this.addChild(y),this._rf=l,this._uf=d,f("init",(function(){var e;null!==(e=t.context)&&void 0!==e||(t.context=x())}))}},{key:"update",value:function(t){this._uf(t),this.children.map((function(e){return e.update&&e.update(t)}))}},{key:"render",value:function(){var t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),1==this.scaleX&&1==this.scaleY||t.scale(this.scaleX,this.scaleY);var e=this.width,i=this.height,r=-e*this.anchor.x,n=-i*this.anchor.y;(r||n)&&t.translate(r,n),this.context.globalAlpha=this.opacity,this._rf(),(r||n)&&t.translate(-r,-n),this.children.map((function(t){return t.render&&t.render()})),t.restore()}},{key:"draw",value:function(){}},{key:"_pc",value:function(){this._uw(),this.children.map((function(t){return t._pc()}))}},{key:"x",get:function(){return this.position.x},set:function(t){this.position.x=t,this._pc()}},{key:"y",get:function(){return this.position.y},set:function(t){this.position.y=t,this._pc()}},{key:"width",get:function(){return this._w},set:function(t){this._w=t,this._pc()}},{key:"height",get:function(){return this._h},set:function(t){this._h=t,this._pc()}},{key:"_uw",value:function(){if(this._di){var e=this.parent||{},i=e._wx,r=void 0===i?0:i,n=e._wy,a=void 0===n?0:n,o=e._wo,s=void 0===o?1:o,h=e._wrot,c=void 0===h?0:h,l=e._wsx,u=void 0===l?1:l,d=e._wsy,f=void 0===d?1:d;this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=s*this.opacity,this._wsx=u*this.scaleX,this._wsy=f*this.scaleY,this._wx=this._wx*u,this._wy=this._wy*f,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wrot=c+this.rotation;var p=t({x:this._wx,y:this._wy},c),y=p.x,v=p.y;this._wx=y,this._wy=v,this._wx+=r,this._wy+=a}}},{key:"world",get:function(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wrot,scaleX:this._wsx,scaleY:this._wsy}}},{key:"children",get:function(){return this._c},set:function(t){this.removeChild(this._c),this.addChild(t)}},{key:"addChild",value:function(){for(var t=this,e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];i.flat().map((function(e){t.children.push(e),e.parent=t,e._pc=e._pc||n,e._pc()}))}},{key:"removeChild",value:function(){for(var t=this,e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];i.flat().map((function(e){h(t.children,e)&&(e.parent=null,e._pc())}))}},{key:"opacity",get:function(){return this._opa},set:function(t){this._opa=e(0,1,t),this._pc()}},{key:"rotation",get:function(){return this._rot},set:function(t){this._rot=t,this._pc()}},{key:"advance",value:function(t){_superPropGet(r,"advance",this,3)([t]),this.drotation+=this.ddrotation,this.rotation+=this.drotation}},{key:"setScale",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;this.scaleX=t,this.scaleY=e}},{key:"scaleX",get:function(){return this._scx},set:function(t){this._scx=t,this._pc()}},{key:"scaleY",get:function(){return this._scy},set:function(t){this._scy=t,this._pc()}}])}(function(){return _createClass((function t(e){return _classCallCheck(this,t),this.init(e)}),[{key:"init",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.position=F(),this.velocity=F(),this.acceleration=F(),this.ttl=1/0,Object.assign(this,t)}},{key:"update",value:function(t){this.advance(t)}},{key:"advance",value:function(t){var e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);var i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}},{key:"dx",get:function(){return this.velocity.x},set:function(t){this.velocity.x=t}},{key:"dy",get:function(){return this.velocity.y},set:function(t){this.velocity.y=t}},{key:"ddx",get:function(){return this.acceleration.x},set:function(t){this.acceleration.x=t}},{key:"ddy",get:function(){return this.acceleration.y},set:function(t){this.acceleration.y=t}},{key:"isAlive",value:function(){return this.ttl>0}},{key:"_pc",value:function(){}}])}()),U=function(t){function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,t),_createClass(e,[{key:"init",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.image,r=t.width,n=void 0===r?i?i.width:void 0:r,a=t.height,o=void 0===a?i?i.height:void 0:a,s=_objectWithoutProperties(t,_excluded2);_superPropGet(e,"init",this,3)([_objectSpread({image:i,width:n,height:o},s)])}},{key:"animations",get:function(){return this._a},set:function(t){var e,i;for(e in this._a={},t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}},{key:"playAnimation",value:function(t){var e;null!==(e=this.currentAnimation)&&void 0!==e&&e.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}},{key:"advance",value:function(t){var i;_superPropGet(e,"advance",this,3)([t]),null===(i=this.currentAnimation)||void 0===i||i.update(t)}},{key:"draw",value:function(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}])}(Y),G=/(\d+)(\w+)/,N=function(t){function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,t),_createClass(e,[{key:"init",value:function(){var t,i=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.text,a=void 0===n?"":n,o=r.textAlign,s=void 0===o?"":o,h=r.lineHeight,c=void 0===h?1:h,l=r.font,u=void 0===l?null===(t=x())||void 0===t?void 0:t.font:l,d=_objectWithoutProperties(r,_excluded3);a=""+a,_superPropGet(e,"init",this,3)([_objectSpread({text:a,textAlign:s,lineHeight:c,font:u},d)]),this.context&&this._p(),f("init",(function(){var t;null!==(t=i.font)&&void 0!==t||(i.font=x().font),i._p()}))}},{key:"width",get:function(){return this._w},set:function(t){this._d=!0,this._w=t,this._fw=t}},{key:"text",get:function(){return this._t},set:function(t){this._d=!0,this._t=""+t}},{key:"font",get:function(){return this._f},set:function(t){this._d=!0,this._f=t,this._fs=function(t){if(!t)return{computed:0};var e=t.match(G),i=+e[1];return{size:i,unit:e[2],computed:i}}(t).computed}},{key:"lineHeight",get:function(){return this._lh},set:function(t){this._d=!0,this._lh=t}},{key:"render",value:function(){this._d&&this._p(),_superPropGet(e,"render",this,3)([])}},{key:"_p",value:function(){var t=this;this._s=[],this._d=!1;var e=this.context,i=[this.text];if(e.font=this.font,i=this.text.split("\n"),this._fw&&i.map((function(i){var r=i.split(" "),n=r.shift(),a=n;r.map((function(i){a+=" "+i,e.measureText(a).width>t._fw&&(t._s.push(n),a=i),n=a})),t._s.push(a)})),!this._s.length&&this.text.includes("\n")){var r=0;i.map((function(i){t._s.push(i),r=Math.max(r,e.measureText(i).width)})),this._w=this._fw||r}this._s.length||(this._s.push(this.text),this._w=this._fw||e.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}},{key:"draw",value:function(){var t,e=this,i=this.textAlign,r=this.context;i=this.textAlign||("rtl"==r.canvas.dir?"right":"left"),t="right"==i?this.width:"center"==i?this.width/2|0:0,this._s.map((function(n,a){var o;r.textBaseline="top",r.textAlign=i,r.fillStyle=e.color,r.font=e.font,e.strokeColor&&(r.strokeStyle=e.strokeColor,r.lineWidth=null!==(o=e.lineWidth)&&void 0!==o?o:1,r.strokeText(n,t,e._fs*e.lineHeight*a)),r.fillText(n,t,e._fs*e.lineHeight*a)}))}}])}(Y);function X(){return _construct(N,Array.prototype.slice.call(arguments))}var q=new WeakMap,V={},K={},Q={0:"left",1:"middle",2:"right"};function $(t){for(var e=t._lf.length?t._lf:t._cf,i=e.length-1;i>=0;i--){var r=e[i];if(r.collidesWithPointer?r.collidesWithPointer(t):c(t,r))return r}}function J(t,e){return parseFloat(t.getPropertyValue(e))||0}function Z(t){var e=null!=t.button?Q[t.button]:"left";K[e]=!0,nt(t,"onDown")}function tt(t){var e=null!=t.button?Q[t.button]:"left";K[e]=!1,nt(t,"onUp")}function et(t){nt(t,"onOver")}function it(t){q.get(t.target)._oo=null,K={}}function rt(t,e,i){var r=$(t);r&&r[e]&&r[e](i),V[e]&&V[e](i,r),"onOver"==e&&(r!=t._oo&&t._oo&&t._oo.onOut&&t._oo.onOut(i),t._oo=r)}function nt(t,e){t.preventDefault();var i=t.target,r=q.get(i),n=function(t){var e=t.canvas,i=t._s,r=e.getBoundingClientRect(),n="none"!=i.transform?i.transform.replace("matrix(","").split(","):[1,1,1,1],a=parseFloat(n[0]),o=parseFloat(n[3]),s=(J(i,"border-left-width")+J(i,"border-right-width"))*a,h=(J(i,"border-top-width")+J(i,"border-bottom-width"))*o,c=(J(i,"padding-left")+J(i,"padding-right"))*a,l=(J(i,"padding-top")+J(i,"padding-bottom"))*o;return{scaleX:(r.width-s-c)/e.width,scaleY:(r.height-h-l)/e.height,offsetX:r.left+(J(i,"border-left-width")+J(i,"padding-left"))*a,offsetY:r.top+(J(i,"border-top-width")+J(i,"padding-top"))*o}}(r),a=n.scaleX,o=n.scaleY,s=n.offsetX,h=n.offsetY;t.type.includes("touch")?(Array.from(t.touches).map((function(t){var e=t.clientX,i=t.clientY,n=t.identifier,c=r.touches[n];c||(c=r.touches[n]={start:{x:(e-s)/a,y:(i-h)/o}},r.touches.length++),c.changed=!1})),Array.from(t.changedTouches).map((function(i){var n=i.clientX,c=i.clientY,l=i.identifier,u=r.touches[l];u.changed=!0,u.x=r.x=(n-s)/a,u.y=r.y=(c-h)/o,rt(r,e,t),y("touchChanged",t,r.touches),"onUp"==e&&(delete r.touches[l],r.touches.length--,r.touches.length||y("touchEnd"))}))):(r.x=(t.clientX-s)/a,r.y=(t.clientY-h)/o,rt(r,e,t))}function at(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.radius,i=void 0===e?5:e,r=t.canvas,n=void 0===r?g():r,a=q.get(n);if(!a){var o=window.getComputedStyle(n);a={x:0,y:0,radius:i,touches:{length:0},canvas:n,_cf:[],_lf:[],_o:[],_oo:null,_s:o},q.set(n,a)}return n.addEventListener("mousedown",Z),n.addEventListener("touchstart",Z),n.addEventListener("mouseup",tt),n.addEventListener("touchend",tt),n.addEventListener("touchcancel",tt),n.addEventListener("blur",it),n.addEventListener("mousemove",et),n.addEventListener("touchmove",et),a._t||(a._t=!0,f("tick",(function(){a._lf.length=0,a._cf.map((function(t){a._lf.push(t)})),a._cf.length=0}))),a}function ot(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];e.flat().map((function(t){var e=t.context?t.context.canvas:g(),i=q.get(e);t.__r||(t.__r=t.render,t.render=function(){i._cf.push(this),this.__r()},i._o.push(t))}))}function st(t,e){var i=t[0].toUpperCase()+t.substr(1);V["on"+i]=e}function ht(t){var e=t[0].toUpperCase()+t.substr(1);V["on"+e]=0}var ct=function(t){function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,t),_createClass(e,[{key:"init",value:function(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=i.padX,o=void 0===r?0:r,h=i.padY,c=void 0===h?0:h,l=i.text,u=i.disabled,d=void 0!==u&&u,f=i.container,p=i.onDown,y=i.onUp,v=_objectWithoutProperties(i,_excluded4);_superPropGet(e,"init",this,3)([_objectSpread({padX:o,padY:c},v)]),this.textNode=X(_objectSpread(_objectSpread({},l),{},{context:this.context})),this.width||(this.width=this.textNode.width,this.height=this.textNode.height),ot(this),this.addChild(this.textNode),this._od=p||n,this._ou=y||n;var g=this._dn=document.createElement("button");g.style=a,g.textContent=this.text,d&&this.disable(),g.addEventListener("focus",(function(){return t.focus()})),g.addEventListener("blur",(function(){return t.blur()})),g.addEventListener("keydown",(function(e){return t._kd(e)})),g.addEventListener("keyup",(function(e){return t._ku(e)})),s(g,null!=f?f:this.context.canvas),this._uw(),this._p()}},{key:"text",get:function(){return this.textNode.text},set:function(t){this._d=!0,this.textNode.text=t}},{key:"node",get:function(){return this._dn}},{key:"destroy",value:function(){this._dn.remove()}},{key:"_p",value:function(){this.text!=this._dn.textContent&&(this._dn.textContent=this.text),this.textNode._p();var t=this.textNode.width+2*this.padX,e=this.textNode.height+2*this.padY;this.width=Math.max(t,this.width),this.height=Math.max(e,this.height),this._uw()}},{key:"render",value:function(){this._d&&this._p(),_superPropGet(e,"render",this,3)([])}},{key:"enable",value:function(){this.disabled=this._dn.disabled=!1,this.onEnable()}},{key:"disable",value:function(){this.disabled=this._dn.disabled=!0,this.onDisable()}},{key:"focus",value:function(){this.disabled||(this.focused=!0,document.activeElement!=this._dn&&this._dn.focus(o),this.onFocus())}},{key:"blur",value:function(){this.focused=!1,document.activeElement==this._dn&&this._dn.blur(),this.onBlur()}},{key:"onOver",value:function(){this.disabled||(this.hovered=!0)}},{key:"onOut",value:function(){this.hovered=!1}},{key:"onEnable",value:function(){}},{key:"onDisable",value:function(){}},{key:"onFocus",value:function(){}},{key:"onBlur",value:function(){}},{key:"onDown",value:function(){this.disabled||(this.pressed=!0,this._od())}},{key:"onUp",value:function(){this.disabled||(this.pressed=!1,this._ou())}},{key:"_kd",value:function(t){"Enter"!=t.code&&"Space"!=t.code||this.onDown()}},{key:"_ku",value:function(t){"Enter"!=t.code&&"Space"!=t.code||this.onUp()}}])}(U);function lt(t){var e=t.canvas;t.clearRect(0,0,e.width,e.height)}var ut=[],dt={},ft={},pt={0:"south",1:"east",2:"west",3:"north",4:"leftshoulder",5:"rightshoulder",6:"lefttrigger",7:"righttrigger",8:"select",9:"start",10:"leftstick",11:"rightstick",12:"dpadup",13:"dpaddown",14:"dpadleft",15:"dpadright"};function yt(t){ut[t.gamepad.index]={pressedButtons:{},axes:{}}}function vt(t){delete ut[t.gamepad.index]}function gt(){ut.map((function(t){t.pressedButtons={},t.axes={}}))}function xt(){for(var t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[],e=function(){var e=t[i];if(!e)return 1;e.buttons.map((function(t,i){var r=pt[i],n=t.pressed,a=ut[e.index].pressedButtons,o=a[r];!o&&n?[dt[e.index],dt].map((function(i){var n;null==i||null===(n=i[r])||void 0===n||n.call(i,e,t,r)})):o&&!n&&[ft[e.index],ft].map((function(i){var n;null==i||null===(n=i[r])||void 0===n||n.call(i,e,t,r)})),a[r]=n}));var r=ut[e.index].axes;r.leftstickx=e.axes[0],r.leftsticky=e.axes[1],r.rightstickx=e.axes[2],r.rightsticky=e.axes[3]},i=0;i<t.length;i++)e()}function mt(){window.addEventListener("gamepadconnected",yt),window.addEventListener("gamepaddisconnected",vt),window.addEventListener("blur",gt),f("tick",xt)}function _t(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=i.gamepad,n=i.handler,a="gamepaddown"==(void 0===n?"gamepaddown":n)?dt:ft;[].concat(t).map((function(t){isNaN(r)?a[t]=e:(a[r]=a[r]||{},a[r][t]=e)}))}function wt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.gamepad,r=e.handler,n="gamepaddown"==(void 0===r?"gamepaddown":r)?dt:ft;[].concat(t).map((function(t){isNaN(i)?delete n[t]:(n[i]=n[i]||{},delete n[i][t])}))}var bt,kt={},At=!1,St={swipe:{touches:1,threshold:10,touchend:function(t){var e=t[0],i=e.x-e.start.x,r=e.y-e.start.y,n=Math.abs(i),a=Math.abs(r);if(!(n<this.threshold&&a<this.threshold))return n>a?i<0?"left":"right":r<0?"up":"down"}},pinch:{touches:2,threshold:2,touchstart:function(t){var e=t[0],i=t[1];this.prevDist=Math.hypot(e.x-i.x,e.y-i.y)},touchmove:function(t){var e=t[0],i=t[1],r=Math.hypot(e.x-i.x,e.y-i.y);if(!(Math.abs(r-this.prevDist)<this.threshold)){var n=r>this.prevDist?"out":"in";return this.prevDist=r,n}}}};function jt(){At||(At=!0,f("touchChanged",(function(t,e){Object.keys(St).map((function(i){var r,n,a,o=St[i];(!bt||bt==i)&&e.length==o.touches&&_toConsumableArray(Array(e.length).keys()).every((function(t){return e[t]}))&&(a=null!==(r=null===(n=o[t.type])||void 0===n?void 0:n.call(o,e))&&void 0!==r?r:"")&&kt[i+a]&&(bt=i,kt[i+a](t,e))}))})),f("touchEnd",(function(){bt=0})))}function Ct(t,e){[].concat(t).map((function(t){kt[t]=e}))}function Pt(t){[].concat(t).map((function(t){kt[t]=0}))}var Mt,zt={set:function(t,e,i){return e.startsWith("_")||(t._d=!0),Reflect.set(t,e,i)}},Dt={start:function(t){return t?1:0},center:function(){return.5},end:function(t){return t?0:1}},Tt=function(t){function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,t),_createClass(e,[{key:"init",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.flow,r=void 0===i?"column":i,n=t.align,a=void 0===n?"start":n,o=t.justify,s=void 0===o?"start":o,h=t.colGap,c=void 0===h?0:h,l=t.rowGap,u=void 0===l?0:l,d=t.numCols,f=void 0===d?1:d,p=t.dir,y=void 0===p?"":p,v=t.breakpoints,g=void 0===v?[]:v,x=_objectWithoutProperties(t,_excluded5);return _superPropGet(e,"init",this,3)([_objectSpread({flow:r,align:a,justify:s,colGap:c,rowGap:u,numCols:f,dir:y,breakpoints:g},x)]),this._p(),new Proxy(this,zt)}},{key:"addChild",value:function(t){this._d=!0,_superPropGet(e,"addChild",this,3)([t])}},{key:"removeChild",value:function(t){this._d=!0,_superPropGet(e,"removeChild",this,3)([t])}},{key:"render",value:function(){this._d&&this._p(),_superPropGet(e,"render",this,3)([])}},{key:"destroy",value:function(){this.children.map((function(t){return t.destroy&&t.destroy()}))}},{key:"_p",value:function(){var t=this;this._d=!1,this.breakpoints.map((function(e){e.metric.call(t)&&t._b!==e&&(t._b=e,e.callback.call(t))}));for(var e,i=this._g=[],r=this._cw=[],n=this._rh=[],a=this.children,o=this._nc="column"==this.flow?1:"row"==this.flow?a.length:this.numCols,s=0,h=0,c=0;e=a[c];c++){i[s]=i[s]||[],e._p&&e._p();var l=e.world||e,u=l.width,d=l.height;n[s]=Math.max(n[s]||0,d);var f=e.colSpan||1,p=f;do{r[h]=Math.max(r[h]||0,u/p),i[s][h]=e}while(h++<=o&&--f);h>=o&&(h=0,s++)}for(;h>0&&h<o;)i[s][h++]=!1;var y=i.length,v=[].concat(this.colGap),g=[].concat(this.rowGap);this._w=r.reduce((function(t,e){return t+e}),0);for(var x=0;x<o-1;x++)this._w+=v[x%v.length];this._h=n.reduce((function(t,e){return t+e}),0);for(var m=0;m<y-1;m++)this._h+=g[m%g.length];this._uw();var _="rtl"==this.context.canvas.dir&&!this.dir||"rtl"==this.dir;this._rtl=_,_&&(this._g=i.map((function(t){return t.reverse()})),this._cw=r.reverse(),v=v.reverse());var w=-this.anchor.y*this.height,b=[],k=[].concat(this.justify),A=[].concat(this.align);this._g.map((function(e,i){var a=-t.anchor.x*t.width;e.map((function(e,o){if(e&&!b.includes(e)){b.push(e);var s=Dt[e.justifySelf||k[o%k.length]](t._rtl),h=Dt[e.alignSelf||A[i%A.length]](),c=e.colSpan||1,l=r[o];if(c>1&&o+c<=t._nc)for(var u=1;u<c;u++)l+=r[o+u]+v[(o+u)%v.length];var d=l*s,f=n[i]*h,p=0,y=0,g=e.world||e,x=g.width,m=g.height;e.anchor&&(p=e.anchor.x,y=e.anchor.y),0==s?d+=x*p:.5==s?d+=(p<.5?-1:.5==p?0:1)*x*s:d-=x*(1-p),0==h?f+=m*y:.5==h?f+=(y<.5?-1:.5==y?0:1)*m*h:f-=m*(1-y),e.x=a+d,e.y=w+f}a+=r[o]+v[o%v.length]})),w+=n[i]+g[i%g.length]}))}}])}(Y),It={},Ot={},Lt={},Et={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function Ht(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n,e=arguments.length>1?arguments[1]:void 0;t._pd&&e.preventDefault(),t(e)}function Wt(t){var e=Et[t.code],i=It[e];Lt[e]=!0,Ht(i,t)}function Rt(t){var e=Et[t.code],i=Ot[e];Lt[e]=!1,Ht(i,t)}function Bt(){Lt={}}function Ft(){var t;for(t=0;t<26;t++)Et["Key"+String.fromCharCode(t+65)]=String.fromCharCode(t+97);for(t=0;t<10;t++)Et["Digit"+t]=Et["Numpad"+t]=""+t;window.addEventListener("keydown",Wt),window.addEventListener("keyup",Rt),window.addEventListener("blur",Bt)}function Yt(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=i.handler,n=void 0===r?"keydown":r,a=i.preventDefault,o=void 0===a||a,s="keydown"==n?It:Ot;e._pd=o,[].concat(t).map((function(t){return s[t]=e}))}function Ut(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).handler,i="keydown"==(void 0===e?"keydown":e)?It:Ot;[].concat(t).map((function(t){return delete i[t]}))}function Gt(t,e){return Object.values(e).includes(t)}function Nt(t){return Object.keys(St).some((function(e){return t.startsWith(e)}))}function Xt(t){var e=t.substr(t.search(/[A-Z]/));return e[0].toLowerCase()+e.substr(1)}var qt=function(){return _createClass((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.create,r=e.maxSize,n=void 0===r?1024:r;_classCallCheck(this,t),this._c=i,this.objects=[i()],this.size=0,this.maxSize=n}),[{key:"get",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.size==this.objects.length){if(this.size==this.maxSize)return;for(var e=0;e<this.size&&this.objects.length<this.maxSize;e++)this.objects.push(this._c())}var i=this.objects[this.size];return this.size++,i.init(t),i}},{key:"getAliveObjects",value:function(){return this.objects.slice(0,this.size)}},{key:"clear",value:function(){this.size=this.objects.length=0,this.objects.push(this._c())}},{key:"update",value:function(t){for(var e,i=!1,r=this.size;r--;)(e=this.objects[r]).update(t),e.isAlive()||(i=!0,this.size--);i&&this.objects.sort((function(t,e){return e.isAlive()-t.isAlive()}))}},{key:"render",value:function(){for(var t=this.size;t--;)this.objects[t].render()}}])}();function Vt(t,e){var i=[],r=e.x+e.width/2,n=e.y+e.height/2,a=t.y<n,o=t.y+t.height>=n;return t.x<r&&(a&&i.push(0),o&&i.push(2)),t.x+t.width>=r&&(a&&i.push(1),o&&i.push(3)),i}var Kt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.maxDepth,r=void 0===i?3:i,n=e.maxObjects,a=void 0===n?25:n,o=e.bounds;_classCallCheck(this,t),this.maxDepth=r,this.maxObjects=a;var s=g();this.bounds=o||{x:0,y:0,width:s.width,height:s.height},this._b=!1,this._d=0,this._o=[],this._s=[],this._p=null}return _createClass(t,[{key:"clear",value:function(){this._s.map((function(t){t.clear()})),this._b=!1,this._o.length=0}},{key:"get",value:function(t){for(var e=this,i=new Set;this._s.length&&this._b;)return Vt(t,this.bounds).map((function(r){e._s[r].get(t).map((function(t){return i.add(t)}))})),Array.from(i);return this._o.filter((function(e){return e!==t}))}},{key:"add",value:function(){for(var t=this,e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];i.flat().map((function(e){t._b?t._a(e):(t._o.push(e),t._o.length>t.maxObjects&&t._d<t.maxDepth&&(t._sp(),t._o.map((function(e){return t._a(e)})),t._o.length=0))}))}},{key:"_a",value:function(t){var e=this;Vt(t,this.bounds).map((function(i){e._s[i].add(t)}))}},{key:"_sp",value:function(e,i,r){if(this._b=!0,!this._s.length)for(e=this.bounds.width/2|0,i=this.bounds.height/2|0,r=0;r<4;r++)this._s[r]=new t({bounds:{x:this.bounds.x+(r%2==1?e:0),y:this.bounds.y+(r>=2?i:0),width:e,height:i},maxDepth:this.maxDepth,maxObjects:this.maxObjects}),this._s[r]._d=this._d+1}}])}();function Qt(){var t;null!==(t=Mt)&&void 0!==t||(Mt=Date.now());var e=(Mt=(Mt|=0)+2654435769|0)^Mt>>>16;return e=Math.imul(e,569420461),e^=e>>>15,e=Math.imul(e,1935289751),((e^=e>>>15)>>>0)/4294967296}function $t(t){var e=[];return t._dn?e.push(t._dn):t.children&&t.children.map((function(t){e=e.concat($t(t))})),e}var Jt=function(){return _createClass((function t(e){var r=this,n=e.id,o=e.name,h=void 0===o?n:o,c=e.objects,l=void 0===c?[]:c,u=e.context,d=void 0===u?x():u,p=e.cullObjects,y=void 0===p||p,v=e.cullFunction,g=void 0===v?i:v,m=e.sortFunction,_=_objectWithoutProperties(e,_excluded6);_classCallCheck(this,t),this._o=[],Object.assign(this,_objectSpread({id:n,name:h,context:d,cullObjects:y,cullFunction:g,sortFunction:m},_));var w=this._dn=document.createElement("section");w.tabIndex=-1,w.style=a,w.id=n,w.setAttribute("aria-label",h);var b=this;this.camera=new(function(t){function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,t),_createClass(e,[{key:"x",get:function(){return _superPropGet(e,"x",this,1)},set:function(t){b.sx=t-this.centerX,_superPropSet(e,"x",t,this,1,1)}},{key:"y",get:function(){return _superPropGet(e,"y",this,1)},set:function(t){b.sy=t-this.centerY,_superPropSet(e,"y",t,this,1,1)}}])}(Y))({context:d,anchor:{x:.5,y:.5},render:this._rf.bind(this)}),this.add(l),this._i=function(){var t;null!==(t=r.context)&&void 0!==t||(r.context=x());var e=r.context.canvas,i=e.width,n=e.height,a=i/2,o=n/2;Object.assign(r.camera,{centerX:a,centerY:o,x:a,y:o,width:i,height:n}),w.isConnected||s(w,e)},this.context&&this._i(),f("init",this._i)}),[{key:"objects",get:function(){return this._o},set:function(t){this.remove(this._o),this.add(t)}},{key:"node",get:function(){return this._dn}},{key:"add",value:function(){for(var t=this,e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];i.flat().map((function(e){var i;t._o.push(e),e.parent=t,(i=t._dn).append.apply(i,_toConsumableArray($t(e)))}))}},{key:"remove",value:function(){for(var t=this,e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];i.flat().map((function(e){h(t._o,e),e.parent=null,$t(e).map((function(e){s(e,t.context.canvas)}))}))}},{key:"show",value:function(){this.hidden=this._dn.hidden=!1;var t=this._o.find((function(t){return t.focus}));t?t.focus(o):this._dn.focus(o),this.onShow()}},{key:"hide",value:function(){this.hidden=this._dn.hidden=!0,this.onHide()}},{key:"destroy",value:function(){p("init",this._i),this._dn.remove(),this._o.map((function(t){return t.destroy&&t.destroy()}))}},{key:"lookAt",value:function(t){var e=t.world||t,i=e.x,r=e.y;this.camera.x=i,this.camera.y=r}},{key:"update",value:function(t){this.hidden||this._o.map((function(e){return e.update&&e.update(t)}))}},{key:"_rf",value:function(){var t=this._o,e=this.context,i=this._sx,r=this._sy,n=this.camera,a=this.sortFunction,o=this.cullObjects,s=this.cullFunction;e.translate(i,r);var h=t;o&&(h=h.filter((function(t){return s(n,t)}))),a&&h.sort(a),h.map((function(t){return t.render&&t.render()}))}},{key:"render",value:function(){if(!this.hidden){var t=this.context,e=this.camera,i=e.x,r=e.y,n=e.centerX,a=e.centerY;t.save(),this._sx=n-i,this._sy=a-r,t.translate(this._sx,this._sy),e.render(),t.restore()}}},{key:"onShow",value:function(){}},{key:"onHide",value:function(){}}])}();function Zt(t){if(+t==t)return t;var e=[],i=t.split(".."),r=+i[0],n=+i[1],a=r;if(r<n)for(;a<=n;a++)e.push(a);else for(;a>=n;a--)e.push(a);return e}var te=function(){return _createClass((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.image,r=e.frameWidth,n=e.frameHeight,a=e.spacing,o=void 0===a?0:a,s=e.margin,h=void 0===s?0:s,c=e.animations;_classCallCheck(this,t),this.animations={},this.image=i,this.frame={width:r,height:n,spacing:o,margin:h},this._f=(i.width-h)/r|0,this.createAnimations(c)}),[{key:"createAnimations",value:function(t){var e,i;for(i in t){var r=t[i],n=r.frames,a=r.frameRate,o=r.loop;e=[],[].concat(n).map((function(t){e=e.concat(Zt(t))})),this.animations[i]=_({spriteSheet:this,frames:e,frameRate:a,loop:o,name:i})}}}])}();function ee(t,e){return t/e|0}function ie(t,e){return t/e|0}var re=function(){return _createClass((function t(){var e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=i.width,n=i.height,a=i.tilewidth,o=i.tileheight,s=i.tilesets,h=r*a,c=n*o,l=document.createElement("canvas");l.width=h,l.height=c,this._c=l,this._ctx=l.getContext("2d"),s.map((function(t){var e=window,r=e.__k,n=e.location,a=(r?r.dm.get(i):"")||n.href,o=t.source;if(o){var s=r.d[r.u(o,a)];Object.keys(s).map((function(e){t[e]=s[e]}))}var h=t.image;if(""+h===h){var c=r.i[r.u(h,a)];t.image=c}})),Object.assign(this,_objectSpread({context:x(),layerMap:{},layerCanvases:{},mapwidth:h,mapheight:c,_sx:0,_sy:0,_o:[]},i)),this.context&&this._p(),f("init",(function(){var t;null!==(t=e.context)&&void 0!==t||(e.context=x()),e._p()}))}),[{key:"sx",get:function(){return this._sx},set:function(t){var i=Math.max(0,this.mapwidth-g().width);this._sx=e(0,i,t)}},{key:"sy",get:function(){return this._sy},set:function(t){var i=Math.max(0,this.mapheight-g().height);this._sy=e(0,i,t)}},{key:"objects",get:function(){return this._o},set:function(t){this.remove(this._o),this.add(t)}},{key:"add",value:function(){for(var t=this,e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];i.flat().map((function(e){t._o.push(e),e.parent=t}))}},{key:"remove",value:function(){for(var t=this,e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];i.flat().map((function(e){h(t._o,e),e.parent=null}))}},{key:"getPosition",value:function(t){var e=g().getBoundingClientRect(),i=t.x-e.x,r=t.y-e.y;return{x:i+=this.sx,y:r+=this.sy,row:ee(r,this.tileheight),col:ie(i,this.tilewidth)}}},{key:"setTileAtLayer",value:function(t,e,i){var r=this.layerMap,n=this.tileheight,a=this.tilewidth,o=this.width,s=e.row,h=e.col,c=e.x,l=e.y,u=null!=s?s:ee(l,n),d=null!=h?h:ie(c,a);r[t]&&(this._d=!0,r[t]._d=!0,r[t].data[u*o+d]=i)}},{key:"setLayer",value:function(t,e){var i=this.layerMap;i[t]&&(this._d=!0,i[t]._d=!0,i[t].data=e)}},{key:"layerCollidesWith",value:function(t,e){for(var i=this.tilewidth,n=this.tileheight,a=this.layerMap,o=r(e),s=o.x,h=o.y,c=o.width,l=o.height,u=ee(h,n),d=ie(s,i),f=ee(h+l,n),p=ie(s+c,i),y=a[t],v=u;v<=f;v++)for(var g=d;g<=p;g++)if(y.data[g+v*this.width])return!0;return!1}},{key:"tileAtLayer",value:function(t,e){var i=this.layerMap,r=this.tileheight,n=this.tilewidth,a=this.width,o=e.row,s=e.col,h=e.x,c=e.y,l=null!=o?o:ee(c,r),u=null!=s?s:ie(h,n);return i[t]?i[t].data[l*a+u]:-1}},{key:"render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._c,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this._d,r=this.context,n=this.sx,a=void 0===n?0:n,o=this.sy,s=void 0===o?0:o;i&&this._p();var h=g(),c=h.width,l=h.height,u=Math.min(t.width,c),d=Math.min(t.height,l);r.drawImage(t,a,s,u,d,0,0,u,d),e&&(r.save(),(a||s)&&r.translate(-a,-s),this.objects.map((function(t){return t.render&&t.render()})),r.restore())}},{key:"renderLayer",value:function(t){var e,i=this.layerCanvases,r=this.layerMap[t],n=i[t],a=null===(e=n)||void 0===e?void 0:e.getContext("2d");if(!n){var o=this.mapwidth,s=this.mapheight;a=(n=document.createElement("canvas")).getContext("2d"),n.width=o,n.height=s,i[t]=n,this._rl(r,a)}r._d&&(r._d=!1,a.clearRect(0,0,n.width,n.height),this._rl(r,a)),this.render(n,!1)}},{key:"_p",value:function(){var t=this,e=this._ctx,i=this.layers,r=void 0===i?[]:i,n=this.layerMap;this._d=!1,r.map((function(i){var r=i.name,a=i.data,o=i.visible;i._d=!1,n[r]=i,a&&0!=o&&t._rl(i,e)}))}},{key:"_rl",value:function(t,e){var i=t.opacity,r=t.data,n=void 0===r?[]:r,a=this.tilesets,o=this.width,s=this.tilewidth,h=this.tileheight;e.save(),e.globalAlpha=i,n.map((function(t,i){if(t){var r,n,c=0,l=2147483648&t,u=1073741824&t,d=0,f=0,p=0,y=0;n=l||u,536870912&(t&=1073741823)&&(l&&u?p=1:l?d=1:u?f=1:y=1,c=d||f||p||y,t&=-536870913);for(var v=a.length-1;v>=0&&!(t/(r=a[v]).firstgid>=1);v--);var g=r,x=g.image,m=g.spacing,_=void 0===m?0:m,w=g.margin,b=void 0===w?0:w,k=g.firstgid,A=g.columns,S=t-k,j=null!=A?A:x.width/(s+_)|0,C=i%o*s,P=(i/o|0)*h,M=b+S%j*(s+_),z=b+(S/j|0)*(h+_);c?(e.save(),e.translate(C+s/2,P+h/2),f||y?e.rotate(-Math.PI/2):(d||p)&&e.rotate(Math.PI/2),(p||y)&&e.scale(-1,1),C=-s/2,P=-h/2):n&&(e.save(),e.translate(C+(l?s:0),P+(u?h:0)),e.scale(l?-1:1,u?-1:1),C=n?0:C,P=n?0:P),e.drawImage(x,M,z,s,h,C,P,s,h),(n||c)&&e.restore()}})),e.restore()}}])}(),ne={Animation:_,AnimationClass:m,imageAssets:I,audioAssets:O,dataAssets:L,setImagePath:function(t){j=t},setAudioPath:function(t){C=t},setDataPath:function(t){P=t},loadImage:H,loadAudio:W,loadData:R,load:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return E(),Promise.all(e.map((function(t){var e=D([].concat(t)[0]);return e.match(w)?H(t):e.match(b)?W(t):R(t)})))},Button:function(){return _construct(ct,Array.prototype.slice.call(arguments))},ButtonClass:ct,init:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).contextless,i=void 0!==e&&e;return l=document.getElementById(t)||t||document.querySelector("canvas"),i&&(l=l||new Proxy({},v)),(u=l.getContext("2d")||new Proxy({},v)).imageSmoothingEnabled=!1,y("init"),{canvas:l,context:u}},getCanvas:g,getContext:x,on:f,off:p,emit:y,GameLoop:function(){var t,e,i,r,a,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=o.fps,h=void 0===s?60:s,c=o.clearCanvas,l=void 0===c||c,u=o.update,d=void 0===u?n:u,p=o.render,v=o.context,g=void 0===v?x():v,m=o.blur,_=0,w=1e3/h,b=1/h,k=l?lt:n,A=!0;function S(){if(e=requestAnimationFrame(S),A&&(i=performance.now(),r=i-t,t=i,!(r>1e3))){for(_+=r;_>=w;)y("tick"),a.update(b),_-=w;k(a.context),a.render()}}return void 0!==m&&m||(window.addEventListener("focus",(function(){A=!0})),window.addEventListener("blur",(function(){A=!1}))),f("init",(function(){var t,e;null!==(e=(t=a).context)&&void 0!==e||(t.context=x())})),a={update:d,render:p,isStopped:!0,context:g,start:function(){this.isStopped&&(t=performance.now(),this.isStopped=!1,requestAnimationFrame(S))},stop:function(){this.isStopped=!0,cancelAnimationFrame(e)}}},GameObject:function(){return _construct(Y,Array.prototype.slice.call(arguments))},GameObjectClass:Y,gamepadMap:pt,updateGamepad:xt,initGamepad:mt,onGamepad:_t,offGamepad:wt,gamepadPressed:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).gamepad;return isNaN(e)?ut.some((function(e){return e.pressedButtons[t]})):!!ut[e]&&!!ut[e].pressedButtons[t]},gamepadAxis:function(t,e){var i;return(null===(i=ut[e])||void 0===i?void 0:i.axes[t])||0},gestureMap:St,initGesture:jt,onGesture:Ct,offGesture:Pt,Grid:function(){return _construct(Tt,Array.prototype.slice.call(arguments))},GridClass:Tt,degToRad:function(t){return t*Math.PI/180},radToDeg:function(t){return 180*t/Math.PI},angleToTarget:function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)},rotatePoint:t,movePoint:function(t,e,i){return{x:t.x+Math.cos(e)*i,y:t.y+Math.sin(e)*i}},lerp:function(t,e,i){return t*(1-i)+e*i},inverseLerp:function(t,e,i){return(i-t)/(e-t)},clamp:e,setStoreItem:function(t,e){null==e?localStorage.removeItem(t):localStorage.setItem(t,JSON.stringify(e))},getStoreItem:function(t){var e=localStorage.getItem(t);try{e=JSON.parse(e)}catch(t){}return e},collides:i,getWorldRect:r,depthSort:function(t,e){var i,n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"y";return i=[t,e].map(r),t=(n=_slicedToArray(i,2))[0],e=n[1],t[a]-e[a]},initInput:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Ft();var e=at(t.pointer);return jt(),mt(),{pointer:e}},onInput:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=i.gamepad,n=i.key;[].concat(t).map((function(t){Gt(t,pt)?_t(t,e,r):Nt(t)?Ct(t,e):Gt(t,Et)?Yt(t,e,n):["down","up"].includes(t)&&st(t,e)}))},offInput:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.gamepad,r=e.key;[].concat(t).map((function(t){Gt(t,pt)?wt(t,i):Nt(t)?Pt(t):Gt(t,Et)?Ut(t,r):["down","up"].includes(t)&&ht(t)}))},keyMap:Et,initKeys:Ft,onKey:Yt,offKey:Ut,keyPressed:function(t){return!![].concat(t).some((function(t){return Lt[t]}))},registerPlugin:function(t,e){var i=t.prototype;i&&(i._inc||(i._inc={},i._bInc=function(t,e){for(var i=arguments.length,r=new Array(i>2?i-2:0),n=2;n<i;n++)r[n-2]=arguments[n];return this._inc[e].before.reduce((function(e,i){return i.apply(void 0,[t].concat(_toConsumableArray(e)))||e}),r)},i._aInc=function(t,e,i){for(var r=arguments.length,n=new Array(r>3?r-3:0),a=3;a<r;a++)n[a-3]=arguments[a];return this._inc[e].after.reduce((function(e,i){return i.apply(void 0,[t,e].concat(n))||e}),i)}),Object.getOwnPropertyNames(e).map((function(t){var r=Xt(t);i[r]&&(i["_o"+r]||(i["_o"+r]=i[r],i[r]=function(){for(var t,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];var o=this._bInc.apply(this,[this,r].concat(n)),s=(t=i["_o"+r]).call.apply(t,[this].concat(_toConsumableArray(o)));return this._aInc.apply(this,[this,r,s].concat(n))}),i._inc[r]||(i._inc[r]={before:[],after:[]}),t.startsWith("before")?i._inc[r].before.push(e[t]):t.startsWith("after")&&i._inc[r].after.push(e[t]))})))},unregisterPlugin:function(t,e){var i=t.prototype;i&&i._inc&&Object.getOwnPropertyNames(e).map((function(t){var r=Xt(t);t.startsWith("before")?h(i._inc[r].before,e[t]):t.startsWith("after")&&h(i._inc[r].after,e[t])}))},extendObject:function(t,e){var i=t.prototype;i&&Object.getOwnPropertyNames(e).map((function(t){i[t]||(i[t]=e[t])}))},initPointer:at,getPointer:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g();return q.get(t)},track:ot,untrack:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];e.flat().map((function(t){var e=t.context?t.context.canvas:g(),i=q.get(e);t.render=t.__r,t.__r=0,h(i._o,t)}))},pointerOver:function(t){var e=t.context?t.context.canvas:g(),i=q.get(e);return i._o.includes(t)&&$(i)===t},onPointer:st,offPointer:ht,pointerPressed:function(t){return!!K[t]},Pool:function(){return _construct(qt,Array.prototype.slice.call(arguments))},PoolClass:qt,Quadtree:function(){return _construct(Kt,Array.prototype.slice.call(arguments))},QuadtreeClass:Kt,rand:Qt,randInt:function(t,e){return((arguments.length>2&&void 0!==arguments[2]?arguments[2]:Qt)()*(e-t+1)|0)+t},getSeed:function(){return Mt},seedRand:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now();if(Mt=t,"string"==typeof t){for(var e=0,i=1779033703^t.length;e<t.length;e++)i=(i=Math.imul(i^t.charCodeAt(e),3432918353))<<13|i>>>19;i=Math.imul(i^i>>>16,2246822507),i=Math.imul(i^i>>>13,3266489909),Mt=(i^=i>>>16)>>>0}},Scene:function(){return _construct(Jt,Array.prototype.slice.call(arguments))},SceneClass:Jt,Sprite:function(){return _construct(U,Array.prototype.slice.call(arguments))},SpriteClass:U,SpriteSheet:function(){return _construct(te,Array.prototype.slice.call(arguments))},SpriteSheetClass:te,Text:X,TextClass:N,TileEngine:function(){return _construct(re,Array.prototype.slice.call(arguments))},TileEngineClass:re,Vector:F,VectorClass:B};return ne}(),_kontra=kontra,init=_kontra.init,load=_kontra.load,on=_kontra.on,setDataPath=_kontra.setDataPath,setAudioPath=_kontra.setAudioPath,audioAssets=_kontra.audioAssets,initPointer=_kontra.initPointer,getPointer=_kontra.getPointer,Sprite=_kontra.Sprite,GameLoop=_kontra.GameLoop,Quadtree=_kontra.Quadtree,randInt=_kontra.randInt,Button=_kontra.Button,track=_kontra.track,untrack=_kontra.untrack,Pool=_kontra.Pool,initKeys=_kontra.initKeys,_init=init(),canvas=_init.canvas,context=_init.context;setDataPath(path),setAudioPath(path),initPointer(),initKeys();var screenWidth=document.documentElement.clientWidth,screenHeight=document.documentElement.clientHeight,_kw=Math.min(Math.floor(screenWidth/375),Math.floor(screenHeight/667)),kw=_kw<1?1:_kw;canvas.width=screenWidth,canvas.height=screenHeight;var LEFT=1,RIGHT=2,BACK_LEFT=3,BACK_RIGHT=4,CARD_TYPE_MAGIC=1,CARD_TYPE_WEAPON=2,CARD_TYPE_EQUIPMENT=3,CARD_TYPE_ITEM=4,CARD_TYPE_SUPER_WEAPON=5,paused=!0,intervalId=null,bitmapWidth=16,bitmapHeight=16,pixelSize=2*kw,speedFactor=pixelSize/50,minDistance=40*kw,approachDistance=100*kw,objSize=bitmapWidth*pixelSize,enemyAttackRangeTiles=1,cardLimit=9,worldLimit=5e3*kw,enemyCount=16,backgroundArr=[],skillArr=[],cardArr=[],dialogArr=[],enemyPool=Pool({maxSize:50,create:Sprite}),itemPool=Pool({maxSize:100,create:Sprite}),msgPool=Pool({maxSize:50,create:Sprite}),quadtree=Quadtree();quadtree.maxObjects=8,quadtree.maxDepth=5,quadtree.bounds={x:0,y:0,width:worldLimit,height:worldLimit};var viewport={x:0,y:0,width:canvas.width,height:canvas.height},scoreboard={kill:0,break:0,damage:0,receivedDamage:0,init:function(){this.kill=0,this.break=0,this.damage=0,this.receivedDamage=0}},wizard=[0,31224,19424,23544,9208,14328,13884,12748,13780,8736,13288,12268,7644,7164,1004,2032,0,8094,2002,8154,8132,8172,15468,13196,11180,1092,6092,14324,15288,16344,14272,4064,0,31224,19424,23536,9200,14328,14328,14332,13840,9184,13288,12284,7644,7164,1004,2032,0,8094,2002,4058,4036,8172,8172,16364,2156,1988,6092,16372,15288,16344,14272,4064],background=[1024,288,640,576,1056,1040,2192,2448,2016,2016,960,960,384,384,384,384,32,1152,320,576,1056,2080,2320,2448,2016,2016,960,960,384,384,384,384,0,0,1984,4064,3552,3040,3056,2008,15292,32190,32254,24254,48958,49086,44984,11776,0,0,0,0,960,1952,4048,8136,8136,8064,3868,28734,63615,64637,62589,28728,128,128,384,398,1016,29664,8064,3968,896,896,896,896,448,448,992,448,256,768,896,50048,13185,4038,2040,992,960,896,896,896,384,384,960,384],menu_book=[16376,16392,24580,24574,20482,22522,22522,20482,22522,20482,22522,20482,22522,20482,12290,8190],skill_book=[16376,16392,24580,24574,20482,20674,20674,21490,21490,20674,20674,20674,20674,20482,12290,8190],chest=[0,0,0,0,14324,19450,34301,65021,0,34041,33825,33793,63487,0,0,0],heart=[0,0,7224,8772,16770,16386,16386,16386,8196,4104,2064,1056,576,384,0,0],exp_ball=[0,0,0,0,0,384,576,1184,1056,576,384,0,0,0,0,0],btn_close=[49155,57351,28686,14364,7224,3696,2016,960,960,2016,3696,7224,14364,28686,57351,49155],boom=[0,0,0,1024,0,24,60,60,24,0,0,0,4096,0,0,0,0,3072,7680,7680,3096,60,126,126,60,24,0,6144,15360,15360,6144,0,3072,7680,16128,16128,7740,3198,16510,126,126,60,6144,15360,32256,32256,15376,6144,7680,16128,16128,16152,16188,7798,16635,57599,16510,4156,15384,32256,31232,32272,32312,15376],slime={hp:50,atk:15,def:2,exp:150,audioPath:"/audio/attack_slime",mat:[0,0,0,0,0,0,960,3120,4104,4680,9828,9828,16386,16386,12300,4080,0,0,0,0,0,0,960,3120,4104,4680,9828,9828,16386,16386,12300,4080,0,0,0,0,0,0,960,3120,4104,4168,8196,8228,16418,16386,12300,4080,0,0,0,0,0,0,960,3120,4104,4616,8196,9220,17410,16386,12300,4080]},skeleton={hp:80,atk:20,def:2,exp:180,audioPath:"/audio/attack_sword",mat:[0,12288,13280,14320,14e3,13456,13456,14320,12943,14299,31889,16347,13787,686,996,864,0,12,1996,4076,3436,2348,2348,4076,61772,56300,35134,56316,56236,30016,10176,1728,0,12288,13280,14320,14320,14320,14320,14320,12975,14305,31901,16381,13761,682,996,864,0,12,1996,4076,4076,4076,4076,4076,62796,34796,47422,49148,33708,21824,10176,1728]},boss_skeleton={hp:4e3,atk:50,def:5,exp:7e3,speed:2,isBoss:!0,size:2*pixelSize,audioPath:"/audio/attack_sword",mat:[8192,26560,28640,28640,25504,26928,28400,26016,24576,31704,8452,716,4,960,1056,2064,4,998,2038,2038,1478,3222,3958,1446,6,7134,8324,13120,8192,960,1056,2064,8192,26560,28640,28640,28640,28656,28272,25632,24960,31704,8452,716,4,960,1056,2064,4,998,2038,2038,2038,4086,3702,1062,390,7134,8324,13120,8192,960,1056,2064]},spider={hp:180,atk:30,def:5,exp:900,audioPath:"/audio/attack_spider",mat:[0,0,0,12300,19410,2016,16380,18402,7608,10212,19026,4104,4104,0,0,0,0,0,0,12300,19410,2016,16380,18402,7608,10212,19026,4104,4104,0,0,0,0,0,0,4104,4104,19026,10212,7608,18402,16380,2016,19410,12300,0,0,0,0,0,0,4104,4104,19026,10212,7608,18402,16380,2016,19410,12300,0,0,0]},snake={hp:200,atk:35,def:5,exp:1e3,audioPath:"/audio/attack_bite",mat:[0,3968,7104,4064,992,240,120,120,56,4080,16368,32654,28799,32763,16379,8134,0,496,984,2032,1984,3840,7680,7680,7168,4080,4092,29182,65038,57342,57340,25592,0,3968,7104,4064,992,240,120,120,56,4080,16368,32654,28799,32763,16379,8134,0,496,984,2032,1984,3840,7680,7680,7168,4080,4092,29182,65038,57342,57340,25592]},boss_crab={hp:1e4,atk:70,def:15,exp:5e4,speed:2,isBoss:!0,size:2*pixelSize,audioPath:"/audio/attack_bite",mat:[36873,36873,34833,30702,4080,8184,16380,64479,40377,34785,33345,57351,49155,49155,57351,28686,36873,36873,34833,30702,4080,8184,16380,64479,40377,34785,33345,57351,49155,49155,57351,28686,28686,57351,49155,49155,58983,33345,34785,40377,64479,16380,8184,4080,30702,34833,36873,36873,28686,57351,49155,49155,58983,33345,34785,40377,64479,16380,8184,4080,30702,34833,36873,36873]},mummy={hp:300,atk:40,def:5,exp:2600,audioPath:"/audio/attack_blunt",mat:[0,2016,4080,4080,3568,3504,2016,4080,5160,14316,14316,15996,6120,9060,4968,10052,0,2016,4080,4080,4016,3504,2016,4080,5160,14316,14316,15996,6120,9924,5832,8932,0,2016,4080,4080,4080,4080,2016,4080,5224,14316,14188,16316,6120,9060,4968,10052,0,2016,4080,4080,4080,4080,2016,4080,5672,14316,14060,15868,6120,9924,5832,8932]},orc={hp:300,atk:45,def:8,exp:3e3,audioPath:"/audio/attack_blunt",mat:[0,2720,4071,2338,4071,2082,4071,29170,28154,17918,28142,28134,32226,14946,5730,1632,0,1360,59376,17552,59376,17424,59376,20366,24502,32674,30646,26550,18366,18012,18024,1632,0,2720,4071,4066,4071,4066,4071,32754,18426,24574,24558,18406,18402,11874,5730,1632,0,1360,59376,18416,59376,18416,59376,20478,24546,32762,30714,26594,18402,18036,18024,1632]},boss_tauren={hp:2e4,atk:90,def:18,exp:15e4,speed:2,isBoss:!0,size:2*pixelSize,audioPath:"/audio/attack_big_sword",mat:[128,768,1024,3856,3808,6656,15555,28711,14,4124,4152,4464,15848,32456,28780,49182,256,192,32,2288,1904,88,49980,58382,28672,14344,7176,3720,6076,4990,13838,30723,128,768,1024,3856,3808,6656,15555,28711,14,4124,4152,4464,15848,32456,28780,49182,256,192,32,2288,1904,88,49980,58382,28672,14344,7176,3720,6076,4990,13838,30723]},fox={hp:320,atk:50,def:10,exp:5200,audioPath:"/audio/attack_scythe",mat:[6144,12288,25096,25368,25592,25160,25592,25072,12512,6428,3066,3578,2552,2192,2192,2456,24,12,4166,6342,8134,4678,8134,3974,1804,14488,24528,24496,8080,2320,2320,6544,6144,12288,25096,25368,25592,25160,25592,25072,12512,6428,3066,3578,2552,2192,2192,2456,24,12,4166,6342,8134,4678,8134,3974,1804,14488,24528,24496,8080,2320,2320,6544]},devil={hp:350,atk:55,def:12,exp:5500,audioPath:"/audio/attack_fork",mat:[40960,43016,60888,19432,18416,17872,17552,22516,23532,29222,65534,63479,20473,31727,25571,17249,5,4117,7095,6098,4066,2978,2338,12266,14298,25678,32767,61423,40946,63454,51142,34498,40960,43016,60888,19432,18416,18416,18416,22516,24572,32446,64990,62439,32767,31727,25571,17249,5,4117,7095,6098,4066,4066,4066,12266,16378,32126,31679,59343,65534,63454,51142,34498]},reaper={hp:400,atk:60,def:12,exp:8500,audioPath:"/audio/attack_scythe",mat:[0,254,14840,31740,52142,35622,2855,3071,2643,2308,2476,4094,3071,2935,2811,2557,0,32512,8092,16350,30163,25809,58576,65488,51792,8336,13712,32752,65488,61136,57168,49040,0,254,14840,31740,52222,35838,3071,3071,2823,2556,2556,4094,3071,2935,2811,2557,0,32512,8092,16350,32723,32721,65488,65488,57552,16272,16272,32752,65488,61136,57168,49040]},maxExp=[200,800,1800,3200,5e3,7200,9800,12800,16200,2e4,30250,36e3,42250,49e3,56250,64e3,72250,81e3,90250,1e5,132300,145200,158700,172800,187500,202800,218700,235200,252300,27e4,336350,358400,381150,404600,428750,453600,479150,505400,532350,56e4,672400,705600,739600,774400,81e4,846400,883600,921600,960400,1e6],playerData={x:Math.round((worldLimit-objSize)/2),y:Math.round((worldLimit-objSize)/2),maxHp:100,atk:60,def:10,crit:10,maxExp:maxExp[0],lv:1,exp:0};function _createForOfIteratorHelper(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var r=0,n=function(){};return{s:n,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==i.return||i.return()}finally{if(s)throw a}}}}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=Array(e);i<e;i++)r[i]=t[i];return r}function _iterableToArrayLimit(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var r,n,a,o,s=[],h=!0,c=!1;try{if(a=(i=i.call(t)).next,0===e){if(Object(i)!==i)return;h=!1}else for(;!(h=(r=a.call(i)).done)&&(s.push(r.value),s.length!==e);h=!0);}catch(t){c=!0,n=t}finally{try{if(!h&&null!=i.return&&(o=i.return(),Object(o)!==o))return}finally{if(c)throw n}}return s}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function drawBitmap(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:pixelSize,r=bitmapHeight*(t-1),n=bitmapHeight*t;context.save(),context.translate(Math.round(screenWidth/2-player.x-objSize/2),Math.round(screenHeight/2-player.y-objSize/2-3*objSize));for(var a=r;a<n;a++)for(var o=e[a],s=0;s<bitmapWidth;s++){var h=o>>bitmapWidth-1-s&1;context.fillStyle=h?"white":"rgba(0, 0, 0, 0)",context.fillRect(s*i+objSize/2,(a-r)*i+objSize/2,i,i)}context.restore()}function updateViewport(t){viewport.x=t.x-viewport.width/2,viewport.y=t.y-viewport.height/2+3*objSize}function isVisible(t){return t.x<viewport.x+viewport.width+t.width/2&&t.x+t.width>viewport.x+t.width/2&&t.y<viewport.y+viewport.height+t.height/2&&t.y+t.height>viewport.y+t.height/2}function weightedRandom(t){for(var e=Object.entries(t),i=e.reduce((function(t,e){return t+_slicedToArray(e,2)[1]}),0),r=Math.random()*i,n=0,a=0,o=e;a<o.length;a++){var s=_slicedToArray(o[a],2),h=s[0];if(r<(n+=s[1]))return Number(h)}}function setDirection(t,e,i){var r=Math.atan2(i,e);i>0?e>0?t.direction=RIGHT:e<0&&(t.direction=LEFT):i<0&&(e>0?t.direction=r<-Math.PI/3?BACK_RIGHT:RIGHT:e<0&&(t.direction=r>2*-Math.PI/3?BACK_LEFT:LEFT))}function isColliding(t,e){return t.x-t.width/2<e.x+e.width/2&&t.x+t.width/2>e.x-e.width/2&&t.y-t.height/2<e.y+e.height/2&&t.y+t.height/2>e.y-e.height/2}function checkBoundary(t){t.x<t.width/2&&(t.x=t.width/2),t.y<t.height/2&&(t.y=t.height/2),t.x+t.width/2>worldLimit&&(t.x=worldLimit-t.width/2),t.y+t.height/2>worldLimit&&(t.y=worldLimit-t.height/2)}function displayNumber(t){return t<10?"0".concat(t):"".concat(t)}function isClickRect(t,e){return t.x>=e.x&&t.x<=e.x+e.width&&t.y>=e.y&&t.y<=e.y+e.height}function isExists(t,e){var i,r=_createForOfIteratorHelper(t);try{for(r.s();!(i=r.n()).done;){if(i.value==e)return!0}}catch(t){r.e(t)}finally{r.f()}return!1}function removeFromArr(t,e){t.splice(t.indexOf(e),1)}function clearArr(t){t.splice(0,t.length)}function bezier(t,e,i,r){t.x=Math.pow(1-r,3)*t.x+3*Math.pow(1-r,2)*r*e.x+3*(1-r)*Math.pow(r,2)*i.x+Math.pow(r,3)*player.x,t.y=Math.pow(1-r,3)*t.y+3*Math.pow(1-r,2)*r*e.y+3*(1-r)*Math.pow(r,2)*i.y+Math.pow(r,3)*player.y}function linesIntersect(t,e,i,r,n,a,o,s){var h=(s-a)*(i-t)-(o-n)*(r-e);if(0===h)return!1;var c=((o-n)*(e-a)-(s-a)*(t-n))/h,l=((i-t)*(e-a)-(r-e)*(t-n))/h;return c>=0&&c<=1&&l>=0&&l<=1}function doesLineIntersectRect(t,e,i,r,n){var a={x:n.x,y:n.y},o={x:n.x+n.width,y:n.y},s={x:n.x,y:n.y+n.height},h={x:n.x+n.width,y:n.y+n.height};return linesIntersect(t,e,i,r,a.x,a.y,o.x,o.y)||linesIntersect(t,e,i,r,o.x,o.y,h.x,h.y)||linesIntersect(t,e,i,r,h.x,h.y,s.x,s.y)||linesIntersect(t,e,i,r,s.x,s.y,a.x,a.y)}function fade(t){return t*t*t*(t*(6*t-15)+10)}function lerp(t,e,i){return t+i*(e-t)}function grad(t,e,i){var r=3&t,n=r<2?e:i,a=r<2?i:e;return(1&r?-n:n)+(2&r?-a:a)}for(var permutation=[],i=0;i<256;i++)permutation.push(i);permutation.sort((function(){return Math.random()-.5}));var p=[].concat(permutation,permutation);function noise(t,e){var i=255&Math.floor(t),r=255&Math.floor(e);t-=Math.floor(t),e-=Math.floor(e);var n=fade(t),a=fade(e),o=p[p[i]+r],s=p[p[i]+r+1],h=p[p[i+1]+r],c=p[p[i+1]+r+1],l=grad(o,t,e),u=grad(h,t-1,e),d=grad(s,t,e-1),f=grad(c,t-1,e-1),y=lerp(l,u,n),v=lerp(d,f,n);return lerp(y,v,a)}function octaveNoise(t,e,i,r){for(var n=0,a=1,o=1,s=0,h=0;h<i;h++)n+=noise(t*a,e*a)*o,s+=o,o*=r,a*=2;return(n/s+1)/2}function generatePoints(){for(var t=[],e=objSize/2;e<worldLimit-objSize/2;e+=objSize)for(var i=objSize/2;i<worldLimit-objSize/2;i+=objSize){var r=octaveNoise(.1*e,.1*i,5,.6);(r=Math.pow(r,2))>.37&&r<.5&&t.push({x:e,y:i})}return t}function _createForOfIteratorHelper(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var r=0,n=function(){};return{s:n,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==i.return||i.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=Array(e);i<e;i++)r[i]=t[i];return r}function damageDetection(t,e){return e!=player&&e.hp>0&&e.ttl>60&&isColliding(t,e)}function multiDamageDetection(t,e){return damageDetection(t,e)&&!isExists(t.targetArr,e)}var lightning=Sprite({x:0,y:0,ratio:0,time:1,cd:2,radius:6*objSize,timeCount:0,target:null,init:function(){this.ratio=360,this.timeCount=0,this.target=null},update:function(t){if(this.timeCount+=t,this.timeCount>this.cd+this.time&&(this.timeCount=0,this.target=null),this.timeCount>this.cd){if(null==this.target){var e,i=this.radius,r=_createForOfIteratorHelper(enemyPool.getAliveObjects());try{for(r.s();!(e=r.n()).done;){var n=e.value,a=Math.sqrt(Math.pow(n.x-player.x,2)+Math.pow(n.y-player.y,2));a<i&&(i=a,this.target=n)}}catch(t){r.e(t)}finally{r.f()}null!=this.target&&(audioAssets["/audio/skill_lightning"].play(),player.attack(this.target,this.ratio))}null==this.target&&(this.timeCount=this.cd)}},render:function(){if(null!=this.target){var t=Math.sqrt(Math.pow(this.target.x-player.x,2)+Math.pow(this.target.y-player.y,2));if(t<1.2*this.radius){var e=Math.round(t/(2*objSize));e<2&&(e=2),e>5&&(e=5),this.drawLightning(player.x,player.y,this.target.x,this.target.y,e)}}},drawLightning:function(t,e,i,r,n){if(0===n)return context.save(),context.translate(Math.round(screenWidth/2-player.x),Math.round(screenHeight/2-player.y-3*objSize)),context.beginPath(),context.moveTo(t,e),context.lineTo(i,r),context.strokeStyle="rgba(255, 255, 255, ".concat(Math.random(),")"),context.lineWidth=2*kw,context.stroke(),void context.restore();var a=(t+i)/2+(Math.random()-.5)*(1.2*objSize),o=(e+r)/2+(Math.random()-.5)*(1.2*objSize);this.drawLightning(t,e,a,o,n-1),this.drawLightning(a,o,i,r,n-1)}}),fireball=Sprite({x:0,y:0,width:12*kw,height:12*kw,type:"skill",anchor:{x:.5,y:.5},ratio:0,time:3,cd:2,radius:8*objSize,speed:180*kw,particles:Pool({maxSize:170,create:Sprite}),timeCount:0,active:!1,targetArr:[],init:function(){this.ratio=240,this.timeCount=0,this.dx=0,this.dy=0,this.active=!1},update:function(t){if(this.timeCount+=t,this.particles.update(),this.timeCount>this.cd+this.time&&(this.timeCount=0,this.dx=0,this.dy=0,this.active=!1),!this.active&&this.timeCount>this.cd&&(this.x=player.x,this.y=player.y,this.particles.clear(),this.dx=Math.round(Math.cos(player.angle)*this.speed),this.dy=Math.round(Math.sin(player.angle)*this.speed),audioAssets["/audio/skill_fireball"].play(),this.active=!0,this.targetArr=[]),this.active){this.particles.get(this.createParticles());var e,i=_createForOfIteratorHelper(quadtree.get(this));try{for(i.s();!(e=i.n()).done;){var r=e.value;multiDamageDetection(this,r)&&(player.attack(r,this.ratio),this.targetArr.push(r))}}catch(t){i.e(t)}finally{i.f()}}this.advance(t)},render:function(){this.active&&this.particles.render()},createParticles:function(){this.particles.get({x:0,y:0,anchor:{x:.5,y:.5},radius:(Math.random()*(fireball.width/2-2)+2)*kw,color:"rgba(255, 255, 255, ".concat(.5*Math.random()+.5,")"),ttl:60,update:function(){var t=this;t.dx=.5*Math.random()-.25-.02*fireball.dx,t.dy=.5*Math.random()-.25-.02*fireball.dy,t.radius*=.95,t.ttl--,this.advance()},render:function(){context.save(),context.translate(Math.round(screenWidth/2-player.x),Math.round(screenHeight/2-player.y-3*objSize)),context.beginPath(),context.arc(0,0,this.radius,0,2*Math.PI,!1),context.fillStyle=this.color,context.fill(),context.restore()}})}}),deathbook=Sprite({x:0,y:0,width:objSize,height:objSize,type:"skill",anchor:{x:.5,y:.5},ratio:0,maxCount:3,cd:3,radius:2.5*objSize,angle:3*Math.PI/2,targetArr:[],active:!1,timeCount:0,count:0,step:.05,endAngle:7*Math.PI/2,init:function(){this.ratio=100,this.angle=3*Math.PI/2,this.endAngle=7*Math.PI/2,this.step=.05,this.active=!1,this.timeCount=0,this.count=0},update:function(t){if(this.timeCount+=t,!this.active&&this.timeCount>this.cd&&(this.active=!0,audioAssets["/audio/skill_book"].play(),player.lastDx>0?(this.endAngle=7*Math.PI/2,this.step=.05):(this.endAngle=-Math.PI/2,this.step=-.05)),this.count>=this.maxCount&&(this.angle=3*Math.PI/2,this.active=!1,this.timeCount=0,this.count=0),this.endAngle>0?this.angle>this.endAngle&&(this.angle-=2*Math.PI,this.count++,this.targetArr=[]):this.angle<this.endAngle&&(this.angle+=2*Math.PI,this.count++,this.targetArr=[]),this.active){this.angle+=this.step;var e,i=_createForOfIteratorHelper(quadtree.get(this));try{for(i.s();!(e=i.n()).done;){var r=e.value;multiDamageDetection(this,r)&&(player.attack(r,this.ratio),this.targetArr.push(r))}}catch(t){i.e(t)}finally{i.f()}this.x=player.x+Math.cos(this.angle)*this.radius,this.y=player.y+Math.sin(this.angle)*this.radius}},render:function(){this.active&&drawBitmap(1,skill_book)}}),lightsaber=kontra.Sprite({x:screenWidth/2,y:screenHeight/2-3*objSize,width:10*kw,height:300*kw,ratio:0,preTime:3,time:1,cd:6,angle:Math.PI,rotationSpeed:.1,radius:0,maxRadius:60*kw,op:1,fadeSpeed:.015,charge:!1,active:!1,timeCount:0,playerDx:1,particles:Pool({maxSize:10,create:Sprite}),targetArr:[],init:function(){this.ratio=300,this.timeCount=0,this.active=!1,this.angle=Math.PI,this.radius=0,this.op=1,this.targetArr=[]},update:function(t){if(this.timeCount+=t,this.particles.update(),!this.active&&this.timeCount>this.cd&&(this.charge=!0,audioAssets["/audio/skill_charge"].play(),this.radius<this.maxRadius?this.radius+=1*kw:(audioAssets["/audio/skill_charge"].play(),this.radius=0,this.op=1),this.op>0&&(this.op-=this.fadeSpeed)),!this.active&&this.timeCount>this.cd+this.preTime&&(player.stop=!0,this.charge=!1,this.active=!0,audioAssets["/audio/skill_lightsaber1"].play(),setTimeout((function(){audioAssets["/audio/skill_lightsaber2"].play()}),1300)),this.timeCount>this.cd+this.preTime+this.time&&(this.timeCount=0,this.active=!1,this.angle=Math.PI,this.radius=0,this.op=1,player.stop=!1,this.targetArr=[]),this.active&&this.angle>Math.PI/2&&this.angle<3*Math.PI/2){this.angle+=this.rotationSpeed*(player.lastDx>0?1:-1);var e,i=player.x+Math.cos(this.angle+Math.PI/2)*this.height,r=player.y+Math.sin(this.angle+Math.PI/2)*this.height,n=_createForOfIteratorHelper(enemyPool.getAliveObjects());try{for(n.s();!(e=n.n()).done;){var a=e.value;!isExists(this.targetArr,a)&&doesLineIntersectRect(player.x,player.y,i,r,a)&&(player.attack(a,this.ratio),this.targetArr.push(a))}}catch(t){n.e(t)}finally{n.f()}var o,s=_createForOfIteratorHelper(backgroundArr);try{for(s.s();!(o=s.n()).done;){var h=o.value;h.isAlive()&&!isExists(this.targetArr,h)&&doesLineIntersectRect(player.x,player.y,i,r,h)&&(player.attack(h,this.ratio),this.targetArr.push(h))}}catch(t){s.e(t)}finally{s.f()}}},render:function(){if(this.charge&&(context.beginPath(),context.arc(0,0,this.radius,0,2*Math.PI),context.fillStyle="rgba(255, 255, 255, ".concat(this.op,")"),context.fill(),this.particles.render()),this.charge||this.active){if(context.save(),context.translate(0,objSize/2),context.rotate(this.angle),context.fillStyle="white",context.fillRect(-2*this.width,1.2*objSize,4*this.width,this.width),context.fillRect(-this.width/2,0,this.width,this.height),context.restore(),this.active){var t=Math.cos(this.angle+Math.PI/2)*Math.random()*this.height,e=Math.sin(this.angle+Math.PI/2)*Math.random()*this.height;this.createParticles(t,e)}else this.createParticles(0,Math.random()*-this.height);this.particles.render()}},createParticles:function(t,e){this.particles.get({x:t,y:e,dx:Math.round(100*(2*Math.random()-1))/100,dy:Math.round(100*(2*Math.random()-1))/100,tx:180*(Math.random()-.5)*kw,ty:180*(Math.random()-.5)*kw,a:Math.random(),offsetX:Math.random()-.5,offsetY:Math.random()-.5,ttl:5,update:function(){this.ttl-=1,this.advance()},render:function(){this.drawLightning(0,0,this.tx,this.ty,2)},drawLightning:function(t,e,i,r,n){if(0===n)return context.beginPath(),context.moveTo(t,e),context.lineTo(i,r),context.strokeStyle="rgba(255, 255, 255, ".concat(this.a,")"),context.lineWidth=kw,void context.stroke();var a=(t+i)/2+this.offsetX*(1.2*objSize),o=(e+r)/2+this.offsetY-1.2*objSize*.5;this.drawLightning(t,e,a,o,n-1),this.drawLightning(a,o,i,r,n-1)}})}}),poisonsmoke=Sprite({x:0,y:0,width:objSize/3,height:objSize/3,type:"skill",anchor:{x:.5,y:.5},ratio:0,flyTime:3,time:6,cd:3,radius:3*objSize,distance:6*objSize,timeCount:0,activeTimeCount:0,count:0,fly:!1,active:!1,particles:Pool({maxSize:100,create:Sprite}),speed:3*kw,init:function(){this.ratio=40,this.count=0,this.timeCount=0,this.activeTimeCount=0,this.fly=!1,this.active=!1},update:function(t){if(this.timeCount+=t,this.particles.update(),!this.active&&this.timeCount>this.cd+this.flyTime&&(this.dx=0,this.dy=0,this.timeCount=0,this.fly=!1),!this.fly&&!this.active&&this.timeCount>this.cd){this.x=player.x,this.y=player.y;var e=null;if(null==e){var i,r=this.distance,n=_createForOfIteratorHelper(enemyPool.getAliveObjects());try{for(n.s();!(i=n.n()).done;){var a=i.value,o=a.x-player.x,s=a.y-player.y,h=Math.sqrt(o*o+s*s);h<r&&(r=h,e={dx:o,dy:s,distance:h})}}catch(t){n.e(t)}finally{n.f()}if(null!=e){var c=e.dx/e.distance,l=e.dy/e.distance;this.dx=Math.round(c*this.speed),this.dy=Math.round(l*this.speed),this.fly=!0}}}if(this.fly){var u,d=_createForOfIteratorHelper(quadtree.get(this));try{for(d.s();!(u=d.n()).done;){if(damageDetection(this,u.value)){this.dx=0,this.dy=0,this.particles.clear(),this.fly=!1,this.active=!0,audioAssets["/audio/skill_poison"].play();break}}}catch(t){d.e(t)}finally{d.f()}}if(this.active){if(this.activeTimeCount+=t,this.count>=6)return this.count=0,this.timeCount=0,this.activeTimeCount=0,this.fly=!1,void(this.active=!1);if(this.activeTimeCount>=1){this.count++,this.activeTimeCount=0;var f,p=_createForOfIteratorHelper(enemyPool.getAliveObjects());try{for(p.s();!(f=p.n()).done;){var y=f.value;if(y!=player&&y.hp>0){var v=y.x-this.x,g=y.y-this.y;Math.sqrt(v*v+g*g)<this.radius&&player.attack(y,this.ratio)}}}catch(t){p.e(t)}finally{p.f()}}}this.advance()},render:function(){this.fly&&(context.save(),context.translate(Math.round(screenWidth/2-player.x),Math.round(screenHeight/2-player.y-3*objSize)),context.fillStyle="white",context.fillRect(this.width/4,0,this.width/2,this.height/2),context.fillRect(0,this.height/2,this.width,this.height/2),context.restore()),this.active&&(this.particles.get(this.createParticles()),this.particles.render())},createParticles:function(){this.particles.get({x:0,y:0,dx:1*(Math.random()-.5),dy:1*(Math.random()-.5),size:5*Math.random()+5*kw,growth:.05*Math.random()+.01*kw,op:.8,ttl:60,update:function(){this.ttl--,this.x+=this.dx,this.y+=this.dy,this.size+=this.growth,this.op-=.01,this.advance()},render:function(){context.save(),context.translate(Math.round(screenWidth/2-player.x),Math.round(screenHeight/2-player.y-3*objSize)),context.beginPath(),context.arc(this.x,this.y,this.size,0,2*Math.PI),context.fillStyle="rgba(255, 255, 255, ".concat(this.op,")"),context.fill(),context.restore()}})}}),axe=Sprite({x:0,y:0,width:objSize,height:objSize,type:"skill",ratio:0,cd:1,distance:8*objSize,returnToPlayer:!1,angle:0,targetArr:[],active:!1,timeCount:0,startX:0,startY:0,speed:2*kw,init:function(){this.x=0,this.y=0,this.ratio=90,this.angle=0,this.active=!1,this.timeCount=0,this.startX=0,this.startY=0,this.targetArr=[],this.speed=2*kw,this.distance=8*objSize,this.returnToPlayer=!1},update:function(t){if(this.timeCount+=t,!this.active&&this.timeCount>this.cd&&(this.active=!0,this.x=player.x,this.y=player.y,this.startX=this.x,this.startY=this.y,this.dx=Math.cos(player.angle)*this.speed,this.dy=Math.sin(player.angle)*this.speed,audioAssets["/audio/skill_axe"].play()),this.active){this.angle-=15;var e,i=_createForOfIteratorHelper(quadtree.get(this));try{for(i.s();!(e=i.n()).done;){var r=e.value;multiDamageDetection(this,r)&&(player.attack(r,this.ratio),this.targetArr.push(r))}}catch(t){i.e(t)}finally{i.f()}if(this.returnToPlayer){var n=Math.atan2(player.y-this.y,player.x-this.x);this.dx=Math.cos(n)*this.speed,this.dy=Math.sin(n)*this.speed,this.x+=this.dx,this.y+=this.dy,isColliding(this,player)&&(this.angle=0,this.active=!1,this.timeCount=0,this.returnToPlayer=!1,this.targetArr=[])}else this.x+=this.dx,this.y+=this.dy,Math.hypot(this.x-this.startX,this.y-this.startY)>=this.distance&&(this.returnToPlayer=!0,this.targetArr=[]);this.advance()}},render:function(){this.active&&(context.save(),context.translate(Math.round(screenWidth/2-player.x),Math.round(screenHeight/2-player.y-3*objSize)),context.rotate(this.angle*Math.PI/180),context.fillStyle="white",context.fillRect(0,-20*kw,5*kw,40*kw),context.beginPath(),context.moveTo(10*kw,-10*kw),context.lineTo(-10*kw,-20*kw),context.lineTo(-10*kw,0),context.closePath(),context.fill(),context.restore())}}),lance=Sprite({x:0,y:0,width:150*kw,height:4*kw,type:"skill",anchor:{x:.5,y:.5},ratio:0,cd:1,time:1,targetArr:[],active:!1,timeCount:0,playerLastDx:0,particles:Pool({maxSize:20,create:Sprite}),init:function(){this.x=0,this.y=0,this.ratio=90,this.active=!1,this.timeCount=0,this.targetArr=[]},update:function(t){if(this.timeCount+=t,!this.active&&this.timeCount>this.cd&&(this.active=!0,this.playerLastDx=player.lastDx>0?10:-10,audioAssets["/audio/skill_lance"].play()),this.active){this.playerLastDx>0?this.playerLastDx+=this.playerLastDx<60?10:0:this.playerLastDx-=this.playerLastDx>-60?10:0,this.x=player.x+this.playerLastDx*kw,this.y=player.y+this.height/2;var e,i=_createForOfIteratorHelper(quadtree.get(this));try{for(i.s();!(e=i.n()).done;){var r=e.value;multiDamageDetection(this,r)&&(player.attack(r,this.ratio),this.targetArr.push(r))}}catch(t){i.e(t)}finally{i.f()}this.timeCount>this.cd+this.time&&(this.active=!1,this.timeCount=0,this.targetArr=[]),this.advance(),this.particles.update()}},render:function(){this.active&&(context.save(),context.translate(Math.round(screenWidth/2-player.x),Math.round(screenHeight/2-player.y-3*objSize)),context.fillStyle="white",this.playerLastDx>0?(context.fillRect(0,0,this.width-10*kw,this.height),context.beginPath(),context.moveTo(this.width-20*kw,-this.height/2),context.lineTo(this.width,this.height/2),context.lineTo(this.width-20*kw,this.height+this.height/2),context.closePath(),context.fill()):(context.fillRect(10*kw,0,this.width-10*kw,this.height),context.beginPath(),context.moveTo(20*kw,-this.height/2),context.lineTo(0,this.height/2),context.lineTo(20*kw,this.height+this.height/2),context.closePath(),context.fill()),context.restore()),this.particles.render()}});function initSkill(){var t,e=_createForOfIteratorHelper(skillArr);try{for(e.s();!(t=e.n()).done;){t.value.init()}}catch(t){e.e(t)}finally{e.f()}}function _createForOfIteratorHelper(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var r=0,n=function(){};return{s:n,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==i.return||i.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=Array(e);i<e;i++)r[i]=t[i];return r}function getCards(){for(var t=[],e=0;e<cardArr.length;e++)t[e]=cardArr[e];for(var i=[],r=Math.min(t.length,3);i.length<r;)for(var n=t.reduce((function(t,e){return t+e.weight}),0),a=Math.random()*n,o=0;o<t.length;o++)if((a-=t[o].weight)<=0){i.push(t[o]),t.splice(o,1);break}return i}skillArr.push(lightning),skillArr.push(fireball),skillArr.push(deathbook),skillArr.push(lightsaber),skillArr.push(poisonsmoke),skillArr.push(axe),skillArr.push(lance),initSkill();var card_lightning={x:0,y:0,lv:0,type:CARD_TYPE_MAGIC,maxLv:5,name:"护身闪电",width:2*objSize,height:2*objSize,step:60,weight:1,getDetail:function(){return["魔法: ".concat(this.name),"等级: ".concat(this.lv," / ").concat(this.maxLv),"伤害倍率: ".concat(lightning.ratio,"%"),"攻击距离: ".concat(lightning.radius/kw),"持续时间: ".concat(lightning.time,"秒"),"冷却时间: ".concat(lightning.cd,"秒"),"发射强力闪电，攻击最近的敌人。"]},getDescription:function(){return["魔法: ".concat(this.name),"等级: ".concat(this.lv+1," / ").concat(this.maxLv),"伤害倍率: ".concat(lightning.ratio+(0==this.lv?0:this.step),"%"),"攻击距离: ".concat(lightning.radius/kw),"持续时间: ".concat(lightning.time,"秒"),"冷却时间: ".concat(lightning.cd,"秒"),"发射强力闪电，攻击最近的敌人。"]},remove:function(){removeFromArr(cardArr,this),removeFromArr(player.skill,lightning)},get:function(){if(this.lv++,isExists(player.cards,this))return this.levelUp(),!0;player.skill.push(lightning),player.cards.push(this),this.weight++},levelUp:function(){lightning.ratio+=this.step,this.lv==this.maxLv&&removeFromArr(cardArr,this)},icon:[65535,32769,32769,32769,33729,33665,34561,34305,36833,32961,33153,33025,32769,32769,32769,65535]},card_fireball={x:0,y:0,lv:0,type:CARD_TYPE_MAGIC,maxLv:5,name:"火球术",width:2*objSize,height:2*objSize,step:60,weight:1,getDetail:function(){return["魔法: ".concat(this.name),"等级: ".concat(this.lv," / ").concat(this.maxLv),"伤害倍率: ".concat(fireball.ratio,"%"),"攻击距离: ".concat(fireball.radius/kw),"持续时间: ".concat(fireball.time,"秒"),"冷却时间: ".concat(fireball.cd,"秒"),"向面朝的方向发射可穿透敌人的火球。"]},getDescription:function(){return["魔法: ".concat(this.name),"等级: ".concat(this.lv+1," / ").concat(this.maxLv),"伤害倍率: ".concat(fireball.ratio+(0==this.lv?0:this.step),"%"),"攻击距离: ".concat(fireball.radius/kw),"持续时间: ".concat(fireball.time,"秒"),"冷却时间: ".concat(fireball.cd,"秒"),"向面朝的方向发射可穿透敌人的火球。"]},remove:function(){removeFromArr(cardArr,this),removeFromArr(player.skill,fireball)},get:function(){this.lv++,isExists(player.cards,this)?this.levelUp():(player.skill.push(fireball),player.cards.push(this),this.weight++)},levelUp:function(){fireball.ratio+=this.step,this.lv==this.maxLv&&removeFromArr(cardArr,this)},icon:[65535,32773,32769,32811,32769,32937,32833,34049,34849,39425,48257,48641,48641,48129,32769,65535]},card_deathbook={x:0,y:0,lv:0,type:CARD_TYPE_WEAPON,maxLv:5,name:"圣书",width:2*objSize,height:2*objSize,step:40,weight:1,getDetail:function(){return["武器: ".concat(this.name),"等级: ".concat(this.lv," / ").concat(this.maxLv),"伤害倍率: ".concat(deathbook.ratio,"%"),"攻击距离: ".concat(deathbook.radius/kw),"旋转圈数: ".concat(deathbook.maxCount),"冷却时间: ".concat(deathbook.cd,"秒"),"攻击力 + 5","防御力 + 5","跟随玩家旋转，攻击周围的敌人。"]},getDescription:function(){return["武器: ".concat(this.name),"等级: ".concat(this.lv+1," / ").concat(this.maxLv),"伤害倍率: ".concat(deathbook.ratio+(0==this.lv?0:this.step),"%"),"攻击距离: ".concat(deathbook.radius/kw),"旋转圈数: ".concat(deathbook.maxCount),"冷却时间: ".concat(deathbook.cd,"秒"),"攻击力 + 5","防御力 + 5","跟随玩家旋转，攻击周围的敌人。"]},remove:function(){removeFromArr(cardArr,this),removeFromArr(player.skill,deathbook),player.atk-=5,player.def-=5},get:function(){this.lv++,isExists(player.cards,this)?this.levelUp():(player.skill.push(deathbook),player.cards.push(this),player.atk+=5,player.def+=5,this.weight++)},levelUp:function(){deathbook.ratio+=this.step,this.lv==this.maxLv&&removeFromArr(cardArr,this)},icon:[65535,32769,32769,33785,33801,36841,34857,35113,35753,35113,35113,34865,36833,32769,32769,65535]},card_lightsaber={x:0,y:0,lv:0,type:CARD_TYPE_SUPER_WEAPON,maxLv:5,name:"圣剑",width:2*objSize,height:2*objSize,step:40,weight:.1,getDetail:function(){return["武器: ".concat(this.name),"等级: ".concat(this.lv," / ").concat(this.maxLv),"伤害倍率: ".concat(lightsaber.ratio,"%"),"攻击距离: ".concat(lightsaber.height),"前摇时间: ".concat(lightsaber.preTime,"秒"),"持续时间: ".concat(lightsaber.time,"秒"),"冷却时间: ".concat(lightsaber.cd,"秒"),"攻击力 + 10","可发动圣剑解放攻击大量敌人。"]},getDescription:function(){return["武器: ".concat(this.name),"等级: ".concat(this.lv+1," / ").concat(this.maxLv),"伤害倍率: ".concat(lightsaber.ratio+(0==this.lv?0:this.step),"%"),"攻击距离: ".concat(lightsaber.height),"前摇时间: ".concat(lightsaber.preTime,"秒"),"持续时间: ".concat(lightsaber.time,"秒"),"冷却时间: ".concat(lightsaber.cd,"秒"),"攻击力 + 10","可发动圣剑解放攻击大量敌人。"]},remove:function(){removeFromArr(cardArr,this),removeFromArr(player.skill,lightsaber),player.atk-=10},get:function(){this.lv++,isExists(player.cards,this)?this.levelUp():(player.skill.push(lightsaber),player.cards.push(this),player.atk+=10,this.weight++)},levelUp:function(){lightsaber.ratio+=this.step,this.lv==this.maxLv&&removeFromArr(cardArr,this)},icon:[65535,32769,32781,32797,32825,32881,32993,33217,33665,42753,47617,35841,37889,42497,49153,65535]},card_shield={x:0,y:0,lv:0,type:CARD_TYPE_EQUIPMENT,maxLv:5,name:"钢盾",width:2*objSize,height:2*objSize,def:10,step:5,weight:1,getDetail:function(){return["装备: ".concat(this.name),"等级: ".concat(this.lv," / ").concat(this.maxLv),"防御力 + ".concat(this.def+(this.lv-1)*this.step)]},getDescription:function(){return["装备: ".concat(this.name),"等级: ".concat(this.lv+1," / ").concat(this.maxLv),"防御力 + ".concat(this.def+this.lv*this.step)]},remove:function(){removeFromArr(cardArr,this),player.def-=this.def+(this.lv-1)*this.step},get:function(){this.lv++,isExists(player.cards,this)?this.levelUp():(player.cards.push(this),player.def+=this.def,this.weight++)},levelUp:function(){player.def+=this.step,this.lv==this.maxLv&&removeFromArr(cardArr,this)},icon:[65535,32769,40953,36873,38889,37097,37097,37097,37097,37097,37097,35025,33953,33345,33153,65535]},card_belt={x:0,y:0,lv:0,type:CARD_TYPE_EQUIPMENT,maxLv:5,name:"力量腰带",width:2*objSize,height:2*objSize,atk:10,step:5,weight:1,getDetail:function(){return["装备: ".concat(this.name),"等级: ".concat(this.lv," / ").concat(this.maxLv),"攻击力 + ".concat(this.atk+(this.lv-1)*this.step)]},getDescription:function(){return["装备: ".concat(this.name),"等级: ".concat(this.lv+1," / ").concat(this.maxLv),"攻击力 + ".concat(this.atk+this.lv*this.step)]},remove:function(){removeFromArr(cardArr,this),player.atk-=this.atk+(this.lv-1)*this.step},get:function(){this.lv++,isExists(player.cards,this)?this.levelUp():(player.cards.push(this),player.atk+=this.atk,this.weight++)},levelUp:function(){player.atk+=this.step,this.lv==this.maxLv&&removeFromArr(cardArr,this)},icon:[65535,32769,32769,36849,40953,45069,40965,41925,42021,46509,46509,38313,33825,33729,32769,65535]},card_hp_medicine={x:0,y:0,lv:0,type:CARD_TYPE_ITEM,maxLv:5,name:"生命药水",width:2*objSize,height:2*objSize,hp:20,weight:1,getDetail:function(){return["装备: ".concat(this.name),"等级: ".concat(this.lv," / ").concat(this.maxLv),"最大生命值 + ".concat(this.lv*this.hp)]},getDescription:function(){return["装备: ".concat(this.name),"等级: ".concat(this.lv+1," / ").concat(this.maxLv),"立即恢复150生命值。","最大生命值 + ".concat((this.lv+1)*this.hp)]},remove:function(){removeFromArr(cardArr,this),player.maxHp-=this.hp*this.lv,player.hp>player.maxHp&&(player.hp=player.maxHp)},get:function(){this.lv++,isExists(player.cards,this)?this.levelUp():(player.cards.push(this),player.maxHp+=this.hp),player.addHp(150)},levelUp:function(){player.maxHp+=this.hp,this.lv==this.maxLv&&removeFromArr(cardArr,this)},icon:[65535,32769,33729,33737,33181,33353,33825,34833,36873,38889,38889,38889,36873,36849,32769,65535]},card_poison={x:0,y:0,lv:0,type:CARD_TYPE_WEAPON,maxLv:5,name:"毒瓶",width:2*objSize,height:2*objSize,step:40,weight:1,getDetail:function(){return["武器: ".concat(this.name),"等级: ".concat(this.lv," / ").concat(this.maxLv),"伤害倍率: ".concat(poisonsmoke.ratio,"%"),"攻击范围: ".concat(poisonsmoke.radius/kw),"飞行时间: ".concat(poisonsmoke.flyTime,"秒"),"持续时间: ".concat(poisonsmoke.time,"秒"),"冷却时间: ".concat(poisonsmoke.cd,"秒"),"攻击力 + 5","投掷毒瓶，对范围内的敌人造成持续伤害。"]},getDescription:function(){return["武器: ".concat(this.name),"等级: ".concat(this.lv+1," / ").concat(this.maxLv),"伤害倍率: ".concat(poisonsmoke.ratio+(0==this.lv?0:this.step),"%"),"攻击范围: ".concat(poisonsmoke.radius/kw),"飞行时间: ".concat(poisonsmoke.flyTime,"秒"),"持续时间: ".concat(poisonsmoke.time,"秒"),"冷却时间: ".concat(poisonsmoke.cd,"秒"),"攻击力 + 5","投掷毒瓶，对范围内的敌人造成持续伤害。"]},remove:function(){removeFromArr(cardArr,this),removeFromArr(player.skill,poisonsmoke),player.atk-=5},get:function(){this.lv++,isExists(player.cards,this)?this.levelUp():(player.skill.push(poisonsmoke),player.cards.push(this),player.atk+=5,this.weight++)},levelUp:function(){poisonsmoke.ratio+=this.step,this.lv==this.maxLv&&removeFromArr(cardArr,this)},icon:[65535,32769,33153,33729,33345,33345,33345,33825,34961,37385,49149,49149,49149,40953,32769,65535]},card_tooth={x:0,y:0,lv:0,type:CARD_TYPE_EQUIPMENT,maxLv:5,name:"狼牙挂坠",width:2*objSize,height:2*objSize,step:2,weight:1,getDetail:function(){return["装备: ".concat(this.name),"等级: ".concat(this.lv," / ").concat(this.maxLv),"攻击力 + ".concat((this.lv-1)*this.step+5),"暴击率 + ".concat((this.lv-1)*this.step+5)]},getDescription:function(){return["装备: ".concat(this.name),"等级: ".concat(this.lv+1," / ").concat(this.maxLv),"攻击力 + ".concat(this.lv*this.step+5),"暴击率 + ".concat(this.lv*this.step+5)]},remove:function(){removeFromArr(cardArr,this),player.atk-=5+(this.lv-1)*this.step,player.crit-=5+(this.lv-1)*this.step},get:function(){this.lv++,isExists(player.cards,this)?this.levelUp():(player.cards.push(this),player.atk+=5,player.crit+=5,this.weight++)},levelUp:function(){player.atk+=this.step,player.crit+=this.step,this.lv==this.maxLv&&removeFromArr(cardArr,this)},icon:[65535,32769,33017,33565,34045,35837,38905,38881,44929,44561,44049,47233,45057,45121,40961,65535]},card_necklace={x:0,y:0,lv:0,type:CARD_TYPE_EQUIPMENT,maxLv:5,name:"宝石项链",width:2*objSize,height:2*objSize,step:1,weight:1,getDetail:function(){return["装备: ".concat(this.name),"等级: ".concat(this.lv," / ").concat(this.maxLv),"攻击力 + ".concat((this.lv-1)*this.step+2),"防御力 + ".concat((this.lv-1)*this.step+2),"最大生命值 + ".concat((this.lv-1)*this.step+10)]},getDescription:function(){return["装备: ".concat(this.name),"等级: ".concat(this.lv+1," / ").concat(this.maxLv),"攻击力 + ".concat(this.lv*this.step+2),"防御力 + ".concat(this.lv*this.step+2),"最大生命值 + ".concat(this.lv*this.step+10)]},remove:function(){removeFromArr(cardArr,this),player.atk-=2+(this.lv-1)*this.step,player.def-=2+(this.lv-1)*this.step,player.hp-=10+(this.lv-1)*this.step},get:function(){this.lv++,isExists(player.cards,this)?this.levelUp():(player.cards.push(this),player.atk+=2,player.def+=2,player.maxHp+=10,this.weight++)},levelUp:function(){player.atk+=this.step,player.def+=this.step,player.maxHp+=this.step,this.lv==this.maxLv&&removeFromArr(cardArr,this)},icon:[65535,32769,33265,34313,34821,36869,40965,40969,40977,36897,35201,33345,33345,33153,32769,65535]},card_axe={x:0,y:0,lv:0,type:CARD_TYPE_WEAPON,maxLv:5,name:"战斧",width:2*objSize,height:2*objSize,step:40,weight:1,getDetail:function(){return["武器: ".concat(this.name),"等级: ".concat(this.lv," / ").concat(this.maxLv),"伤害倍率: ".concat(axe.ratio,"%"),"攻击距离: ".concat(axe.distance/kw),"冷却时间: ".concat(axe.cd,"秒"),"攻击力 + 15","回旋攻击玩家朝向的敌人。"]},getDescription:function(){return["武器: ".concat(this.name),"等级: ".concat(this.lv+1," / ").concat(this.maxLv),"伤害倍率: ".concat(axe.ratio+(0==this.lv?0:this.step),"%"),"攻击距离: ".concat(axe.distance/kw),"冷却时间: ".concat(axe.cd,"秒"),"攻击力 + 15","回旋攻击玩家朝向的敌人。"]},remove:function(){removeFromArr(cardArr,this),removeFromArr(player.skill,axe),player.atk-=15},get:function(){this.lv++,isExists(player.cards,this)?this.levelUp():(player.skill.push(axe),player.cards.push(this),player.atk+=15,this.weight++)},levelUp:function(){axe.ratio+=this.step,this.lv==this.maxLv&&removeFromArr(cardArr,this)},icon:[65535,32769,32865,36069,36813,34701,34813,36765,40253,47481,61945,59377,53185,32769,32769,65535]},card_magnet={x:0,y:0,lv:0,type:CARD_TYPE_ITEM,maxLv:5,name:"磁铁",width:2*objSize,height:2*objSize,step:10,weight:1,getDetail:function(){return["装备: ".concat(this.name),"等级: ".concat(this.lv," / ").concat(this.maxLv),"拾取距离 + ".concat(10*this.lv)]},getDescription:function(){return["装备: ".concat(this.name),"等级: ".concat(this.lv+1," / ").concat(this.maxLv),"立即吸取地图上所有的道具。","拾取距离 + ".concat(10*(this.lv+1))]},remove:function(){removeFromArr(cardArr,this),player.pickupDistance-=this.lv*this.step},get:function(){this.lv++,isExists(player.cards,this)?this.levelUp():(player.cards.push(this),player.pickupDistance+=this.step,this.weight++);var t,e=_createForOfIteratorHelper(itemPool.getAliveObjects());try{for(e.s();!(t=e.n()).done;){t.value.fly=!0}}catch(t){e.e(t)}finally{e.f()}},levelUp:function(){player.pickupDistance+=this.step,this.lv==this.maxLv&&removeFromArr(cardArr,this)},icon:[65535,32769,39993,39993,39993,37929,37929,37929,37929,37929,37929,37833,34833,34785,32769,65535]},card_lance={x:0,y:0,lv:0,type:CARD_TYPE_WEAPON,maxLv:5,name:"长矛",width:2*objSize,height:2*objSize,step:40,weight:1,getDetail:function(){return["武器: ".concat(this.name),"等级: ".concat(this.lv," / ").concat(this.maxLv),"伤害倍率: ".concat(lance.ratio,"%"),"攻击距离: ".concat(lance.width/kw),"冷却时间: ".concat(lance.cd,"秒"),"攻击力 + 10","可攻击水平方向的敌人。"]},getDescription:function(){return["武器: ".concat(this.name),"等级: ".concat(this.lv+1," / ").concat(this.maxLv),"伤害倍率: ".concat(lance.ratio+(0==this.lv?0:this.step),"%"),"攻击距离: ".concat(lance.width/kw),"冷却时间: ".concat(lance.cd,"秒"),"攻击力 + 10","可攻击水平方向的敌人。"]},remove:function(){removeFromArr(cardArr,this),removeFromArr(player.skill,lance),player.atk-=10},get:function(){this.lv++,isExists(player.cards,this)?this.levelUp():(player.skill.push(lance),player.cards.push(this),player.atk+=15,this.weight++)},levelUp:function(){lance.ratio+=this.step,this.lv==this.maxLv&&removeFromArr(cardArr,this)},icon:[65535,32769,32781,32797,32825,32977,32865,32929,33025,33281,33793,34817,36865,40961,32769,65535]};function initCard(){clearArr(cardArr),cardArr.push(card_lightning),cardArr.push(card_fireball),cardArr.push(card_deathbook),cardArr.push(card_lightsaber),cardArr.push(card_shield),cardArr.push(card_belt),cardArr.push(card_hp_medicine),cardArr.push(card_poison),cardArr.push(card_tooth),cardArr.push(card_necklace),cardArr.push(card_axe),cardArr.push(card_magnet),cardArr.push(card_lance);var t,e=_createForOfIteratorHelper(cardArr);try{for(e.s();!(t=e.n()).done;){var i=t.value;i.lv=0,i.type==CARD_TYPE_WEAPON?i.weight=1.5:i.type==CARD_TYPE_SUPER_WEAPON?i.weight=.1:i.weight=1}}catch(t){e.e(t)}finally{e.f()}}function _createForOfIteratorHelper(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var r=0,n=function(){};return{s:n,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==i.return||i.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=Array(e);i<e;i++)r[i]=t[i];return r}function openDialog(t){t.show||(paused=!0,joystick.enable=!1,joystick.frameCount=300,track(t),t.open(),intervalId&&(clearInterval(intervalId),intervalId=null))}function closeDialog(t){if(t.show){untrack(t),t.close();var e,i=!0,r=_createForOfIteratorHelper(dialogArr);try{for(r.s();!(e=r.n()).done;){if(e.value.show){i=!1;break}}}catch(t){r.e(t)}finally{r.f()}i&&(paused=!1,joystick.enable=!0,intervalId=setInterval(intervalHandle,1e3))}}function openSubDialog(t,e){t.show=!1,untrack(t),track(e),e.open(t)}function closeSubDialog(t,e){untrack(e),e.close(),t.show=!0,track(t)}function drawSubWindow(t,e,i,r){context.fillStyle="black",context.fillRect(t,e,i,r),context.strokeStyle="white",context.lineWidth=4*kw;var n=4*pixelSize;context.strokeRect(t+n,e+n,i-2*n,r-2*n)}function _drawCloseBtn(t,e,i){context.strokeStyle="white",context.lineWidth=2*kw,context.beginPath(),context.moveTo(t,e),context.lineTo(t+i,e+i),context.stroke(),context.beginPath(),context.moveTo(t+i,e),context.lineTo(t,e+i),context.stroke()}function drawCard(t,e,i,r){var n=2*pixelSize,a="white";if(r&&(a=r==i?"white":"gray"),i.x=t,i.y=e,0==i.lv){context.fillStyle="white",context.textAlign="center";var o=Math.floor(13*kw);context.font="".concat(o,"px Arial"),context.fillText("NEW",t+i.width/2,e-n)}for(var s=0;s<bitmapHeight;s++)for(var h=i.icon[s],c=0;c<bitmapWidth;c++){var l=h>>bitmapWidth-1-c&1;context.fillStyle=l?a:"black",context.fillRect(t+c*n,e+s*n,n,n)}}initCard();var mainDialog=Sprite({x:0,y:0,width:screenWidth,height:screenHeight,show:!1,msgArr:[],btnArr:[],selectedCard:null,addBtn:function(t){this.btnArr.find((function(e){return e.id===t.id}))||this.btnArr.push(t)},open:function(){this.show=!0,this.btnArr=[],this.selectedCard=null},close:function(){this.show=!1},onUp:function(){var t,e=getPointer(),i=_createForOfIteratorHelper(this.btnArr);try{for(i.s();!(t=i.n()).done;){var r=t.value;isClickRect(e,r)&&r.onPressed()}}catch(t){i.e(t)}finally{i.f()}},update:function(){this.msgArr=["等级: ".concat(player.lv),"经验值: ".concat(player.exp," / ").concat(player.maxExp),"生命值: ".concat(player.hp," / ").concat(player.maxHp),"攻击力: ".concat(player.atk),"防御力: ".concat(player.def),"暴击率: ".concat(player.crit,"%")]},render:function(){var t=0,e=0;drawSubWindow(t,e,this.width,this.height);var i=Math.floor(16*kw);context.fillStyle="white",context.font="".concat(i,"px Arial"),context.lineWidth=1,context.textAlign="left",t=Math.floor(screenWidth/2-4*objSize),e+=objSize/2;var r,n=_createForOfIteratorHelper(this.msgArr);try{for(n.s();!(r=n.n()).done;){var a=r.value;e+=objSize,context.fillText(a,t,e)}}catch(t){n.e(t)}finally{n.f()}e+=objSize,this.drawCards(t,e),this.drawCloseBtn()},drawCards:function(t,e){var i=this,r=0,n=0,a=t,o=e,s=Math.floor(16*kw);context.fillStyle="white",context.font="".concat(s,"px Arial"),context.lineWidth=1,context.textAlign="center";var h,c=_createForOfIteratorHelper(player.cards);try{var l=function(){var s=h.value;drawCard(t=a+3*objSize*r,e=o+3*objSize*n,s),context.fillText(s.name,t+objSize,e+2.5*objSize),r<2?r++:(r=0,n++),i.addBtn({id:s.name,x:t,y:e,width:s.width,height:s.height,onPressed:function(){mainDialog.selectedCard=s,openSubDialog(mainDialog,cardDetailDialog)}})};for(c.s();!(h=c.n()).done;)l()}catch(t){c.e(t)}finally{c.f()}},drawCloseBtn:function(){var t=screenWidth-objSize-10*pixelSize,e=objSize/2+2*pixelSize,i=objSize;this.addBtn({id:"close",x:t,y:e,width:i,height:i,onPressed:function(){closeDialog(mainDialog)}}),_drawCloseBtn(t,e,i)}}),levelUpDialog=Sprite({x:0,y:0,width:screenWidth,height:screenHeight,show:!1,active:!1,name:"",msgArr:"",cards:[],selectedCard:null,timeCount:0,resetCount:3,okBtn:{x:0,y:0,width:0,height:0},resetBtn:{x:0,y:0,width:0,height:0},closeBtn:{x:0,y:0,width:0,height:0},open:function(){this.cards=getCards(),this.selectedCard=this.cards[0],this.show=!0,this.active=!1,this.timeCount=0,this.btnArr=[]},close:function(){this.show=!1},onUp:function(){if(this.active){var t=getPointer();if(isClickRect(t,this.closeBtn))return player.point--,void closeDialog(this);if(this.resetCount>0&&isClickRect(t,this.resetBtn))return this.resetCount--,this.cards=getCards(),void(this.selectedCard=this.cards[0]);if(isClickRect(t,this.okBtn))return void(isExists(player.cards,this.selectedCard)||player.cards.length<cardLimit?(this.selectedCard.get(),player.point--,closeDialog(this)):openSubDialog(this,cardDialog));var e,i=_createForOfIteratorHelper(this.cards);try{for(i.s();!(e=i.n()).done;){var r=e.value;isClickRect(t,r)&&(this.selectedCard=r)}}catch(t){i.e(t)}finally{i.f()}}},update:function(t){this.timeCount+=t,this.selectedCard&&(this.name=this.selectedCard.name,this.msgArr=this.selectedCard.getDescription()),this.timeCount>1&&(this.active=!0,this.timeCount=0)},render:function(){var t=0,e=0;drawSubWindow(t,e,this.width,this.height),context.fillStyle="white",context.font="".concat(Math.floor(19*kw),"px Arial"),context.lineWidth=1,context.textAlign="center",context.fillText("升级",t+screenWidth/2,e+1.5*objSize),drawCard(t=Math.floor(screenWidth/2-objSize),e+=2.5*objSize,this.cards[0],this.selectedCard),drawCard(t-=3*objSize,e,this.cards[1],this.selectedCard),drawCard(t+=6*objSize,e,this.cards[2],this.selectedCard),context.fillStyle="white",context.font="".concat(Math.floor(16*kw),"px Arial"),context.textAlign="left",context.fillStyle="white",t=1.5*objSize,e+=2*objSize;var i,r=_createForOfIteratorHelper(this.msgArr);try{for(r.s();!(i=r.n()).done;){var n=i.value;e+=objSize,context.fillText(n,t,e)}}catch(t){r.e(t)}finally{r.f()}t=(screenWidth-5*objSize)/2,e+=objSize,this.resetCount>0&&(this.drawResetBtn(t,e,5*objSize,objSize),e+=1.8*objSize),this.drawOkBtn(t,e,5*objSize,objSize),this.drawCloseBtn()},drawOkBtn:function(t,e,i,r){this.okBtn.x=t,this.okBtn.y=e,this.okBtn.width=i,this.okBtn.height=r,context.strokeStyle="white",context.lineWidth=2*kw,context.strokeRect(t,e,i,r),context.fillStyle="white",context.textAlign="center",context.font="".concat(Math.floor(16*kw),"px Arial"),context.fillText("确定",screenWidth/2,e+.7*r)},drawResetBtn:function(t,e,i,r){this.resetBtn.x=t,this.resetBtn.y=e,this.resetBtn.width=i,this.resetBtn.height=r,context.strokeStyle="white",context.lineWidth=2*kw,context.strokeRect(t,e,i,r),context.fillStyle="white",context.textAlign="center",context.font="".concat(Math.floor(16*kw),"px Arial"),context.fillText("重置(剩余".concat(this.resetCount,"次)"),screenWidth/2,e+.7*r)},drawCloseBtn:function(){this.closeBtn.x=screenWidth-objSize-10*pixelSize,this.closeBtn.y=objSize/2+2*pixelSize,this.closeBtn.width=objSize,this.closeBtn.height=objSize,_drawCloseBtn(this.closeBtn.x,this.closeBtn.y,objSize)}}),startDialog=Sprite({x:0,y:0,width:screenWidth,height:screenHeight,show:!1,open:function(){this.show=!0},close:function(){this.show=!1;for(var t=0;t<enemyCount;t++)createEnemy(slime),createEnemy(skeleton);createBackground(),card_lightning.get()},onUp:function(){closeDialog(this)},render:function(){context.fillStyle="black",context.fillRect(0,0,screenWidth,screenHeight),context.fillStyle="white",context.font="".concat(Math.floor(30*kw),"px Arial"),context.textAlign="center",context.fillText("点击开始游戏",screenWidth/2,screenHeight/2)}}),gameOverDialog=Sprite({x:0,y:0,width:screenWidth,height:screenHeight,show:!1,okBtn:{x:0,y:0,width:0,height:0},getText:function(){return["生存时间: ".concat(statusBar.time),"等级: ".concat(player.lv),"击杀: ".concat(scoreboard.kill),"场景破坏: ".concat(scoreboard.break),"总伤害: ".concat(scoreboard.damage),"受到伤害: ".concat(scoreboard.receivedDamage)]},open:function(){this.show=!0},close:function(){this.show=!1},onUp:function(){isClickRect(getPointer(),this.okBtn)&&(player.init(),statusBar.init(),scoreboard.init(),initCard(),initSkill(),clearArr(backgroundArr),enemyPool.clear(),itemPool.clear(),msgPool.clear(),quadtree.clear(),levelUpDialog.resetCount=3,closeDialog(this),openDialog(startDialog))},render:function(){var t=0,e=0;context.fillStyle="black",context.fillRect(t,e,screenWidth,screenHeight),t=screenWidth/2,e+=1.5*objSize,context.fillStyle="white",context.font="".concat(Math.floor(19*kw),"px Arial"),context.lineWidth=1,context.textAlign="center",context.fillText("游戏结束",t,e),context.font="".concat(Math.floor(16*kw),"px Arial"),context.lineWidth=1,context.textAlign="left",t=Math.floor(screenWidth/2-4*objSize),e+=objSize/2;var i,r=_createForOfIteratorHelper(this.getText());try{for(r.s();!(i=r.n()).done;){var n=i.value;e+=objSize,context.fillText(n,t,e)}}catch(t){r.e(t)}finally{r.f()}e+=objSize,this.drawCards(t,e),t=(screenWidth-5*objSize)/2,e+=9.5*objSize,this.drawOkBtn(t,e,5*objSize,objSize)},drawCards:function(t,e){var i=0,r=0,n=t,a=e;context.fillStyle="white",context.font="".concat(Math.floor(16*kw),"px Arial"),context.lineWidth=1,context.textAlign="center";var o,s=_createForOfIteratorHelper(player.cards);try{for(s.s();!(o=s.n()).done;){var h=o.value;drawCard(t=n+3*objSize*i,e=a+3*objSize*r,h),context.fillText(h.name,t+objSize,e+2.5*objSize),i<2?i++:(i=0,r++)}}catch(t){s.e(t)}finally{s.f()}},drawOkBtn:function(t,e,i,r){this.okBtn.x=t,this.okBtn.y=e,this.okBtn.width=i,this.okBtn.height=r,context.strokeStyle="white",context.lineWidth=2*kw,context.strokeRect(t,e,i,r),context.fillStyle="white",context.textAlign="center",context.font="".concat(Math.floor(16*kw),"px Arial"),context.fillText("重新开始",screenWidth/2,e+.7*r)}}),loadDialog=Sprite({x:0,y:0,width:screenWidth,height:screenHeight,show:!1,numAssets:0,assetsLoaded:0,update:function(){this.assetsLoaded==this.numAssets&&closeDialog(this)},open:function(){this.show=!0},close:function(){this.show=!1,openDialog(startDialog)},render:function(){context.fillStyle="black",context.fillRect(0,0,screenWidth,screenHeight),context.fillStyle="white",context.font="".concat(Math.floor(30*kw),"px Arial"),context.textAlign="center",context.fillText("Loading... (".concat(this.assetsLoaded," / ").concat(this.numAssets,")"),screenWidth/2,screenHeight/2)}}),cardDialog=Sprite({x:0,y:0,width:screenWidth,height:screenHeight,show:!1,parent:null,selectedCard:{},msgArr:["最多只能携带9张卡片","要获得新卡片，请选择一张卡片舍弃"],btnArr:[],addBtn:function(t){this.btnArr.find((function(e){return e.id===t.id}))||this.btnArr.push(t)},onUp:function(){var t,e=getPointer(),i=_createForOfIteratorHelper(this.btnArr);try{for(i.s();!(t=i.n()).done;){var r=t.value;isClickRect(e,r)&&r.onPressed()}}catch(t){i.e(t)}finally{i.f()}},open:function(t){this.show=!0,this.parent=t,this.selectedCard={},clearArr(this.btnArr)},close:function(){this.show=!1},render:function(){var t=0,e=0;drawSubWindow(t,e,this.width,this.height),context.fillStyle="white",context.font="".concat(Math.floor(16*kw),"px Arial"),context.lineWidth=1,context.textAlign="left",t=Math.floor(screenWidth/2-4*objSize),e+=objSize;var i,r=_createForOfIteratorHelper(this.msgArr);try{for(r.s();!(i=r.n()).done;){var n=i.value;e+=objSize,context.fillText(n,t,e)}}catch(t){r.e(t)}finally{r.f()}e+=objSize,this.drawCards(t,e),this.drawCloseBtn(),this.selectedCard.name&&(context.fillStyle="white",context.font="".concat(Math.floor(16*kw),"px Arial"),context.lineWidth=1,context.textAlign="left",e+=10*objSize,context.fillText("确定要将 LV.".concat(this.selectedCard.lv," ").concat(this.selectedCard.name),t,e),e+=objSize,context.fillText("替换为 LV.1 ".concat(this.parent.selectedCard.name," 吗？"),t,e),t=(screenWidth-5*objSize)/2,e+=objSize,this.drawOkBtn(t,e,5*objSize,objSize))},drawCards:function(t,e){var i=this,r=0,n=0,a=t,o=e,s=Math.floor(16*kw);context.font="".concat(s,"px Arial"),context.lineWidth=1,context.textAlign="center";var h,c=_createForOfIteratorHelper(player.cards);try{var l=function(){var s=h.value;drawCard(t=a+3*objSize*r,e=o+3*objSize*n,s,cardDialog.selectedCard),context.fillText(s.name,t+objSize,e+2.5*objSize),r<2?r++:(r=0,n++),i.addBtn({id:s.name,x:t,y:e,width:s.width,height:s.height,onPressed:function(){cardDialog.selectedCard=s}})};for(c.s();!(h=c.n()).done;)l()}catch(t){c.e(t)}finally{c.f()}},drawOkBtn:function(t,e,i,r){context.strokeStyle="white",context.lineWidth=2*kw,context.strokeRect(t,e,i,r),context.fillStyle="white",context.textAlign="center",context.font="".concat(Math.floor(16*kw),"px Arial"),context.fillText("确定",screenWidth/2,e+.7*r),this.addBtn({id:"ok",x:t,y:e,width:i,height:r,onPressed:function(){removeFromArr(player.cards,cardDialog.selectedCard),cardDialog.selectedCard.remove(),cardDialog.parent.selectedCard.get(),player.point--,closeSubDialog(cardDialog.parent,cardDialog),closeDialog(cardDialog.parent)}})},drawCloseBtn:function(){var t=screenWidth-objSize-10*pixelSize,e=objSize/2+2*pixelSize,i=objSize;this.addBtn({id:"close",x:t,y:e,width:i,height:i,onPressed:function(){closeSubDialog(cardDialog.parent,cardDialog)}}),_drawCloseBtn(t,e,i)}}),cardDetailDialog=Sprite({x:0,y:0,width:screenWidth,height:screenHeight,show:!1,parent:null,btnArr:[],addBtn:function(t){this.btnArr.find((function(e){return e.id===t.id}))||this.btnArr.push(t)},onUp:function(){var t,e=getPointer(),i=_createForOfIteratorHelper(this.btnArr);try{for(i.s();!(t=i.n()).done;){var r=t.value;isClickRect(e,r)&&r.onPressed()}}catch(t){i.e(t)}finally{i.f()}},open:function(t){this.show=!0,this.parent=t},close:function(){this.show=!1},render:function(){var t=0,e=0;drawSubWindow(t,e,this.width,this.height),context.fillStyle="white",context.font="".concat(Math.floor(16*kw),"px Arial"),context.lineWidth=1,context.textAlign="left",t=Math.floor(screenWidth/2-4*objSize),e+=objSize;var i,r=_createForOfIteratorHelper(this.parent.selectedCard.getDetail());try{for(r.s();!(i=r.n()).done;){var n=i.value;e+=objSize,context.fillText(n,t,e)}}catch(t){r.e(t)}finally{r.f()}e+=objSize,this.drawCloseBtn()},drawCloseBtn:function(){var t=screenWidth-objSize-10*pixelSize,e=objSize/2+2*pixelSize,i=objSize;this.addBtn({id:"close",x:t,y:e,width:i,height:i,onPressed:function(){closeSubDialog(cardDetailDialog.parent,cardDetailDialog)}}),_drawCloseBtn(t,e,i)}});function _createForOfIteratorHelper(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var r=0,n=function(){};return{s:n,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==i.return||i.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=Array(e);i<e;i++)r[i]=t[i];return r}function drawJoystick(){joystick.frameCount<300&&(context.globalAlpha=.4,context.beginPath(),context.arc(joystick.x,joystick.y,joystick.outerRadius,0,2*Math.PI),context.strokeStyle="gray",context.lineWidth=4,context.stroke(),context.globalAlpha=.7,context.beginPath(),context.arc(joystick.x+joystick.offsetX,joystick.y+joystick.offsetY,joystick.innerRadius,0,2*Math.PI),context.fillStyle="gray",context.fill(),context.globalAlpha=1,joystick.frameCount++)}function isClickInRectangle(t,e,i){return t>=i.x&&t<=i.x+i.width&&e>=i.y&&e<=i.y+i.height}function handleTouchStart(t){if(joystick.enable){var e,i=_createForOfIteratorHelper(t.touches);try{for(i.s();!(e=i.n()).done;){var r=e.value;isClickInRectangle(r.clientX,r.clientY,menu)||(joystick.x=r.clientX,joystick.y=r.clientY,joystick.touchId=r.identifier,joystick.active=!0,joystick.frameCount=0)}}catch(t){i.e(t)}finally{i.f()}}}function handleTouchMove(t){if(joystick.enable&&joystick.active){var e,i=_createForOfIteratorHelper(t.touches);try{for(i.s();!(e=i.n()).done;){var r=e.value;if(r.identifier===joystick.touchId){var n=r.clientX-joystick.x,a=r.clientY-joystick.y;if(Math.sqrt(n*n+a*a)<joystick.outerRadius)joystick.offsetX=n,joystick.offsetY=a;else{var o=Math.atan2(a,n);joystick.offsetX=Math.cos(o)*joystick.outerRadius,joystick.offsetY=Math.sin(o)*joystick.outerRadius}joystick.frameCount=0}}}catch(t){i.e(t)}finally{i.f()}}}function handleTouchEnd(t){if(joystick.enable){var e,i=_createForOfIteratorHelper(t.changedTouches);try{for(i.s();!(e=i.n()).done;){e.value.identifier===joystick.touchId&&(joystick.active=!1,joystick.offsetX=0,joystick.offsetY=0)}}catch(t){i.e(t)}finally{i.f()}}}function keyboard(){(kontra.keyPressed("arrowup")||kontra.keyPressed("w"))&&(joystick.offsetY-=10),(kontra.keyPressed("arrowdown")||kontra.keyPressed("s"))&&(joystick.offsetY+=10),(kontra.keyPressed("arrowleft")||kontra.keyPressed("a"))&&(joystick.offsetX-=10),(kontra.keyPressed("arrowright")||kontra.keyPressed("d"))&&(joystick.offsetX+=10),Math.abs(joystick.offsetX)>=50&&(joystick.offsetX=joystick.offsetX>0?49:-49),Math.abs(joystick.offsetY)>=50&&(joystick.offsetY=joystick.offsetY>0?49:-49),joystick.offsetY<0?joystick.offsetX>0?player.direction=BACK_RIGHT:joystick.offsetX<0&&(player.direction=BACK_LEFT):joystick.offsetX>0?player.direction=RIGHT:joystick.offsetX<0&&(player.direction=LEFT)}dialogArr.push(gameOverDialog),dialogArr.push(levelUpDialog),dialogArr.push(mainDialog),dialogArr.push(startDialog),dialogArr.push(loadDialog),dialogArr.push(cardDialog),dialogArr.push(cardDetailDialog),window.addEventListener("keyup",(function(t){"ArrowLeft"!==t.key&&"a"!==t.key&&"ArrowRight"!==t.key&&"d"!==t.key||(joystick.offsetX=0),"ArrowUp"!==t.key&&"w"!==t.key&&"ArrowDown"!==t.key&&"s"!==t.key||(joystick.offsetY=0)}));var joystick={x:screenWidth/2,y:screenHeight/1.15,outerRadius:50,innerRadius:20,touchId:null,offsetX:0,offsetY:0,enable:!0,active:!1,frameCount:300};function _createForOfIteratorHelper(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var r=0,n=function(){};return{s:n,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==i.return||i.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=Array(e);i<e;i++)r[i]=t[i];return r}function createBackground(){var t,e=generatePoints(),i=_createForOfIteratorHelper(e);try{var r=function(){var e=t.value;if(!isColliding(player,e)&&e.x+objSize<worldLimit&&e.y+objSize<worldLimit){var i=weightedRandom({1:.2,2:.2,3:2,4:2,5:8,6:8}),r=0,n=0,a=0;i<=2&&(r=100,n=100),i>=3&&i<=4&&(r=100,n=100,a=90),i>=5&&i<=6&&(r=100,n=100,a=70),backgroundArr.push(Sprite({hp:r,maxHp:n,def:a,x:e.x,y:e.y,width:objSize,height:objSize,anchor:{x:.5,y:.5},type:"background",direction:i,frameCount:0,isAlive:function(){return this.hp>0&&this.ttl>60},ttl:1/0,update:function(){this.frameCount++,this.ttl>0&&this.ttl--,this.frameCount%15==0&&(1==this.direction?this.direction=2:2==this.direction&&(this.direction=1)),this.hp<=0&&this.ttl>60&&(this.hp=0,this.ttl=60,i<=2&&createItem(this.x,this.y,100,heart),scoreboard.break++),this.hp<this.maxHp&&this.frameCount%60==0&&(this.hp++,this.hp==this.maxHp&&(this.ttl=1/0)),this.frameCount>3e4&&(this.frameCount=0)},render:function(){this.ttl>60?drawBitmap(this.direction,background):this.ttl>0&&drawBitmap(Math.ceil(this.ttl/15),boom)}}))}};for(i.s();!(t=i.n()).done;)r()}catch(t){i.e(t)}finally{i.f()}}function createEnemy(t){var e=2*Math.random()*Math.PI,i=Math.round(player.x+.8*screenHeight*Math.cos(e)),r=Math.round(player.y+.8*screenHeight*Math.sin(e)),n=enemyPool.getAliveObjects().length>=enemyPool.maxSize/2&&randInt(1,100)<=20?2:1;return enemyPool.get({hp:t.hp,atk:t.atk,def:t.def,exp:t.exp,x:i,y:r,width:objSize*(t.size?t.size/pixelSize:1),height:objSize*(t.size?t.size/pixelSize:1),anchor:{x:.5,y:.5},type:t.isBoss?"boss":"enemy",direction:LEFT,speed:(t.speed?t.speed:n)*kw,frameCount:0,timeCount:0,ttl:1/0,isDead:!1,attack:function(){var e=Math.floor(this.atk-player.def);e<1&&(e=1),player.hp=player.hp-(e>0?e:1),player.hp<0&&(player.hp=0),audioAssets[t.audioPath].play(),showDamage(player.x,player.y,e,1),scoreboard.receivedDamage+=e},isAlive:function(){return this.ttl>0},update:function(t){if(this.frameCount++,this.ttl>0&&this.ttl--,!(this.ttl<60)){if(this.hp<=0)return createItem(this.x,this.y,this.exp,exp_ball),this.ttl=60,this.isDead=!0,void scoreboard.kill++;if(this.timeCount+=t,this.timeCount>=1){if(isVisible(this)){var e=Math.abs(player.x-this.x)/objSize|0,i=Math.abs(player.y-this.y)/objSize|0;Math.max(e,i)<enemyAttackRangeTiles&&this.attack()}this.timeCount=0}var r,n=!1,a=_createForOfIteratorHelper(quadtree.get(this));try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o!=player&&o.isAlive()&&isColliding(this,o)&&"skill"!=o.type){var s=this.x-o.x,h=this.y-o.y,c=Math.sqrt(s*s+h*h);if(c>0&&c<minDistance){if("background"==o.type){n=!0;break}var l=s/c,u=h/c,d=.5*pixelSize;this.x+=Math.round(l*d),this.y+=Math.round(u*d)}}}}catch(t){a.e(t)}finally{a.f()}if(this.frameCount%30==0){var f=player.x-this.x,p=player.y-this.y,y=Math.sqrt(f*f+p*p);if(y<approachDistance){var v=Math.atan2(p,f),g=player.x+30*Math.cos(v+Math.PI/2),x=player.y+30*Math.sin(v+Math.PI/2),m=g-this.x,_=x-this.y,w=Math.sqrt(m*m+_*_);if(w>minDistance){var b=m/w,k=_/w;this.dx=Math.round(b*this.speed),this.dy=Math.round(k*this.speed)}else this.dx=0,this.dy=0}else if(y>minDistance){var A=f/y,S=p/y;this.dx=Math.round(A*this.speed),this.dy=Math.round(S*this.speed)}else this.dx=0,this.dy=0;setDirection(this,f,p)}checkBoundary(this),n?this.frameCount%3==0&&this.advance():this.advance(),this.frameCount>3e4&&(this.frameCount=0)}},render:function(){isVisible(this)&&(this.ttl>60?drawBitmap(this.direction,t.mat,t.size):drawBitmap(Math.ceil(this.ttl/15),boom,t.size))}})}function createItem(t,e,i,r){if(itemPool.size==itemPool.maxSize){var n,a=_createForOfIteratorHelper(itemPool.getAliveObjects());try{for(a.s();!(n=a.n()).done;){var o=n.value;if(!isVisible(o)){o.ttl=0,itemPool.update();break}}}catch(t){a.e(t)}finally{a.f()}}itemPool.get({x:t,y:e,width:objSize,height:objSize,anchor:{x:.5,y:.5},type:"item",direction:LEFT,progress:0,fly:!1,ttl:1800,effect:function(){r==exp_ball?player.addExp(i):r==heart&&player.addHp(i)},update:function(){if(this.ttl>0&&this.ttl--,this.fly){var i={x:t+.3*(player.x-t),y:e-50*kw},r={x:t+.7*(player.x-t),y:player.y-50*kw};this.progress+=.02,bezier(this,i,r,this.progress),this.progress>=1&&(this.ttl=0,this.effect())}else{var n=player.x-this.x,a=player.y-this.y;Math.sqrt(n*n+a*a)<player.pickupDistance&&(this.fly=!0)}},render:function(){isVisible(this)&&drawBitmap(this.direction,r)}})}function showDamage(t,e,i,r){msgPool.get({x:t,y:e,ttl:90,update:function(){this.ttl>0&&(this.ttl--,this.dy=-.5),this.advance()},render:function(){isVisible(this)&&(context.save(),context.translate(Math.round(screenWidth/2-player.x),Math.round(screenHeight/2-player.y-3*objSize)),context.fillStyle="white",context.font="".concat(Math.floor(13*kw*r),"px Arial"),context.fillText(i,3*-objSize/5,-objSize/2),context.restore())}})}function showMsg(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:120;msgPool.get({x:t,y:e,ttl:r,update:function(){this.ttl>0&&(this.ttl--,this.dy=-1),this.advance()},render:function(){isVisible(this)&&(context.save(),context.translate(Math.round(screenWidth/2-player.x+objSize/2),Math.round(screenHeight/2-player.y+objSize/2-3*objSize)),context.fillStyle="white",context.font="".concat(Math.floor(19*kw),"px Arial"),context.textAlign="center",context.fillText(i,0,0),context.restore())}})}var expBar=Sprite({x:0,y:0,width:screenWidth,height:2*objSize/3,render:function(){context.fillStyle="black",context.fillRect(0,0,this.width,this.height);var t=player.exp/player.maxExp*screenWidth;context.fillStyle="gray",context.fillRect(0,0,t,this.height);var e=Math.floor(17*kw);context.fillStyle="white",context.font="".concat(e,"px Arial"),context.textAlign="center",context.fillText("LV ".concat(player.lv),this.width/2,this.height-2*kw)}}),statusBar=Sprite({x:0,y:expBar.height,m:0,s:0,time:"00:00",init:function(){this.m=0,this.s=0,this.time="00:00"},update:function(){this.s++,60==this.s&&(this.m++,this.s=0),this.time=displayNumber(this.m)+":"+displayNumber(this.s)},render:function(){var t=Math.round(player.hp/player.maxHp*10);context.fillStyle="white",context.font="".concat(Math.floor(13*kw),"px Arial"),context.fillText("HP ",objSize/2,objSize/2);for(var e=1;e<=t;e++){var i=e*pixelSize*4.5+objSize;context.fillRect(i,objSize/2-10*kw,3*pixelSize,5*pixelSize)}context.textAlign="center",context.font="".concat(Math.floor(19*kw),"px Arial"),context.fillText("".concat(this.time),screenWidth/2,objSize)}}),menu=Button({x:screenWidth-objSize-5*pixelSize,y:objSize/2+5*pixelSize,width:objSize,height:objSize,onUp:function(){openDialog(mainDialog)},onOut:function(){this.pressed=!1},render:function(){for(var t=this.pressed?"white":"gray",e=0;e<bitmapHeight;e++)for(var i=menu_book[e],r=0;r<bitmapWidth;r++){var n=i>>bitmapWidth-1-r&1;context.fillStyle=n?t:"black",context.fillRect(r*pixelSize,e*pixelSize,pixelSize,pixelSize)}}}),worldBoundary=Sprite({x:0,y:0,width:worldLimit,height:worldLimit,render:function(){context.save(),context.strokeStyle="white",context.lineWidth=2*kw,context.strokeRect(-viewport.x,-viewport.y,worldLimit,worldLimit),context.restore()}}),player=Sprite({x:playerData.x,y:playerData.y,maxHp:playerData.maxHp,hp:playerData.maxHp,atk:playerData.atk,def:playerData.def,crit:playerData.crit,maxExp:playerData.maxExp,lv:1,exp:0,anchor:{x:.5,y:.5},width:objSize,height:objSize,direction:LEFT,skill:[],cards:[],stop:!1,point:0,pickupDistance:50*kw,angle:0,lastDx:0,lastDy:0,init:function(){this.x=playerData.x,this.y=playerData.y,this.maxHp=playerData.maxHp,this.hp=playerData.maxHp,this.atk=playerData.atk,this.def=playerData.def,this.crit=playerData.crit,this.maxExp=playerData.maxExp,this.lv=1,this.exp=0,this.direction=LEFT,this.skill=[],this.cards=[],this.stop=!1,this.point=0,this.pickupDistance=50*kw},checkPoint:function(){this.point>0&&(audioAssets["/audio/level_up"].play(),showMsg(this.x,this.y,"LEVEL UP"),openDialog(levelUpDialog))},addExp:function(t){if(this.lv<maxExp.length)for(var e=t;e>0;){if(this.exp+=e,!(this.exp>=this.maxExp))return;this.lv++,e=this.exp-this.maxExp,this.exp=0,this.maxExp=maxExp[this.lv-1],this.point++}},addHp:function(t){this.hp+=t,this.hp>this.maxHp&&(this.hp=this.maxHp),showDamage(this.x,this.y,"+"+t,1)},isAlive:function(){return this.hp>0},attack:function(t,e){var i=this.crit>randInt(1,100)?2:1,r=Math.floor((this.atk-t.def)*(e/100))*i;r<1&&(r=1),t.hp=t.hp-r,showDamage(t.x,t.y,r,i),scoreboard.damage+=r},update:function(){if(this.isAlive()||openDialog(gameOverDialog),!this.stop){var t,e=_createForOfIteratorHelper(quadtree.get(this));try{for(e.s();!(t=e.n()).done;){var i=t.value;if("background"==i.type&&i.isAlive()&&isColliding(this,i)){var r=this.x-i.x,n=this.y-i.y,a=Math.sqrt(r*r+n*n);if(a>0){var o=r/a,s=n/a,h=pixelSize;this.x+=Math.round(o*h),this.y+=Math.round(s*h);break}}}}catch(t){e.e(t)}finally{e.f()}joystick.active?setDirection(this,joystick.offsetX,joystick.offsetY):keyboard(),this.dx=Math.round(joystick.offsetX*speedFactor),this.dy=Math.round(joystick.offsetY*speedFactor),0==this.dx&&0==this.dy||(this.angle=Math.atan2(this.dy,this.dx)),this.lastDx=0!=this.dx?this.dx:this.lastDx,this.lastDy=0!=this.dy?this.dy:this.lastDy,checkBoundary(this),this.advance()}},render:function(){drawBitmap(this.direction,wizard)}}),loop=GameLoop({update:function(t){var e,i=_createForOfIteratorHelper(dialogArr);try{for(i.s();!(e=i.n()).done;){e.value.update(t)}}catch(t){i.e(t)}finally{i.f()}if(!paused){updateViewport(player),quadtree.clear(),quadtree.add(player,enemyPool.getAliveObjects(),backgroundArr,fireball,deathbook,poisonsmoke,axe,lance),player.update(t),enemyPool.update(t),itemPool.update(t),msgPool.update(t);var r,n=_createForOfIteratorHelper(player.skill);try{for(n.s();!(r=n.n()).done;){r.value.update(t)}}catch(t){n.e(t)}finally{n.f()}var a,o=_createForOfIteratorHelper(backgroundArr);try{for(o.s();!(a=o.n()).done;){a.value.update()}}catch(t){o.e(t)}finally{o.f()}expBar.update(t),menu.update(t)}},render:function(){player.render(),enemyPool.render();var t,e=_createForOfIteratorHelper(backgroundArr);try{for(e.s();!(t=e.n()).done;){var i=t.value;isVisible(i)&&i.render()}}catch(t){e.e(t)}finally{e.f()}itemPool.render(),msgPool.render(),worldBoundary.render(),expBar.render(),statusBar.render(),menu.render(),drawJoystick();var r,n=_createForOfIteratorHelper(player.skill);try{for(n.s();!(r=n.n()).done;){r.value.render()}}catch(t){n.e(t)}finally{n.f()}var a,o=_createForOfIteratorHelper(dialogArr);try{for(o.s();!(a=o.n()).done;){var s=a.value;if(s.show){s.render();break}}}catch(t){o.e(t)}finally{o.f()}}});function createBoss(t){var e=!createEnemy(t);if(e){var i,r=_createForOfIteratorHelper(enemyPool.getAliveObjects());try{for(r.s();!(i=r.n()).done;){var n=i.value;if(!isVisible(n))return n.ttl=0,!createEnemy(t)}}catch(t){r.e(t)}finally{r.f()}}return e}function wave(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];for(var r=0;r<enemyCount;r++){var n,a=_createForOfIteratorHelper(e);try{for(a.s();!(n=a.n()).done;){createEnemy(n.value)}}catch(t){a.e(t)}finally{a.f()}}}function respawnEnemy(){if(enemyPool.getAliveObjects().length==enemyPool.maxSize){var t,e=_createForOfIteratorHelper(enemyPool.getAliveObjects());try{for(e.s();!(t=e.n()).done;){var i=t.value;if(!isVisible(i)&&"boss"!=i.type)Math.sqrt(Math.pow(i.x-player.x,2)+Math.pow(i.y-player.y,2))>.8*screenHeight&&(i.ttl=0,i.update())}}catch(t){e.e(t)}finally{e.f()}}}var boss_skeleton_flag=!0,boss_crab_flag=!0,boss_tauren_flag=!0,no_skill_flag=!0,low_hp_time=0;function intervalHandle(){if(respawnEnemy(),player.checkPoint(),statusBar.update(),player.hp<player.maxHp/2&&60==++low_hp_time&&(showMsg(player.x,player.y,"摧毁火把可以恢复生命值",600),low_hp_time=0),no_skill_flag&&player.skill.length>1){var t,e=_createForOfIteratorHelper(cardArr);try{for(e.s();!(t=e.n()).done;){var i=t.value;i.type==CARD_TYPE_WEAPON&&(i.weight-=.5)}}catch(t){e.e(t)}finally{e.f()}no_skill_flag=!1}statusBar.m<5?wave(slime,skeleton):boss_skeleton_flag?boss_skeleton_flag=createBoss(boss_skeleton):statusBar.m<9?wave(spider,snake):boss_crab_flag?boss_crab_flag=createBoss(boss_crab):statusBar.m<14?wave(mummy,orc):boss_tauren_flag?boss_tauren_flag=createBoss(boss_tauren):statusBar.m<18?wave(devil,fox):statusBar.m<25&&wave(reaper,reaper)}load("/audio/attack_slime.mp3","/audio/attack_sword.mp3","/audio/attack_bite.mp3","/audio/attack_blunt.mp3","/audio/attack_fork.mp3","/audio/attack_scythe.mp3","/audio/attack_spider.mp3","/audio/attack_big_sword.mp3","/audio/skill_lightning.mp3","/audio/skill_fireball.mp3","/audio/skill_book.mp3","/audio/skill_charge.mp3","/audio/skill_lightsaber1.mp3","/audio/skill_lightsaber2.mp3","/audio/skill_poison.mp3","/audio/skill_axe.mp3","/audio/skill_lance.mp3","/audio/level_up.mp3").then((function(){canvas.addEventListener("touchstart",handleTouchStart),canvas.addEventListener("touchmove",handleTouchMove),canvas.addEventListener("touchend",handleTouchEnd)})),loadDialog.numAssets=18,loadDialog.assetsLoaded=0,on("assetLoaded",(function(){loadDialog.assetsLoaded++})),loop.start(),openDialog(loadDialog);